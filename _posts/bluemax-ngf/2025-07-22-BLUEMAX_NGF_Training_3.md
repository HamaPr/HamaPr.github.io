---
layout: post
title: BLUEMAX NGF 실습 기록 (3/3) - 차세대 보안 기능(L7 제어) 검증
date: 2025-07-22 17:00:00 +0900
categories: [bluemax-ngf]
tags: [Firewall, BLUEMAX, NGF, L7-Control, DLP, Anti-Virus]
---

BLUEMAX NGF(차세대 방화벽)가 제공하는 L7(응용 계층) 보안 기능에 대한 통합 실습을 진행했습니다. 본 기록은 기존의 IP/Port 기반 접근 제어를 넘어 트래픽의 내용과 애플리케이션 유형을 직접 인지하여 보안 정책을 적용하는 과정을 검증하는 데 중점을 둡니다. 애플리케이션 제어, 웹 필터링, 데이터 유출 방지(DLP), 파일 유형 제어 및 안티바이러스 기능을 실제 트래픽에 적용하고 그 결과를 관찰했습니다.

---

### 1. 애플리케이션 인지 및 웹 필터링

#### ***학습 목표***
IP 주소나 포트 번호와 무관하게 특정 애플리케이션을 식별하여 차단하고 정의된 카테고리의 웹사이트 접속을 제어하는 L7 정책의 동작을 확인하는 것을 목표로 합니다.

#### ***실습 내용***
1.  **애플리케이션 제어**:
    1.  보안 정책(Security Policy)에 신규 방화벽 규칙을 생성했습니다.
    2.  정책의 '애플리케이션' 필드에서 `kakaotalk-base` 그룹 객체를 선택했습니다.
    3.  해당 정책의 동작(Action)을 '거부(Deny)'로 설정하고 적용했습니다.
    4.  정책 적용 후, 내부 PC에서 카카오톡 PC 버전 로그인을 시도하여 실패하는 것을 확인했습니다.
    5.  CLI에서 `fw show drule` 명령을 통해 해당 트래픽이 AppID `10894`로 식별되어 차단 정책에 매칭되었음을 검증했습니다.

2.  **웹 필터링**:
    1.  `Object/Security Profile` 메뉴에서 '웹 필터' 프로파일을 생성했습니다.
    2.  Webroot 기반 URL 카테고리 중 '게임 사이트'를 선택하고 동작을 '차단'으로 설정했습니다.
    3.  생성한 웹 필터 프로파일을 기존 방화벽 허용 정책의 '보안 프로파일' 항목에 적용했습니다.
    4.  내부 PC에서 게임 관련 웹사이트에 접속 시도 시 'Web Page Blocked' 페이지가 나타나는 것을 확인했습니다.

#### ***실습 후기***
표준 포트(예: TCP 80, 443)를 사용하는 카카오톡이나 웹사이트 트래픽이 L4 정보만으로는 구분이 불가능함에도 불구하고, 방화벽이 패킷의 페이로드(payload)를 분석하여 애플리케이션의 고유한 시그니처와 URL 카테고리를 식별해내는 것을 확인했습니다. 이를 통해 차세대 방화벽의 제어 단위가 IP/Port에서 애플리케이션 및 콘텐츠 자체로 확장되었음을 검증했습니다.

---

### 2. 콘텐츠 기반 유출 방지 (DLP 및 파일 유형 제어)

#### ***학습 목표***
네트워크를 통해 전송되는 파일의 내용과 실제 유형을 분석하여 정보 유출을 방지하는 기능을 검증하는 것을 목표로 합니다. 파일 내용에 포함된 특정 문자열과 파일의 실제 구조(시그니처)를 기준으로 차단 정책이 동작하는지 확인합니다.

#### ***실습 내용***
1.  **데이터 유출 방지(DLP)**:
    1.  VMware 환경에 FTP 서버를 구축하고 PC 간 파일 전송이 가능한 네트워크 환경을 구성했습니다.
    2.  DLP 프로파일을 생성하고 'abc'라는 문자열을 탐지하도록 데이터 객체를 추가했습니다.
    3.  해당 DLP 프로파일을 FTP 트래픽에 적용하는 방화벽 정책을 설정했습니다.
    4.  내용에 'abc' 문자열이 포함된 `DLP-test.txt` 파일의 FTP 전송을 시도했고 "Forbidden keyword found, Blocked" 오류와 함께 실패하는 것을 확인했습니다.

2.  **파일 유형 제어**:
    1.  SMB 서버를 구축하고 윈도우 파일 공유 환경을 구성했습니다.
    2.  `Object/Security Profile`에서 '파일 유형 제어' 프로파일을 생성하고 파일 유형으로 `xls,xlsx`를 지정, 애플리케이션은 `smb`, 대응 방식은 `차단`으로 설정했습니다.
    3.  해당 프로파일을 방화벽 정책에 적용했습니다.
    4.  SMB 공유 폴더를 통해 `.xlsx` 파일을 다운로드 시도 시 "네트워크 오류"가 발생하며 차단되는 것을 관찰했습니다.
    5.  데이터 필터 로그에서 해당 파일 전송이 `XLSX file format`으로 탐지되어 `block` 처리되었음을 확인했습니다.

#### ***실습 후기***
단순히 파일 확장자를 검사하는 것이 아니라 방화벽이 FTP 및 SMB 프로토콜 스트림을 재조합(Reassembly)하여 파일의 실제 내용과 구조를 분석한다는 것을 확인했습니다. DLP는 텍스트 패턴 매칭을, 파일 유형 제어는 파일 고유의 시그니처(헤더/푸터 등)를 기반으로 동작함을 검증했으며 이를 통해 암호화되지 않은 평문 프로토콜에 대한 심층적인 콘텐츠 검사가 가능함을 확인했습니다.

---

### 3. 안티바이러스 연동 및 DMZ 구성

#### ***학습 목표***
외부와 내부 네트워크의 중간 지점인 DMZ(Demilitarized Zone)를 구성하고 외부에서 DMZ의 특정 서버로 안전하게 접근하도록 1:1 NAT 정책을 설정하는 것을 목표로 합니다. 또한, 방화벽을 통과하는 파일에 대해 안티바이러스 검사를 수행하여 악성코드를 차단하는 과정을 검증합니다.

#### ***실습 내용***
1.  **DMZ 구성**:
    1.  인터페이스 `eth2`를 'DMZ' Zone으로 지정하고 `100.100.3.1/24` IP 대역을 할당했습니다.
    2.  1:1 확장 변환 NAT 정책을 생성하여 외부에서 특정 공인 IP(`10.10.31.24`)로 들어오는 요청을 DMZ 내부 서버의 사설 IP(`100.100.3.126`)로 전달하도록 설정했습니다.

2.  **안티바이러스(AV) 설정**:
    1.  안티바이러스 프로파일에서 HTTP, FTP 등 검사할 프로토콜을 활성화하고 대응 동작을 '차단'으로 설정했습니다.
    2.  테스트용 악성코드 파일(EICAR)의 MD5 해시 값을 안티바이러스 DB에 수동으로 추가했습니다.
    3.  해당 프로파일을 방화벽 정책의 보안 프로파일에 적용했습니다.
    4.  FTP를 통해 해당 악성코드 파일 다운로드를 시도했을 때, 전송이 차단되는 것을 확인했습니다.
    5.  위협 로그에서 해당 파일이 'Anti Virus' 기능에 의해 차단되었음을 최종적으로 확인했습니다.

#### ***실습 후기***
DMZ 구성과 1:1 NAT 설정을 통해 외부에는 공인 IP만 노출시키면서 실제 서버는 보호된 네트워크(DMZ)에 위치시키는 '서비스 게이트웨이'로써 방화벽의 역할을 확인했습니다. 또한, 안티바이러스 연동 실습에서 파일이 통과하는 시점에 실시간으로 시그니처(MD5) 기반 검사가 이루어지는 것을 통해 방화벽이 단순한 접근 제어를 넘어 위협 콘텐츠 자체를 필터링하는 보안 허브로 기능함을 검증했습니다.

---

#### 마치며
3차 실습 기록을 통해 차세대 방화벽의 핵심인 L7 제어 기능들을 종합적으로 검증했습니다. 애플리케이션 식별, URL 카테고리 필터링, 콘텐츠 문자열 및 파일 유형 분석, 악성코드 탐지 등, 패킷의 내용을 깊이 있게 들여다보고 이를 기반으로 보안 정책을 적용하는 전 과정을 확인했습니다. 이는 현대 네트워크 환경에서 정교하고 다층적인 보안을 구현하기 위해 차세대 방화벽이 필수적임을 기술적으로 입증하는 과정이었습니다.

<hr class="short-rule">