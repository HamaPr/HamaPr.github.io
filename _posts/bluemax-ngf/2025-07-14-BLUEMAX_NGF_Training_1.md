---
layout: post
title: BLUEMAX NGF 실습 기록 (1/3) - 방화벽 기본과 L2/L3 모드
date: 2025-07-14 17:00:00 +0900
categories: [bluemax-ngf]
tags: [Firewall, BLUEMAX, Routing, NAT, Bridge]
---

BLUEMAX NGF(Next-Generation Firewall) 장비를 이용하여 방화벽의 근간이 되는 네트워크 중개 역할을 검증하는 실습을 진행했습니다. 본 기록은 장비의 초기 설정부터 시작하여 L3 라우터(Router) 모드에서의 IP 기반 경로 설정, 네트워크 주소 변환(NAT)의 실제 동작 관찰, 그리고 L2 브릿지(Bridge) 모드를 통한 투명한 네트워크 통합 과정까지를 포함합니다. 모든 절차는 물리적 장비에 직접 설정값을 적용하고 그 결과를 관찰하는 방식으로 수행되었습니다.

---

### 1. 초기 설정 및 라우터 모드(L3) 검증

#### ***학습 목표***
방화벽을 네트워크 경계에 L3 장비로 위치시키고 각기 다른 IP 대역을 사용하는 내부망과 외부망 간의 통신을 정상적으로 중개하도록 설정하는 것을 목표로 합니다. 정적 라우팅(Static Routing) 설정을 통해 방화벽이 알지 못하는 목적지 네트워크로의 경로를 지정하는 과정을 확인합니다.

#### ***실습 내용***
1.  콘솔(Serial) 케이블을 이용해 장비에 최초 접속 후 `supermode`에 진입하여 관리자 계정을 생성하고 웹 UI 접속을 위한 관리 IP를 할당했습니다. (`admin ip add 192.168.25.1/24`)
2.  물리적 인터페이스에 역할을 부여하고 IP 주소를 설정했습니다. 외부망(WAN) 역할의 `eth2`에는 `10.10.31.150/24`를 내부망(LAN) 역할의 `eth0`과 `eth1`에는 각각 `192.168.25.1/24`, `192.168.15.1/24`를 할당했습니다.
3.  외부 인터넷으로 향하는 기본 경로(Default Gateway)로 `10.10.31.254`를 지정했습니다.
4.  방화벽에 직접 연결되지 않은 원격 내부 네트워크 대역(`192.168.11.0/24` 등)으로 패킷을 전달하기 위해 다음 라우터(`10.10.31.110`)를 게이트웨이로 지정하는 정적 라우팅 규칙을 추가했습니다.
5.  내부 PC에서 외부 IP 대역으로 `ping` 테스트를 수행하여 L3 통신 및 라우팅 설정의 정상 동작을 검증했습니다.

#### ***실습 후기***
정적 라우팅 규칙 추가 전, 방화벽은 직접 연결된 대역 외의 목적지 경로를 알지 못해 `ping`이 실패했습니다. 규칙 추가 후 `ping`이 성공하는 것을 통해 방화벽의 패킷 포워딩(forwarding) 결정이 라우팅 테이블 정보에 직접적으로 의존한다는 L3 통신의 기본 원리를 확인했습니다. 이는 방화벽이 단순 차단 장비가 아닌 지능적인 '라우터'의 역할을 겸하고 있음을 검증한 것입니다.

---

### 2. 네트워크 주소 변환(NAT) 동작 관찰

#### ***학습 목표***
내부 사설 IP를 외부 공인 IP로 변환하는 NAT(Network Address Translation) 정책을 적용하고 `tcpdump` 명령어를 통해 방화벽을 통과하는 패킷의 IP 헤더가 실제로 변경되는 과정을 관찰하는 것을 목표로 합니다.

#### ***실습 내용***
1.  N:M 확장 변환(Port Pool) 방식의 NAT 정책을 설정했습니다.
2.  변경 전 출발지 네트워크 객체로 내부 사설 IP 대역(`192.168.15.0/24`, `192.168.25.0/24`)을 선택했습니다.
3.  변경 후 출발지 호스트 객체로 외부 공인 IP(`10.10.31.150`)를 지정했습니다.
4.  CLI 환경에서 내부 인터페이스(`eth1`)와 외부 인터페이스(`eth2`)에 대해 `tcpdump`를 동시에 실행하여 동일한 통신 세션의 패킷을 모니터링했습니다.

#### ***실습 후기***
`tcpdump`를 통해 내부 인터페이스에서는 출발지 IP가 사설 IP(`192.168.15.x`)로 외부 인터페이스에서는 동일한 패킷의 출발지 IP가 공인 IP(`10.10.31.150`)로 실시간으로 변경되어 나가는 것을 관찰했습니다. 이는 NAT가 논리적 개념에 머무는 것이 아니라 방화벽을 경유하는 순간 실제 패킷 헤더를 재기록(rewrite)하는 물리적인 동작임을 명확하게 검증하는 경험이었습니다.

---

### 3. 브릿지 모드(L2)로 투명성 확보

#### ***학습 목표***
네트워크 구조 변경 없이 기존 망에 방화벽을 투명하게(Transparent) 삽입하는 브릿지 모드를 구성하는 것을 목표로 합니다. L3 라우터 모드와 L2 브릿지 모드의 설정이 상호 배타적임을 확인하고 L2 환경에서의 방화벽 정책 적용을 검증합니다.

#### ***실습 내용***
1.  브릿지로 묶을 인터페이스(`eth2`, `eth3`, `eth4`)에 설정되어 있던 기존의 모든 L3 설정(IP 주소, 라우팅, DHCP 등)을 먼저 제거했습니다.
2.  여러 개의 물리적 인터페이스를 `br0`이라는 논리적 브릿지 인터페이스로 묶는 작업을 수행했습니다.
3.  `br0` 인터페이스에는 트래픽 중개용 IP가 아닌 장비 관리 접속 목적의 IP(`10.10.31.150/24`)만을 할당했습니다.
4.  내부 PC의 게이트웨이를 방화벽이 아닌 상단 라우터(`10.10.31.254`)로 설정한 상태에서도 방화벽에 설정된 L2 계층 기반의 정책(예: MAC 주소 기반 차단)이 정상 동작하는 것을 확인했습니다.

#### ***실습 후기***
L3 관련 설정을 모두 제거해야만 L2 브릿지 모드 활성화가 가능했습니다. 이를 통해 특정 인터페이스의 운영 모드는 L2와 L3의 역할을 동시에 수행할 수 없으며 그 역할이 명확히 구분되어야 함을 직접 확인했습니다. PC의 게이트웨이가 방화벽이 아님에도 불구하고 트래픽 제어가 가능한 현상을 통해 브릿지 모드가 IP 계층이 아닌 MAC 주소 계층에서 '투명하게' 동작한다는 개념을 실제 현상과 연결하여 검증할 수 있었습니다.

---

#### 마치며
1차 실습 기록을 통해 방화벽의 기본적인 네트워크 구성 요소를 확인했습니다. L3 라우터 모드에서 IP 주소와 라우팅 테이블을 기반으로 경로를 제어하는 과정, NAT를 통해 사설과 공인 IP 주소가 변환되는 물리적 동작 그리고 L2 브릿지 모드에서 IP 설정 없이 투명하게 보안 기능을 적용하는 과정을 검증하며 각 모드의 동작 원리와 차이점을 명확히 구분했습니다.

<hr class="short-rule">