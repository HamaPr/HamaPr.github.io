---
layout: post
title: BLUEMAX NGF 실습 기록 (2/3) - HA 이중화와 IPsec VPN 구성
date: 2025-07-17 17:00:00 +0900
categories: [bluemax-ngf]
tags: [Firewall, BLUEMAX, HA, High-Availability, VPN, IPsec]
---

BLUEMAX NGF(Next-Generation Firewall)의 고가용성(HA, High Availability) 및 가상 사설망(VPN, Virtual Private Network) 기능 구현에 대한 실습을 진행했습니다. 본 기록은 두 대의 방화벽 장비를 Active-Active 모드로 이중화하여 서비스 연속성을 확보하는 과정과 IPsec VPN 기술을 이용해 원격지의 두 네트워크를 암호화된 터널로 안전하게 연결하는 절차를 기술합니다. 모든 설정은 CLI 명령어와 웹 UI를 통해 장비에 직접 적용하고 상태 변화를 관찰하여 검증했습니다.

---

### 1. Active-Active 모드 고가용성(HA) 구성

#### ***학습 목표***
두 대의 방화벽 장비를 Active-Active 클러스터로 구성하여 하나의 논리적 단위처럼 동작하게 하는 것을 목표로 합니다. 가상 IP(VIP)를 설정하여 내부 클라이언트에게 단일 게이트웨이 주소를 제공하고, 한쪽 장비에 장애가 발생했을 때 서비스 중단 없이 다른 장비가 트래픽을 처리하는지 확인합니다.

#### ***실습 내용***
1.  두 대의 방화벽(Master, Slave)에 각각 고유 ID(`NGF-0101`, `NGF-0202`)와 역할에 따른 우선순위(Master 16, Slave 1)를 부여했습니다.
2.  두 장비가 서로의 상태를 실시간으로 감시하고 정보를 동기화하는 데 사용할 HA 전용 인터페이스(`eth3`)를 설정하고 물리적으로 연결했습니다. (`1.1.1.1/30`, `1.1.1.2/30`)
3.  내부망(`eth4`)과 외부망(`eth1`)에 대해 두 장비가 공유할 가상 IP(VIP) 주소를 생성했습니다. 내부 PC들은 이 VIP(`192.168.15.1`)를 게이트웨이로 사용하도록 설정했습니다.
4.  Master 장비의 외부 네트워크 케이블을 물리적으로 분리하여 강제로 장애 상황을 만들었습니다.
5.  CLI에서 `ha show status` 및 `ha show vip` 명령어를 실행하여 VIP의 소유권(state)이 Master에서 Slave로 이전되었는지 확인했습니다.

#### ***실습 후기***
물리적 장애 발생 시, 내부 사용자의 PC 설정 변경 없이도 외부 통신이 정상적으로 유지되는 것을 확인했습니다. CLI 상태 정보에서 Master 장비의 우선순위(priority) 값이 급격히 감소하고 VIP의 `state`가 `master`에서 `backup`으로 Slave 장비에서는 `backup`에서 `master`로 변경되는 것을 관찰했습니다. 이를 통해 HA의 핵심은 물리적 IP가 아닌 '가상 IP'이며 서비스 연속성은 이 VIP의 소유권을 동적으로 이전함으로써 보장된다는 원리를 검증했습니다.

---

### 2. HA 고급 기능 - 멤버별 NAT 정책 적용

#### ***학습 목표***
Active-Active HA 환경에서 각 멤버 장비가 서로 다른 외부 공인 IP를 사용하여 인터넷에 접속하도록 NAT 정책을 분리하여 설정하는 것을 목표로 합니다. 이를 통해 특정 장비에 장애가 발생하면 해당 장비의 NAT 정책을 사용하는 트래픽이 다른 멤버의 회선으로 자동 우회되는지 확인합니다.

#### ***실습 내용***
1.  NAT 정책의 고급 설정에서 'HA 멤버별 NAT 설정' 옵션을 활성화했습니다.
2.  Master 장비(`NGF-0101`)를 통과하는 트래픽은 `10.10.31.150`으로 Slave 장비(`NGF-0202`)를 통과하는 트래픽은 `10.10.31.151`로 변환되도록 각각의 NAT 규칙을 설정했습니다.
3.  외부망 가상 IP(VIP) 설정을 변경하여 Master는 `10.10.31.150`(VRID 2)을 Slave는 `10.10.31.151`(VRID 3)을 사용하도록 구성했습니다.
4.  Master 장비의 인터넷 회선을 차단하자 `ha show vip` 상태에서 Master VIP의 우선순위가 감소하고 Slave VIP의 우선순위가 높아지며 트래픽이 Slave의 NAT 정책을 따라 정상 통신되는 것을 확인했습니다.

#### ***실습 후기***
멤버별 NAT 설정을 통해 HA 클러스터가 단순 장애 극복을 넘어 다중 회선을 효율적으로 사용하는 로드 밸런싱(Load Balancing) 및 회선 이중화의 역할까지 수행할 수 있음을 확인했습니다. VIP의 우선순위(priority) 값이 회선 상태와 연동되어 동적으로 변화하며 트래픽 경로를 제어하는 과정을 통해 HA가 L3 라우팅 프로토콜과 유사한 방식으로 최적의 경로를 찾아내는 메커니즘을 내장하고 있음을 검증했습니다.

---

### 3. IPsec VPN을 통한 사이트 간 보안 터널링

#### ***학습 목표***
인터넷과 같은 공중망 구간에 암호화된 가상 터널을 생성하여 본사(센터)와 지사(지점)의 내부 네트워크가 서로 안전하게 통신할 수 있도록 IPsec VPN을 설정하는 것을 목표로 합니다.

#### ***실습 내용***
1.  VPN 통신에 사용할 암호화 및 인증 알고리즘(AES256, SHA256)과 키 교환 방식(IKEv2)을 정의하는 보안 정책을 생성했습니다.
2.  센터 장비에 원격지인 지점의 정보(지점 ID, 비밀번호, 외부 공인 IP)를 '지점 등록' 메뉴를 통해 추가했습니다.
3.  터널링으로 연결할 양쪽 내부 네트워크 대역을 객체로 등록했습니다. (센터 측: `$센터 192.168.12.0/24`, `$지점 192.168.15.0/24`)
4.  지점 장비에서는 '지점 연결 설정'을 활성화하고 연결할 센터 장비의 공인 IP 주소(`10.10.31.120`)와 인증 정보를 입력했습니다.
5.  설정 완료 후, 지점의 내부 PC에서 센터의 내부 PC로 `ping` 테스트를 수행하여 VPN 터널을 통한 통신이 정상적으로 수립되었는지 검증했습니다. CLI에서 `mp` 명령어로 VPN 정책 적용 상태를 확인했습니다.

#### ***실습 후기***
VPN 설정 전에는 공중망을 통해 라우팅 경로가 존재하지 않아 서로 통신이 불가능했던 두 사설 네트워크 대역이 VPN 터널 설정 후에는 마치 직접 연결된 것처럼 통신이 가능해지는 것을 확인했습니다. 이는 IPsec VPN이 기존 IP 패킷을 암호화하고 새로운 IP 헤더로 감싸는(Encapsulation) '터널링' 기술을 사용함으로써 공중망을 안전한 사설망처럼 사용할 수 있게 해준다는 핵심 원리를 실증적으로 보여준 것입니다.

---

#### 마치며
2차 실습을 통해 서비스의 안정성과 통신의 보안성을 확보하는 핵심 기술들을 검증했습니다. HA 이중화 구성으로 하드웨어 장애 발생 시에도 중단 없는 서비스를 제공할 수 있음을 확인했고 IPsec VPN 설정을 통해 물리적으로 떨어진 네트워크를 논리적으로 안전하게 연결하는 방법을 체득했습니다. 이는 단일 장비의 운영을 넘어 다중 장비와 복합적인 네트워크 환경을 관리하기 위한 필수적인 기술 요소들을 확인하는 과정이었습니다.

<hr class="short-rule">