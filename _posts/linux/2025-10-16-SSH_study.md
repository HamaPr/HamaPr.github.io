---
layout: post
title: "SSH"
date: 2025-10-16 17:00:00 +0900
categories: [linux]
---

## 1. 개요

**SSH (Secure Shell)**는 네트워크를 통해 원격 컴퓨터에 안전하게 접속하기 위한 암호화 프로토콜이다.
과거의 Telnet과 달리 모든 통신 내용(비밀번호 포함)을 암호화하여 전송하므로 도청(Sniffing)으로부터 안전하다.
단순한 터미널 접속뿐만 아니라 파일 전송(SCP/SFTP), 포트 포워딩(Tunneling) 등 다양한 기능을 제공한다.

### 기본 정보
*   **포트**: 22 (TCP)
*   **패키지**: `openssh-server` (서버), `openssh-clients` (클라이언트)
*   **설정 파일**: `/etc/ssh/sshd_config` (서버 설정)

### 인증 방식
1.  **비밀번호 인증**: 계정 비밀번호를 입력하여 접속 (기본)
2.  **공개키 인증 (Key Pair)**: 클라이언트의 공개키를 서버에 등록하여 비밀번호 없이 안전하게 접속

---

## 2. 서버 설정 (sshd_config)

SSH 서버의 보안을 강화하기 위해 설정 파일을 수정한다.

```bash
vi /etc/ssh/sshd_config
```

### 주요 보안 설정
```ini
# 포트 변경 (보안상 권장)
Port 2222

# 루트 로그인 차단 (필수 권장)
PermitRootLogin no

# 비밀번호 인증 차단 (키 인증만 허용 시)
PasswordAuthentication no

# 빈 암호 허용 금지
PermitEmptyPasswords no
```

설정 변경 후 반드시 서비스를 재시작해야 적용된다.
```bash
systemctl restart sshd
```

---

## 3. 공개키 인증 방식 (Key Pair)

비밀번호 입력 없이 안전하게 접속하기 위해 SSH 키 쌍을 생성하고 등록한다.

### 1단계: 키 생성 (클라이언트)
```bash
ssh-keygen -t rsa -b 4096
# 엔터를 누르면 ~/.ssh/id_rsa (개인키)와 id_rsa.pub (공개키) 생성됨
```

### 2단계: 키 전송 (서버로 복사)
```bash
ssh-copy-id -p 22 user@10.0.0.11
# 또는 직접 복사하여 서버의 ~/.ssh/authorized_keys 파일에 추가
```

### 3단계: 접속 테스트
```bash
ssh -p 22 user@10.0.0.11
# 비밀번호를 묻지 않고 접속되면 성공
```

---

## 4. 실습: 포트 포워딩

SSH 터널링을 이용해 방화벽 내부의 서비스에 접근하거나 통신을 암호화한다.

### 로컬 포트 포워딩
내 PC의 포트(Local)를 통해 원격 서버 내부의 포트(Remote)로 접속한다.
*   **상황**: 외부에서 접속 불가능한 DB 서버(10.0.0.11:3306)에 SSH 서버(10.0.0.10)를 거쳐 접속하고 싶음.
```bash
# 내 PC의 9999 포트를 10.0.0.11의 3306 포트로 연결
ssh -L 9999:10.0.0.11:3306 user@10.0.0.10
```
이제 내 PC에서 `localhost:9999`로 접속하면 원격 DB에 연결된다.

![SSH 포트포워딩](/assets/images/linux/ssh-session-server1.png)

<hr class="short-rule">
