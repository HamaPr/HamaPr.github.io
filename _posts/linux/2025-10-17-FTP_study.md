---
layout: post
title: "FTP 서버 구축 (vsftpd)"
date: 2025-10-17 17:30:00 +0900
categories: [linux]
---

## 1. 개념

**FTP (File Transfer Protocol)**는 네트워크를 통해 파일을 전송하는 프로토콜.

### 기본 정보

| 항목 | 내용 |
|------|------|
| 포트 | 21(제어), 20(데이터) - TCP |
| 보안 | 평문 전송 (SFTP/FTPS 권장) |

### FTP vs SFTP vs FTPS

| 구분 | FTP | SFTP | FTPS |
|------|-----|------|------|
| 암호화 | ❌ | ✅ (SSH) | ✅ (SSL/TLS) |
| 포트 | 21 | 22 | 990 |
| 방화벽 | 복잡 | 간단 | 복잡 |

### 동작 모드
- **Active Mode**: 서버가 클라이언트로 연결 (방화벽 문제 발생)
- **Passive Mode**: 클라이언트가 서버로 연결 (권장)

---

## 2. 설치 방법

### Rocky Linux / CentOS
```bash
# vsftpd 설치
dnf install -y vsftpd

# 서비스 시작
systemctl enable --now vsftpd

# 방화벽 허용
firewall-cmd --permanent --add-service=ftp
firewall-cmd --reload
```

---

## 3. 사용법

### FTP 사용자 추가
```bash
# 사용자 생성
useradd ftpuser
passwd ftpuser

# 홈 디렉토리 권한 설정
chmod 755 /home/ftpuser
```

### 기본 설정 (/etc/vsftpd/vsftpd.conf)
```conf
anonymous_enable=NO         # 익명 접속 차단
local_enable=YES            # 로컬 사용자 허용
write_enable=YES            # 쓰기 허용
chroot_local_user=YES       # 홈 디렉토리로 제한
allow_writeable_chroot=YES  # chroot 쓰기 허용
```

### 설정 적용
```bash
systemctl restart vsftpd
```

---

## 4. 실습 예시

### 클라이언트 테스트
```bash
# Linux
ftp 10.0.0.11
# 또는
lftp -u ftpuser 10.0.0.11

# Windows
ftp 10.0.0.11
# 또는 FileZilla 사용
```

### 주요 명령어

| 명령어 | 설명 |
|--------|------|
| put | 업로드 |
| get | 다운로드 |
| ls | 목록 보기 |
| cd | 디렉토리 이동 |
| bye | 종료 |

### xferlog 분석 상세

FTP 전송 로그 파일로 파일 송수신 기록 확인 가능.

| 항목 | 설명 |
|------|------|
| 위치 | `/var/log/xferlog` |
| 설정 | `xferlog_enable=YES` |

### xferlog 형식
```
Mon Dec 20 15:30:45 2024 1 192.168.1.100 1048576 /home/ftpuser/file.zip b _ i r ftpuser ftp 0 * c
```

| 필드 | 예시 | 설명 |
|------|------|------|
| 1-4 | Mon Dec 20 15:30:45 2024 | 전송 완료 시간 |
| 5 | 1 | 전송 시간 (초) |
| 6 | 192.168.1.100 | 클라이언트 IP |
| 7 | 1048576 | 파일 크기 (bytes) |
| 8 | /home/ftpuser/file.zip | 파일 경로 |
| 9 | b | 전송 유형 (a=ASCII, b=Binary) |
| 10 | _ | 특수 플래그 |
| 11 | i | 방향 (i=upload, o=download) |
| 12 | r | 사용자 유형 (r=real user) |
| 13 | ftpuser | 사용자명 |
| 14 | ftp | 서비스명 |
| 15 | 0 | 인증 방식 |
| 16 | * | 인증 사용자 |
| 17 | c | 완료 상태 (c=complete, i=incomplete) |

### 로그 분석 예시
```bash
# 업로드된 파일 확인
grep " i r " /var/log/xferlog

# 다운로드된 파일 확인
grep " o r " /var/log/xferlog

# 특정 사용자 활동
grep "ftpuser" /var/log/xferlog

# 실패한 전송
grep " i$" /var/log/xferlog
```

### vsftpd.conf 로그 설정
```conf
xferlog_enable=YES           # xferlog 활성화
xferlog_file=/var/log/xferlog
xferlog_std_format=YES       # 표준 형식 사용
log_ftp_protocol=YES         # FTP 명령어 로그
dual_log_enable=YES          # 두 가지 로그 형식
```

---

## 5. 삭제 방법

```bash
systemctl stop vsftpd
systemctl disable vsftpd
dnf remove -y vsftpd
rm -rf /etc/vsftpd
userdel -r ftpuser
```

<hr class="short-rule">
