---
layout: post
title: "Tar"
date: 2025-06-16 17:00:00 +0900
categories: [linux]
---

## 1. 개요

**tar (Tape Archive)**는 리눅스 환경에서 다수의 파일과 디렉터리를 하나의 아카이브 파일로 묶거나 풀 때 사용하는 표준 도구이다.
파일의 권한(Permission), 소유자, 타임스탬프 등의 속성을 그대로 유지하므로 시스템 백업 용도로 널리 사용된다.
보통 `gzip`, `bzip2`, `xz` 등의 압축 도구와 결합하여 용량을 줄여서 저장한다.

### 압축 알고리즘 비교

| 형식 | 확장자 | 옵션 | 압축률 | 속도 | 용도 |
|------|--------|------|--------|------|------|
| **gzip** | `.tar.gz` | `-z` | 보통 | 빠름 | 일반적인 배포 및 백업 |
| **bzip2** | `.tar.bz2` | `-j` | 높음 | 보통 | 커널 소스 등 고압축 필요 시 |
| **xz** | `.tar.xz` | `-J` | 매우 높음 | 느림 | 최신 패키지 배포 |

---

## 2. 사용법

tar 명령어는 옵션을 조합하여 다양한 동작을 수행한다. 가장 흔히 쓰이는 옵션은 `cvf` (생성)와 `xvf` (추출)이다.

### 주요 옵션
*   `-c` (Create): 새로운 아카이브 생성
*   `-x` (Extract): 아카이브 풀기
*   `-v` (Verbose): 처리 과정 출력
*   `-f` (File): 파일명 지정 (필수)
*   `-C` (Change directory): 특정 경로에 풀기

### 아카이브 생성 (백업)
```bash
# 기본 tar 아카이브 (압축 안 함)
tar -cvf backup.tar /home/user/data

# gzip 압축 (가장 많이 사용)
tar -czvf backup.tar.gz /home/user/data

# xz 압축 (용량 최소화)
tar -cJvf backup.tar.xz /home/user/data
```

### 아카이브 추출 (복구)
```bash
# 현재 폴더에 풀기
tar -xzvf backup.tar.gz

# 특정 디렉터리(/tmp/restore)에 풀기
tar -xzvf backup.tar.gz -C /tmp/restore

# 특정 파일만 골라서 풀기
tar -xzvf backup.tar.gz ./secret.txt
```

---

## 3. 실습: 백업 전략

### 원격 백업 (SSH Pipe)
로컬 디스크 공간이 부족할 때, SSH를 통해 압축 데이터를 원격 서버로 바로 전송한다.
```bash
# 로컬 데이터를 압축하여 원격 서버에 저장
tar -czvf - /data/important | ssh user@backup-server "cat > /backup/data.tar.gz"
```

### 증분 백업 (Incremental Backup)
매번 전체 백업을 하는 대신, 변경된 파일만 백업하여 시간과 공간을 절약한다.
```bash
# Full Backup (스냅샷 파일 생성)
tar -czvf full-backup.tar.gz --listed-incremental=backup.snar /data

# Incremental Backup (스냅샷 참조하여 변경분만 백업)
tar -czvf incr-backup-1.tar.gz --listed-incremental=backup.snar /data
```

### 예외 처리 (Exclude)
로그 파일이나 임시 파일 등 불필요한 데이터를 제외하고 백업한다.
```bash
tar -czvf app-backup.tar.gz --exclude="*.log" --exclude="tmp/" /var/www/html
```

![tar 압축 및 추출](/assets/images/linux/tar.png)

---

## 4. 트러블슈팅

### 대용량 파일 분할
FAT32 파일 시스템 등으로 인해 단일 파일 크기 제한이 있는 경우 `split` 명령어로 쪼개서 저장한다.
```bash
# 1GB 단위로 분할 압축
tar -czvf - /data | split -b 1G - backup.tar.gz.part

# 분할 파일 합쳐서 해제
cat backup.tar.gz.part* | tar -xzvf -
```

### 권한 문제 (Root 권한)
시스템 백업 시 파일의 소유자와 권한을 완벽하게 보존하려면 반드시 `root` 권한으로 실행하거나 `--same-owner` 옵션을 사용해야 한다. (추출 시에도 마찬가지)

---

## 5. 보안 고려사항

*   **절대 경로 압축 해제 주의**: 악의적으로 조작된 tar 아카이브는 절대 경로(`/etc/passwd`)를 포함하여 시스템 파일을 덮어쓸 수 있다. 신뢰할 수 없는 출처의 아카이브는 `--strip-components` 옵션으로 경로를 제거하거나 격리된 환경에서 추출한다.
*   **심볼릭 링크 공격**: 아카이브 내 심볼릭 링크가 민감한 시스템 파일을 가리키도록 조작될 수 있다. 추출 전 `-tvf` 옵션으로 내용을 먼저 확인한다.
*   **권한 유지**: `-p` 옵션은 SUID/SGID 비트를 포함한 권한을 그대로 복원하므로, 악성 파일에 실행 권한이 부여될 수 있어 주의가 필요하다.

<hr class="short-rule">
