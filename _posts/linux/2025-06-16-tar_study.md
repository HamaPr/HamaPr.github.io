---
layout: post
title: "tar 아카이빙 및 압축 심화"
date: 2025-06-16 17:00:00 +0900
categories: [linux]
---

## 1. 개념

**tar (Tape Archive)**는 여러 파일과 디렉터리를 하나의 아카이브 파일로 묶는 리눅스 표준 도구입니다.
파일의 권한과 속성을 유지하며, 주로 백업이나 소프트웨어 배포 시 gzip 등의 압축 도구와 결합하여 사용됩니다.

### 기본 정보

| 항목 | 설명 |
|------|------|
| 기본 기능 | 파일 묶기 (아카이빙) |
| 압축 도구 | gzip, bzip2, xz |
| 확장자 | `.tar`, `.tar.gz`, `.tar.bz2`, `.tar.xz` |

### 압축 알고리즘 비교

| 알고리즘 | 확장자 | 옵션 | 압축률 | 속도 |
|----------|--------|------|--------|------|
| gzip | `.gz` | `-z` | 보통 | 빠름 |
| bzip2 | `.bz2` | `-j` | 높음 | 보통 |
| xz | `.xz` | `-J` | 최고 | 느림 |

---

## 2. 사용법

### 기본 옵션

| 옵션 | 설명 |
|------|------|
| `-c` | 아카이브 생성 (Create) |
| `-x` | 아카이브 추출 (eXtract) |
| `-v` | 진행 상황 출력 (Verbose) |
| `-f` | 파일명 지정 (File) |
| `-t` | 내용 목록 보기 (lisT) |
| `-C` | 추출 경로 지정 |

### 아카이브 생성
```bash
# 기본 tar 아카이브
tar -cvf archive.tar /path/to/dir

# gzip 압축
tar -czvf archive.tar.gz /path/to/dir

# bzip2 압축
tar -cjvf archive.tar.bz2 /path/to/dir

# xz 압축
tar -cJvf archive.tar.xz /path/to/dir
```

### 아카이브 추출
```bash
# tar 추출
tar -xvf archive.tar

# gzip 추출
tar -xzvf archive.tar.gz

# 특정 경로에 추출
tar -xzvf archive.tar.gz -C /target/path

# 특정 파일만 추출
tar -xzvf archive.tar.gz file1.txt
```

### 아카이브 내용 확인
```bash
# 목록만 확인 (추출 안 함)
tar -tvf archive.tar.gz
```

---

## 3. 실습 예시

### 절대 경로 vs 상대 경로
```bash
# 절대 경로로 아카이브 (비권장)
tar -cvf backup.tar /home/user/data
# 추출 시 /home/user/data에 덮어씀

# 상대 경로로 아카이브 (권장)
cd /home/user
tar -cvf backup.tar data/
# 추출 시 현재 디렉터리에 data/ 생성
```

### 파이프를 활용한 원격 백업
```bash
# SSH를 통한 원격 백업
tar -czvf - /data | ssh user@remote "cat > /backup/data.tar.gz"

# 원격 서버에서 로컬로 추출
ssh user@remote "cat /backup/data.tar.gz" | tar -xzvf - -C /restore
```

### 증분 백업
```bash
# 스냅샷 파일 생성 (첫 번째 백업)
tar -czvf backup-full.tar.gz --listed-incremental=snapshot.snar /data

# 증분 백업 (변경분만)
tar -czvf backup-incr.tar.gz --listed-incremental=snapshot.snar /data
```

### 특정 파일 제외
```bash
# --exclude 옵션
tar -czvf backup.tar.gz --exclude="*.log" --exclude="cache/" /data

# exclude 파일 사용
echo "*.log" > exclude.txt
echo "cache/" >> exclude.txt
tar -czvf backup.tar.gz -X exclude.txt /data
```

![tar 압축 및 추출](/assets/images/linux/tar.png)

---

## 4. 트러블슈팅

### 권한 보존
```bash
# 권한 보존하여 추출 (root)
tar -xzvf backup.tar.gz --preserve-permissions

# 소유자 무시 (일반 사용자)
tar -xzvf backup.tar.gz --no-same-owner
```

### 대용량 파일 분할
```bash
# 분할 압축
tar -czvf - /data | split -b 1G - backup.tar.gz.part

# 분할 파일 합치기 및 추출
cat backup.tar.gz.part* | tar -xzvf -
```

### 손상된 아카이브 복구
```bash
# gzip 파일 검증
gzip -t archive.tar.gz

# 강제 추출 시도
tar -xzvf archive.tar.gz --ignore-zeros
```

<hr class="short-rule">
