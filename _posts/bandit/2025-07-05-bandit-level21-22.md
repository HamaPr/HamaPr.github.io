---
layout: post
title: "[Bandit] Level 21 → Level 22"
date: 2025-07-05 09:02:00 +0900
categories: [bandit]
tags: [overthewire, bandit, linux, cron, cronjob]
---

## 1. 문제 개요

> **Level Goal**
> 
> A program is running automatically at regular intervals from **cron**, the time-based job scheduler. Look in `/etc/cron.d/` for the configuration and see what command is being executed.

이번 레벨부터는 리눅스의 스케줄링 도구인 **Cron**을 다룹니다. "누가, 언제, 어떤 명령어를 실행할지" 설정된 정보를 찾아내어, 시스템이 자동으로 수행하는 작업을 분석해야 했습니다.

---

## 2. 사용 명령어

| 명령어 | 설명 |
|--------|------|
| `/etc/cron.d/` | 시스템 전체 Cron 설정 파일들이 모여있는 디렉토리 |
| `cat` | 파일 내용 확인 |

---

## 3. 풀이 과정

`bandit21` 계정으로 로그인합니다.

```bash
ssh bandit21@bandit.labs.overthewire.org -p 2220
```

### 1. Cron 작업 확인
먼저 `/etc/cron.d/` 디렉토리에 어떤 예약 작업들이 있는지 살펴봅니다.

```bash
bandit21@bandit:~$ ls /etc/cron.d/
cronjob_bandit22  cronjob_bandit23  cronjob_bandit24  ...
```
`cronjob_bandit22`라는 파일이 눈에 띕니다. 우리는 다음 레벨(`bandit22`)의 권한을 얻고 싶으므로 이 파일을 살펴봐야 합니다.

### 2. 작업 내용 분석
`cronjob_bandit22` 파일을 열어보니 `/usr/bin/cronjob_bandit22.sh`라는 스크립트를 매분마다 실행하고 있습니다.

```bash
bandit21@bandit:~$ cat /etc/cron.d/cronjob_bandit22
@reboot bandit22 /usr/bin/cronjob_bandit22.sh &> /dev/null
* * * * * bandit22 /usr/bin/cronjob_bandit22.sh &> /dev/null
```

**Cron 문법 해석**:
- `* * * * *`: 1분마다 실행
- `bandit22`: 실행하는 사용자
- `/usr/bin/cronjob_bandit22.sh`: 실행할 명령어 (스크립트)
  
즉, 이 설정은 **"bandit22 사용자의 권한으로 매분마다 저 스크립트를 실행해라"** 라는 뜻입니다.

### 3. 스크립트 분석
실행되는 쉘 스크립트(`cronjob_bandit22.sh`)의 내용을 확인해 봅니다.

```bash
bandit21@bandit:~$ cat /usr/bin/cronjob_bandit22.sh
#!/bin/bash
chmod 644 /tmp/t7eJTf5iO31221
cat /etc/bandit_pass/bandit22 > /tmp/t7eJTf5iO31221
```

**스크립트 해석**:
1. `chmod 644 ...`: `/tmp/t7eJTf5iO31221` 파일의 권한을 `644` (누구나 읽기 가능)로 변경합니다.
2. `cat ... > ...`: `bandit22`의 원래 비밀번호 파일을 읽어서 저 임시 파일(`/tmp/t7eJTf5iO31221`)에 덮어씁니다.

결론: `bandit22`의 비밀번호가 `/tmp/t7eJTf5iO31221` 파일에 누구나 읽을 수 있게 복사되어 있습니다!

### 4. 결과 파일 확인
스크립트 분석 결과, 비밀번호가 `/tmp/t7eJTf5iO31221` 파일에 저장된다는 것을 알아냈습니다. 내용을 확인해 봅니다.

```bash
bandit21@bandit:~$ cat /tmp/t7eJTf5iO31221
WdDozAdTMiXQGAcoE3TrA5n2i7I4p45v
```

---

## 4. 결과

<details markdown="1">
<summary>비밀번호 확인</summary>

```
WdDozAdTMiXQGAcoE3TrA5n2i7I4p45v
```

</details>

---

## 5. 배운 점

1. **Cron의 동작 방식**: 리눅스 서버 관리의 핵심입니다. 주기적인 백업, 로그 정리, 상태 점검 등을 자동화할 때 사용합니다.
2. **역분석 (Reverse Engineering)**: 실행 결과를 바로 볼 수 없을 때, 설정 파일(`cron.d`) -> 실행 스크립트(`.sh`) -> 결과 파일 순서로 추적하여 시스템의 동작을 파악하는 방법을 익혔습니다.

---

## 6. 보안 관점

- **Cron 작업의 보안 위험**: 만약 Cron으로 관리자(root) 권한의 스크립트가 실행되는데, 그 스크립트 파일에 **쓰기 권한**이 아무에게나 열려 있다면?
  - 일반 사용자가 그 스크립트 내용을 `rm -rf /`나 `cat /etc/shadow` 같은 악성 명령어로 바꿔치기할 수 있습니다. 그러면 Cron이 실행될 때 관리자 권한으로 해킹이 이루어집니다.
- 따라서 Cron에 등록된 스크립트 파일의 권한 관리는 매우 중요합니다.

<hr class="short-rule">