---
layout: post
title: "[Bandit] Level 19 → Level 20"
date: 2025-06-28 09:05:00 +0900
categories: [bandit]
tags: [overthewire, bandit, linux, setuid, suid]
---

## 1. 문제 개요

> **Level Goal**
> 
> To gain access to the next level, you should use the **setuid binary** in the home directory. Execute it without arguments to find out how to use it. The password for the next level is stored in `/etc/bandit_pass/bandit20`.

리눅스 권한 관리의 **핵심 개념인 SetUID**를 배우게 된 레벨입니다. 일반 사용자(`bandit19`)는 `/etc/bandit_pass/bandit20` 파일을 읽을 수 없습니다. 하지만 **SetUID가 설정된 프로그램**을 이용하면 일시적으로 `bandit20` 사용자의 권한을 빌려서 파일을 읽을 수 있다는 것을 알았습니다.

---

## 2. 사용 명령어

| 명령어 | 설명 |
|--------|------|
| `ls -l` | 파일의 상세 권한 확인 |
| `SetUID` | 파일 실행 시 실행한 사람이 아닌 **파일 소유자의 권한**으로 실행되게 하는 특수 권한 |

---

## 3. 풀이 과정

`bandit19` 계정으로 로그인합니다.

```bash
ssh bandit19@bandit.labs.overthewire.org -p 2220
```

### 1. 파일 확인
홈 디렉토리에 `bandit20-do`라는 파일이 있습니다.
소유자가 `bandit20`이고 `s`(SetUID) 권한이 있습니다.
즉, "나는 `bandit19`지만, 이 프로그램을 실행하는 동안만큼은 `bandit20`이 된다"는 뜻입니다.

```bash
bandit19@bandit:~$ ls -l bandit20-do
-rwsr-x--- 1 bandit20 bandit19 14876 ... bandit20-do
```

**권한 분석**: `-rwsr-x---`
- 소유자: `bandit20`
- 권한: `rws` (Read, Write, **SetUID**)
- `x` 대신 `s`가 적혀있다면 **SetUID/SetGID**가 설정된 것입니다.
- 이 파일은 누가 실행하든 **실행하는 동안에는 `bandit20`의 권한**을 갖게 됩니다.

### 2. 사용법 파악 및 실행
그냥 실행해보면 사용법을 알려줍니다.
`./bandit20-do <command>`
뒤에 명령어를 입력하면 `bandit20`의 권한으로 실행해준다고 합니다.

```bash
bandit19@bandit:~$ ./bandit20-do
Run a command as another user.
  Example: ./bandit20-do id
```

우리의 목표는 `/etc/bandit_pass/bandit20` 파일을 읽는 것입니다.
그냥 `cat` 하면 권한이 없어 못 읽지만, `bandit20-do`를 통해서 읽으면 읽을 수 있습니다.

```bash
bandit19@bandit:~$ ./bandit20-do cat /etc/bandit_pass/bandit20
GbKksEFF4yrVs6il55v6gwY5aVje5f0j
```

---

## 4. 결과

<details markdown="1">
<summary>비밀번호 확인</summary>

```
GbKksEFF4yrVs6il55v6gwY5aVje5f0j
```

</details>

---

## 5. 배운 점

1. **SetUID (Set User ID)**: 리눅스에서 일반 사용자가 `passwd` 명령어(비밀번호 변경)를 쓸 수 있는 이유도 `passwd` 파일에 SetUID가 걸려있어 `root` 권한으로 실행되기 때문입니다.
2. **권한 상승 (Privilege Escalation)**: 낮은 권한의 사용자가 시스템의 취약점이나 설정 미스(SetUID 파일 등)를 이용해 높은 권한을 얻는 것을 말합니다.

---

## 6. 보안 관점

- **가장 위험한 권한**: 관리자 입장에서 SetUID 파일은 잠재적인 보안 폭탄입니다. 만약 SetUID가 걸린 프로그램에 버그(오버플로우 등)가 있다면, 공격자는 이를 이용해 손쉽게 루트 권한을 탈취(Rooting)할 수 있습니다.
- 따라서 불필요한 SetUID 파일은 주기적으로 점검하여 제거해야 합니다.
  ```bash
  # 시스템 내 모든 SetUID 파일 검색
  find / -perm -4000 2>/dev/null
  ```

<hr class="short-rule">