---
layout: post
title: "[Bandit] Level 22 → Level 23"
date: 2025-07-05 09:03:00 +0900
categories: [bandit]
tags: [overthewire, bandit, linux, cron, md5sum, cut]
---

## 1. 문제 개요

> **Level Goal**
> 
> A program is running automatically at regular intervals from cron. Look in `/etc/cron.d/` for the configuration and see what command is being executed.

이전 레벨과 비슷하지만, 이번에는 스크립트가 정직하게 파일명을 알려주지 않습니다. 실행되는 스크립트를 분석해서 비밀번호가 **어떤 파일명으로 저장되는지** 직접 알아내야 했습니다.

---

## 2. 사용 명령어

| 명령어 | 설명 |
|--------|------|
| `md5sum` | 데이터의 MD5 해시값(지문)을 계산 |
| `cut -d '[구분자]' -f [필드번호]` | 문자열을 구분자로 잘라서 특정 부분만 가져옴 |
| `echo $mytarget` | 변수(`$mytarget`)에 들어있는 값을 출력 |

---

## 3. 풀이 과정

`bandit22` 계정으로 로그인합니다.

```bash
ssh bandit22@bandit.labs.overthewire.org -p 2220
```

### 1. Cron 작업 확인
이번에도 `/etc/cron.d/`를 확인합니다. `cronjob_bandit23` 파일이 있습니다.

```bash
bandit22@bandit:~$ cat /etc/cron.d/cronjob_bandit23
* * * * * bandit23 /usr/bin/cronjob_bandit23.sh &> /dev/null
```
`bandit23` 권한으로 `/usr/bin/cronjob_bandit23.sh`가 실행되고 있군요.

### 2. 스크립트 분석
`/usr/bin/cronjob_bandit23.sh` 내용을 봅니다.

```bash
bandit22@bandit:~$ cat /usr/bin/cronjob_bandit23.sh
#!/bin/bash

myname=$(whoami)
mytarget=$(echo I am user $myname | md5sum | cut -d ' ' -f 1)

echo "Copying passwordfile /etc/bandit_pass/$myname to /tmp/$mytarget"

cat /etc/bandit_pass/$myname > /tmp/$mytarget
```

**스크립트 로직 해석**:
1. `whoami`: 현재 실행 중인 사용자의 이름을 가져옵니다. (Cron에서 실행되면 **bandit23**이 됩니다)
2. `md5sum`: "I am user bandit23"라는 문자열을 MD5 해시로 바꿉니다.
3. `cut`: 해시값 뒤에 붙는 공백과 `-` 기호를 잘라내고 순수 해시값만 남깁니다.
4. `cat ...`: 비밀번호를 `/tmp/[해시값]` 파일에 저장합니다.

### 3. 코드 해석 및 시뮬레이션
스크립트는 `$myname` 변수를 가지고 MD5 해시를 만든 뒤, 그 값을 파일명으로 하여 비밀번호를 저장합니다.
우리가 알고 싶은 건 `bandit23`의 비밀번호이므로, `$myname`이 `bandit23`일 때의 파일명을 알아내야 합니다.

직접 코드를 실행해 봅니다.
우리는 `bandit22`지만, **스크립트가 `bandit23`으로 실행될 때** 어떤 파일명이 만들어질지 똑같이 계산해봐야 합니다.

```bash
# 내가 직접 $myname에 bandit23을 넣어서 돌려본다
bandit22@bandit:~$ echo I am user bandit23 | md5sum | cut -d ' ' -f 1
8ca319486bf5d5c4515479addc805234
```

계산된 해시값(`8ca3...`)이 바로 비밀번호가 저장된 파일의 이름입니다.

4. **비밀번호 확인**:

```bash
bandit22@bandit:~$ cat /tmp/8ca319486bf5d5c4515479addc805234
YkH2SGAfH11sQ17GvD2sXnoP9i4vGg02
```

---

## 4. 결과

<details markdown="1">
<summary>비밀번호 확인</summary>

```
YkH2SGAfH11sQ17GvD2sXnoP9i4vGg02
```

</details>

---

## 5. 배운 점

1. **코드 시뮬레이션**: 남이 짠 코드를 보고, 특정 조건(사용자=bandit23)에서 어떻게 동작할지 머릿속으로 또는 직접 명령어를 쳐서 결과를 예측하는 능력이 중요합니다.
2. **해시**: MD5 같은 해시 함수는 같은 입력에 대해 항상 같은 출력을 뱉습니다. 이를 이용해 예측 가능한 파일명을 만든 것입니다.

---

## 6. 보안 관점

- **예측 가능한 파일명**: 임시 파일이나 백업 파일을 만들 때, 이처럼 날짜나 사용자 이름 등을 해싱해서 사용하는 경우가 많습니다. 하지만 해시 알고리즘과 입력값 패턴("I am user ...")을 알면 공격자도 파일명을 똑같이 만들어낼 수 있습니다.
- 보안을 위해서는 `mktemp` 같이 **무작위 문자열**을 사용하는 것이 안전합니다.

<hr class="short-rule">