---
layout: post
title: "A09:2021 - Security Logging and Monitoring Failures (보안 로깅 및 모니터링 실패) 분석 보고서"
date: 2025-09-02 17:00:00 +0900
categories: [owasp-top-10]
---

### ***프로젝트 9. A09:2021 - Security Logging and Monitoring Failures (보안 로깅 및 모니터링 실패) 분석 보고서***

### 1. 취약점 개요

   보안 로깅 및 모니터링 실패는 '범죄가 발생했지만 현장의 CCTV가 꺼져있어 범인의 인상착의는 물론 침입 사실조차 알 수 없는 상태'를 의미합니다. 아무리 뛰어난 방어 시스템을 갖추었더라도 공격의 징후를 기록하고 · 분석하고 · 경고하는 체계가 없다면 모든 방어는 무용지물입니다. 이 취약점은 침해 사고의 평균 탐지 시간(MTTD)과 평균 대응 시간(MTTR)을 무한정으로 늘려 기업에 회복 불가능한 피해를 입히는 '조용한 암살자'와 같습니다.

   본 보고서는 공격이 발생했을 때 로그에 어떤 흔적이 남는지 · 그 기록이 왜 불충분한지 · 그리고 최종적으로 공격자가 어떻게 그 흔적마저 지우려 시도하는지를 보안 분석가의 관점에서 역추적합니다.

---

### 2. 시나리오 분석 및 재현: 기록되지 않은 위협의 추적

#### ***Part 1. [사건 발생] 불충분한 로깅으로 인해 탐지되지 않는 SQL Injection 공격***

*   ***공격 시나리오:***
   자동화 도구(sqlmap)를 이용한 SQL Injection 공격은 다수의 비정상적인 요청을 발생시키므로 웹 서버 로그에 해당 활동을 위협으로 식별할 수 있는 명확한 기록이 남을 것이라 가정했다.

*   ***분석 및 검증:***
   `sqlmap`을 실행하며 Apache 접근 로그`access.log`를 실시간 모니터링했습니다. 공격은 성공했지만 로그에는 HTTP 요청에 대한 기본 정보(IP · 시간 · 요청 URL)만 기록될 뿐 해당 요청이 애플리케이션에 어떤 영향을 미쳤는지에 대한 보안 관점의 의미는 전혀 담겨있지 않았습니다. 표준 웹 서버 접근 로그는 실패한 로그인 시도, 입력값 검증 실패 등 중요한 보안 사건을 기록하지 못하는 명확한 한계를 보여주었습니다.

   ![monitoring](/assets/images/owasp-top-10/A09_P1-1.png)

*   ***위험성 분석:***
   이처럼 불충분한 로깅은 공격이 발생하는 바로 그 순간에 침입을 탐지하고 차단할 기회를 놓치게 만듭니다. 시스템은 공격을 당하면서도 그 사실을 전혀 인지하지 못하는 '침묵의 피해자' 상태가 됩니다.

>   실시간 탐지는 실패했지만 로그 파일 자체는 남아있습니다. 이제 사고가 발생한 후 보안 분석가가 되어 이 로그 파일에서 공격의 흔적을 찾아낼 수 있는지 분석합니다.

#### ***Part 2. [사후 분석] 의미 없는 기록(URL 인코딩) 속에서 공격의 흔적 찾기***

*   ***공격 시나리오:***
   로그가 보안 이벤트로 분류되지는 않더라도 사후 분석을 위해 로그 파일을 상세히 검토하면 공격에 사용된 악성 페이로드를 식별할 수 있을 것이라 가정했다.

*   ***분석 및 검증:***
   공격 완료 후 `grep` 명령어로 `access.log` 파일에서 `UNION` 키워드를 필터링했습니다. 그 결과 sqlmap이 정보 탈취에 사용한 `UNION` 기반 공격 코드가 URL 인코딩된 상태로 로그에 기록된 것을 확인했습니다.

   ![UNION](/assets/images/owasp-top-10/A09_P2-1.png)

*   ***위험성 분석:***
   이 로그는 공격이 있었다는 사실을 사후에 증명하는 단서는 될 수 있으나 효과적인 감시 시스템이라 부르기에는 부족합니다. 로그 자체에 위험 등급이나 이벤트 종류 같은 분류 정보가 없어 자동화된 시스템이 대규모 로그 속에서 이 특정 항목을 실시간 위협으로 탐지하고 경고하는 것은 사실상 불가능합니다.

> 로그 파일에서 공격이 있었다는 사실을 사후에 증명할 수는 있었습니다. 하지만 공격자가 이 증거 자체를 없애려 한다면 어떻게 될까요?

#### ***Part 3. [증거 인멸] 관리자 권한 탈취 후 로그 파일 삭제 시도와 그 한계***

*   ***공격 시나리오:***
   공격자가 시스템 제어권을 획득한 경우 자신의 공격 흔적을 제거하기 위해 로그 파일을 직접 위변조하거나 삭제할 수 있을 것이다.

*   ***분석 및 검증:***
   1.  **낮은 권한:** 일반 사용자 권한으로는 로그 파일(`access.log`)의 소유자가 `root`이므로 삭제가 거부되었습니다. 이는 운영체제의 파일 권한 설정이 1차 방어선 역할을 함을 의미합니다.
   2.  **관리자 권한:** `sudo` 명령어로 관리자 권한을 획득한 후에는 로그 파일을 성공적으로 삭제할 수 있었습니다.

   ![rm log](/assets/images/owasp-top-10/A09_P3-1.png)

*   ***위험성 분석:***
   이 결과는 서버 내부에만 로그를 저장하는 방식의 근본적인 한계를 보여줍니다. 공격이 고도화되어 관리자 권한까지 탈취당할 경우 모든 범죄의 증거가 사라질 위험이 있습니다. 로그 데이터의 **무결성**과 **가용성**을 보장하기 위한 별도의 안전장치가 반드시 필요합니다.

---

### 3. 원인 및 해결 방안

*   ***원인: '기록되지 않은 것은 존재하지 않는 것'이라는 인식 부재***

보안 로깅 및 모니터링 실패의 근본 원인은 시스템이 공격당했다는 사실 자체를 인지할 수 없도록 설계되었기 때문입니다. 로그인 실패 · 접근 거부 · 입력값 오류 등 공격의 명백한 징후들이 기록되지 않았고 기록되더라도 아무에게도 알려주지 않는(경고 부재) 수동적인 시스템이었던 것이 문제입니다.

*   ***해결 방안: 능동적이고 실행 가능한 로깅 및 모니터링 체계 구축***

   1.  **무엇을 기록할 것인가 Logging:** OWASP Logging Cheat Sheet 등을 참고하여 로그인 성공/실패, 권한 상승 시도, 중요한 비즈니스 로직 접근 등 보안적으로 의미 있는 모든 이벤트를 반드시 기록해야 합니다. 
   2.  **어떻게 기록할 것인가 Formatting:** 모든 로그는 시간 · IP · 사용자 ID · 이벤트 종류 등 일관된 형식으로 기록하여 기계가 분석하기 쉽게 만들어야 합니다.
   3.  **어떻게 대응할 것인가 Monitoring & Alerting:** 생성된 로그는 SIEM(보안 정보 및 이벤트 관리) 시스템과 연동하여 실시간으로 분석해야 합니다. 그리고 '5분 내 100회 로그인 실패'와 같은 임계치 기반의 이상 징후가 탐지되면 즉시 보안팀에 경고`Alert`를 보내는 능동적인 대응 체계를 구축해야 합니다.

---

### 4. 시큐어 코딩: 코드 레벨 분석

***분석 대상:*** DVWA - Command Injection

#### ***취약한 코드 분석 Low Level***

   ![]({{ "/assets/images/owasp-top-10/A09_S-1.png" | relative_url }})  

   *   ***코드 분석:*** 이 코드는 방어와 탐지 모든 면에서 실패합니다. `$_REQUEST['ip']`로 받은 사용자 입력값을 아무런 검증 없이 명령어에 결합하여 `shell_exec()`로 실행합니다. 이는 쉘 메타 문자 `; | && `를 이용한 명령어 인젝션 공격을 허용하는 치명적인 방어 실패입니다. 동시에 이 위험한 명령어가 실행되었다는 사실을 그 어디에도 기록하지 않음으로써 공격 사실 자체를 은폐하는 완벽한 탐지 실패를 보여줍니다.

#### ***안전한 코드 분석 Impossible Level***

   ![]({{ "/assets/images/owasp-top-10/A09_S-2.png" | relative_url }})  

   *   ***코드 분석:*** 안전한 코드는 우선 '화이트리스트 기반의 엄격한 입력값 검증'이라는 완벽한 방어적 제어`Preventative Control`를 구현합니다. is_numeric() 함수를 통해 입력값이 오직 **숫자와 점으로 이루어진 IP 주소 형식**일 때만 허용하여 명령어 인젝션 공격을 원천적으로 차단합니다. 하지만 **보안 로깅 및 모니터링 실패** 관점에서는 결정적인 한계를 보여줍니다. 이 코드는 공격 시도를 성공적으로 '차단'은 하지만 누군가 악의적인 입력`; ls -al`을 시도했다는 사실 자체를 '기록'하지는 않습니다. 공격을 막아냈지만 그 공격이 있었다는 사실을 아무도 모르는 '조용한 방어'에 그칩니다. 이는 효과적인 탐지적 제어`Detective Control`의 부재이며 잠재적인 공격 그룹의 활동을 파악하고 대비할 기회를 놓치게 만듭니다.

#### ***핵심 방어 원리***

   결론적으로 효과적인 방어 체계는 '차단'과 '기록'이라는 두 개의 축으로 이루어져야 합니다. 가장 이상적인 방어는 엄격한 입력값 검증을 통해 공격을 원천적으로 차단하는 것입니다. 하지만 완벽한 방어는 없으므로 차단된 공격 시도조차도 반드시 **누가·언제·무엇을** 시도했는지 상세히 기록하여 가시성을 확보해야 합니다. 이 기록(로그)이 있어야만 우리는 침해 시도를 탐지하고 공격 패턴을 분석하며 더 나은 방어 전략을 수립할 수 있습니다.

<hr class="short-rule">