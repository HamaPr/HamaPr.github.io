---
layout: post
title: "A07:2021 - Identification and Authentication Failures (식별 및 인증 실패) 분석 보고서"
date: 2025-08-31 17:00:00 +0900
categories: [owasp-top-10]
---

### ***프로젝트 7. A07:2021 - Identification and Authentication Failures (식별 및 인증 실패) 분석 보고서***

### 1. 취약점 개요

   식별 및 인증 실패는 '최첨단 도어락을 설치했지만 그 열쇠가 쉽게 복제되고 뒷문은 항상 열려있는 상태'를 의미합니다. 사용자가 진짜 주인인지 확인하고(인증) 그 상태를 안전하게 유지하는(세션 관리) 모든 과정에서의 허점을 포함합니다. 아무리 강력한 비밀번호 정책을 사용하더라도 인증 시스템 자체에 결함이 있다면 공격자는 이를 우회하여 사용자의 계정을 완전히 탈취할 수 있습니다. 이는 시스템에 대한 신뢰를 근본적으로 파괴하는 치명적인 위협입니다.

   본 보고서는 공격자가 ① 인증 시도의 허점을 노리고 ② 인증 유지의 결함을 파고들며 ③ 최종적으로 인증 복구의 약점을 통해 시스템을 우회하는 인증 시스템의 3대 방어선에 대한 단계적인 공격 시나리오를 분석합니다.

---

### 2. 시나리오 분석 및 재현

#### ***Part 1. [공격과 방어] 세션 고정 `Session Fixation` 공격 시도 및 다층 방어 체계 분석***

*   ***공격 시나리오:***
   공격자가 먼저 서버로부터 유효한 세션 ID를 발급받은 뒤, 그 세션 ID를 피해자에게 전달하여 로그인하도록 유도한다. 만약 서버가 로그인 성공 후에도 기존 세션 ID를 갱신하지 않는다면 공격자는 원래 알고 있던 세션 ID를 이용해 피해자의 로그인된 세션을 탈취할 수 있을 것이다.

*   ***분석 및 검증:***
   고전적인 세션 고정 공격을 시도했으나 실패했습니다. 실패 원인을 역추적한 결과, 최신 웹 환경은 다음과 같은 다층적 방어 체계를 갖추고 있음을 증명했습니다.

   ***1차 방어 (서버 설정):*** PHP의 `session.use_only_cookies` 설정이 URL을 통한 세션 주입을 원천적으로 차단했습니다.

   ![session.use.on](/assets/images/owasp-top-10/A07_P1-1.png)

   ***2차 방어 (브라우저 정책):*** 브라우저는 URL의 세션 값보다 기존 쿠키를 우선하여 서버 방어선을 우회하더라도 공격이 실패했습니다.

   ![브라우저의 기존 쿠키 우선 정책](/assets/images/owasp-top-10/A07_P1-4.png)

   ***3차 방어 (애플리케이션 코드):*** 모든 방어선을 우회하자 DVWA 애플리케이션은 로그인 성공 시 `session_regenerate_id()`를 통해 세션을 강제로 재발급하여 공격을 최종적으로 무력화했습니다.

   ![애플리케이션 레벨의 강제 세션 재발급](/assets/images/owasp-top-10/A07_P1-3.png)

*   ***위험성 분석:***
   이 분석은 단순 공격 성공을 넘어 실패의 원인을 서버 · 브라우저 · 애플리케이션 코드 레벨까지 추적함으로써 견고한 인증 시스템의 구성 요소를 이해할 수 있었습니다. 방어자의 관점에서 매우 중요한 인사이트입니다.

>   최신 웹 환경의 다층 방어로 인해 정문(로그인)을 직접 공격하는 것은 어려웠습니다. 하지만 만약 인증 성공 후 발급되는 열쇠(세션 ID) 자체에 근본적인 결함이 있다면 어떨까요?

#### ***Part 2. [인증 우회] 예측 가능한 세션 ID를 이용한 세션 하이재킹***

*   ***공격 시나리오:***
   성공적인 인증 후 발급되는 세션 ID가 만약 예측 가능한 규칙(1씩 증가)을 가지고 있다면 공격자는 다른 사용자의 세션 ID를 추측하여 인증 절차를 건너뛰고 계정을 탈취할 수 있을 것이다.

*   ***공격 검증:***
   A02 보고서에서 확인했듯이 이 시스템의 세션 ID는 암호학적으로 안전한 난수가 아닌 1, 2, 3... 으로 순차 증가하는 심각한 결함을 가지고 있습니다. 이는 공격자가 현재 접속해 있는 다른 사용자의 세션 ID를 매우 쉽게 추측할 수 있게 만듭니다.

    ![1](/assets/images/owasp-top-10/A02_P1-1.png)
    ![2](/assets/images/owasp-top-10/A02_P1-2.png)
    ![3](/assets/images/owasp-top-10/A02_P1-3.png)

*   ***위험성 분석:***
   예측 가능한 세션 ID는 공격자가 비밀번호를 몰라도 사용자의 계정을 탈취할 수 있게 만드는 치명적인 취약점입니다. 이는 성공적으로 인증을 마친 사용자의 출입증(세션 쿠키)을 위조하여 그 사람 행세를 하는 세션 하이재킹 공격으로 이어집니다.

>  강력한 비밀번호와 안전한 세션으로 정문을 방어하더라도 비밀번호를 잊었을 때를 위한 '뒷문'이 허술하다면 모든 방어는 무력화될 수 있습니다.

#### ***Part 3. [설계 결함] 사회 공학에 취약한 안전하지 않은 계정 복구 프로세스***

*   ***공격 시나리오:***
   만약 계정 복구 기능이 '어머니의 성함'이나 '졸업한 초등학교'와 같이 사회 공학적으로 유추 가능한 정보에만 의존한다면 공격자는 이를 우회하여 합법적인 절차처럼 계정의 소유권을 이전받을 수 있을 것이다.

*   ***분석:***
   DVWA에는 해당 기능이 없지만 실제 서비스에서 가장 심각한 인증 실패는 종종 계정 복구 과정에서 발생합니다. '어머니의 성함' · '졸업한 초등학교 이름' 등은 SNS나 주변인 탐문을 통해 공격자가 충분히 알아낼 수 있는 정보입니다. 이러한 정보에만 의존하는 복구 절차는 인증 시스템의 치명적인 뒷문이 됩니다.

   ![취약한 인증](/assets/images/owasp-top-10/A07_P3-1.png)
   ![안전하지 않은 흐름도](/assets/images/owasp-top-10/A07_P3-3.png)


*   ***위험성 분석:***
   안전하지 않은 계정 복구는 다중 인증(MFA)과 같은 강력한 인증 체계를 모두 우회하고 계정을 탈취할 수 있는 심각한 위협입니다. 이를 해결하기 위해서는 반드시 이메일이나 SMS 등 사용자가 실제로 소유한 다른 채널을 통한 `2차 인증`Out-of-Band Authentication을 거쳐야만 합니다.

   ![2차 인증](/assets/images/owasp-top-10/A07_P3-2.jpg)
   ![안전한 흐름도](/assets/images/owasp-top-10/A07_P3-4.png)

---

### 3. 근본 원인 및 해결 방안

*   ***원인: 단일 실패 지점(Single Point of Failure)에 대한 의존***

   위 세 가지 문제의 공통적인 원인은 인증 과정을 여러 겹으로 보호하는 심층 방어 전략 없이 단 하나의 방어선(비밀번호)에만 의존했기 때문입니다. 비밀번호 추측을 막는 장치(Part 1) · 인증 상태를 지키는 장치(Part 2) · 비상시를 위한 복구 절차(Part 3)가 모두 허술했습니다.

*   ***해결 방안: 심층 방어 기반의 인증 체계 구축***

   안전한 인증 체계를 구축하기 위해서는 여러 방어 계층을 겹겹이 쌓는 것이 필수적입니다. NIST SP 800-63B와 같은 국제 표준을 준수하여 다음과 같은 다중 방어 전략을 구현해야 합니다.

   1.  **강력한 인증 정책:** 추측하기 어려운 긴 비밀번호를 권장하고 알려진 유출 비밀번호 목록과 비교하여 쉬운 패스워드를 금지해야 합니다.
   2.  **무차별 대입 공격 방어:** 계정 잠금 정책과 IP 기반 시도 횟수 제한(Rate Limiting)을 반드시 구현하여 자동화된 공격을 무력화해야 합니다.
   3.  **다중 인증(MFA) 도입:** 비밀번호가 유출되더라도 계정을 보호할 수 있는 가장 강력한 안전장치입니다.
   4.  **안전한 세션 관리:** 암호학적으로 안전한 난수(CSPRNG)로 세션 ID를 생성하고 모든 세션 쿠키에 `HttpOnly` · `Secure` · `SameSite=Strict` 속성을 부여하여 세션 탈취 공격을 원천적으로 방어해야 합니다.

---

### 4. 시큐어 코딩: 코드 레벨 분석

***분석 대상:*** DVWA - Brute Force

#### ***취약한 코드 분석 Low Level***

   ![]({{ "/assets/images/owasp-top-10/A07_S-1.png" | relative_url }})   

   *   ***코드 분석:*** 이 코드는 로그인 로직에 시도 횟수를 제한하거나 실패 시 페널티를 부과하는 기능이 전혀 없습니다. **`if( $result && mysqli_num_rows( $result ) == 1 )`** 조건문처럼 오직 아이디와 비밀번호의 일치 여부만 확인할 뿐입니다. 이는 공격자가 자동화된 도구를 사용하여 로그인 실패에 대한 아무런 제약 없이 무한정 비밀번호를 대입할 수 있도록 허용합니다.

#### ***안전한 코드 분석 Impossible Level***

   ![]({{ "/assets/images/owasp-top-10/A07_S-2.png" | relative_url }})  

   *   ***코드 분석:*** 안전한 코드는 다층적인 방어 체계를 사용합니다. 로그인 실패 시마다 **`sleep( rand( 2, 4 ) )`** 함수를 호출하여 응답을 고의로 지연시킵니다. 이 작은 지연 시간이 수만 번 반복되면 공격의 전체 소요 시간이 기하급수적으로 늘어납니다. 또한 사용자 계정별로 로그인 실패 횟수를 데이터베이스에 기록하고 이 횟수가 임계치를 초과하면 일정 시간 동안 계정을 잠금 처리하여 무차별 대입 공격의 효율성을 크게 떨어뜨리고 사실상 공격을 불가능하게 만듭니다.

#### ***핵심 방어 원리***

   결론적으로 인증 시스템 방어의 핵심은 **`공격 비용의 극대화`** 입니다. 계정 잠금 · 응답 시간 지연(Rate Limiting) · CAPTCHA 등의 방어책을 통해 자동화된 공격의 시간 및 리소스 비용을 비약적으로 증가시켜 공격의 실효성을 없애야 합니다.

<hr class="short-rule">